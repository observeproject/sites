<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=alternate type=application/rss+xml href=https://stack.observability.udmire.cn/tempo/index.xml title="Mixins for Observability Stack"><link rel=canonical href=https://stack.observability.udmire.cn/tempo/><title>tempo | Mixins for Observability Stack</title><link href=https://stack.observability.udmire.cn/css/fontawesome.min.css rel=stylesheet><link rel=stylesheet href=https://stack.observability.udmire.cn/css/ace.min.css></head><body><nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow sticky-top" id=navbarMain><div class=container><div><a class=navbar-brand href=/>Mixins for Observability Stack</a></div><button class="navbar-toggler navbar-toggler-right collapsed" type=button data-toggle=collapse data-target=#navbarMainCollapse aria-controls=navbarMainCollapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarMainCollapse><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/>Homepage</a></li><li class=nav-item><a class=nav-link href=https://github.com/monitoring-mixins/docs>About mixins</a></li><li class=nav-item><a class=nav-link href=https://github.com/observeproject/sites>GitHub</a></li></ul></div></div><div class=feed-icons><a href=https://stack.observability.udmire.cn/tempo/index.xml><img src=/img/feed-icon.svg alt="RSS feed"></a></div></nav><div class=container-fluid><div class=row><div class="docs-sidenav order-0 col-12 col-md-3 col-lg-2 col-xl-2 position-sticky border-right"><nav class="navbar navbar-expand-md navbar-light pl-0"><button class="navbar-toggler navbar-toggler-right collapsed" type=button data-toggle=collapse data-target=#sidenav-left-collapse aria-controls=sidenav-left-collapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse align-items-start flex-column" id=sidenav-left-collapse><ul class="navbar-nav flex-column pt-3"><li data-nav-id=/kube-state-metrics/ class="nav-item my-1"><a class="nav-link p-0" href=/kube-state-metrics/><h6>kube-state-metrics</h6></a></li><li data-nav-id=/kubernetes/ class="nav-item my-1"><a class="nav-link p-0" href=/kubernetes/><h6>kubernetes</h6></a></li><li data-nav-id=/loki/ class="nav-item my-1"><a class="nav-link p-0" href=/loki/><h6>loki</h6></a></li><li data-nav-id=/mimir/ class="nav-item my-1"><a class="nav-link p-0" href=/mimir/><h6>mimir</h6></a></li><li data-nav-id=/node-exporter/ class="nav-item my-1"><a class="nav-link p-0" href=/node-exporter/><h6>node-exporter</h6></a></li><li data-nav-id=/tempo/ class="nav-item my-1 active"><a class="nav-link p-0" href=/tempo/><h6>tempo</h6></a></li></ul></div></nav></div><div class="docs-toc large order-lg-2 order-md-0 order-xs-1 col-12 col-lg-3 col-xl-3 position-sticky border-left"><div class=docs-toc><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#alerts>Alerts</a><ul><li><a href=#tempo_alerts>tempo_alerts</a></li></ul></li><li><a href=#recording-rules>Recording rules</a><ul><li><a href=#tempo_rules>tempo_rules</a></li></ul></li><li><a href=#dashboards>Dashboards</a></li></ul></nav></div></div><div class="main col-12 order-1 col-md-9 col-lg-9 col-xl-7 py-3"><h1>tempo</h1><h2 id=overview>Overview</h2><div class="card my-3 border-top-0 border-right-0 border-bottom-0 border-left border-danger rounded" style=border-width:4px!important><div class="wrap border border-left-0 rounded"><div class="card-body pt-1">Jsonnet source code is available at <a href=https://github.com/grafana/tempo/tree/master/operations/tempo-mixin>github.com/grafana/tempo</a></div></div></div><h2 id=alerts>Alerts</h2><div class="card my-3 border-top-0 border-right-0 border-bottom-0 border-left border-warning rounded" style=border-width:4px!important><div class="wrap border border-left-0 rounded"><div class="card-body pt-1">Complete list of pregenerated alerts is available <a href=https://github.com/observeproject/sites/blob/main/assets/tempo/alerts.yaml>here</a>.</div></div></div><h3 id=tempo_alerts>tempo_alerts</h3><h5 id=temporequestlatency>TempoRequestLatency</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_f74275f6a6>
Copy</button></div><div id=clipboard_f74275f6a6><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>TempoRequestLatency</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    {{ <span style=color:#ae81ff>$labels.job }} {{ $labels.route }} is experiencing {{ printf &#34;%.2f&#34; $value }}s 99th percentile latency.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://github.com/grafana/tempo/tree/main/operations/tempo-mixin/runbook.md#TempoRequestLatency</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>cluster_namespace_job_route:tempo_request_duration_seconds:99quantile{route!~&#34;metrics|/frontend.Frontend/Process|debug_pprof&#34;} &gt; 3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=tempocompactorunhealthy>TempoCompactorUnhealthy</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_2442213442>
Copy</button></div><div id=clipboard_2442213442><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>TempoCompactorUnhealthy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>There are {{ printf &#34;%f&#34; $value }} unhealthy compactor(s).</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://github.com/grafana/tempo/tree/main/operations/tempo-mixin/runbook.md#TempoCompactorUnhealthy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>max by (cluster, namespace) (cortex_ring_members{state=&#34;Unhealthy&#34;, name=&#34;compactor&#34;, namespace=~&#34;.*&#34;}) &gt; 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=tempodistributorunhealthy>TempoDistributorUnhealthy</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_d25adcfff6>
Copy</button></div><div id=clipboard_d25adcfff6><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>TempoDistributorUnhealthy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>There are {{ printf &#34;%f&#34; $value }} unhealthy distributor(s).</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://github.com/grafana/tempo/tree/main/operations/tempo-mixin/runbook.md#TempoDistributorUnhealthy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>max by (cluster, namespace) (cortex_ring_members{state=&#34;Unhealthy&#34;, name=&#34;distributor&#34;, namespace=~&#34;.*&#34;}) &gt; 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=tempocompactionsfailing>TempoCompactionsFailing</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_5c2ab8c348>
Copy</button></div><div id=clipboard_5c2ab8c348><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>TempoCompactionsFailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Greater than 2 compactions have failed in the past hour.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://github.com/grafana/tempo/tree/main/operations/tempo-mixin/runbook.md#TempoCompactionsFailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace) (increase(tempodb_compaction_errors_total{}[1h])) &gt; 2 and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace) (increase(tempodb_compaction_errors_total{}[5m])) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=tempoingesterflushesunhealthy>TempoIngesterFlushesUnhealthy</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_29a028e043>
Copy</button></div><div id=clipboard_29a028e043><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>TempoIngesterFlushesUnhealthy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Greater than 2 flush retries have occurred in the past hour.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://github.com/grafana/tempo/tree/main/operations/tempo-mixin/runbook.md#TempoIngesterFlushesFailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace) (increase(tempo_ingester_failed_flushes_total{}[1h])) &gt; 2 and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace) (increase(tempo_ingester_failed_flushes_total{}[5m])) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=tempoingesterflushesfailing>TempoIngesterFlushesFailing</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_3fe4f48a59>
Copy</button></div><div id=clipboard_3fe4f48a59><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>TempoIngesterFlushesFailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Greater than 2 flush retries have failed in the past hour.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://github.com/grafana/tempo/tree/main/operations/tempo-mixin/runbook.md#TempoIngesterFlushesFailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace) (increase(tempo_ingester_flush_failed_retries_total{}[1h])) &gt; 2 and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace) (increase(tempo_ingester_flush_failed_retries_total{}[5m])) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=tempopollsfailing>TempoPollsFailing</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_0f00e704d7>
Copy</button></div><div id=clipboard_0f00e704d7><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>TempoPollsFailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Greater than 2 polls have failed in the past hour.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://github.com/grafana/tempo/tree/main/operations/tempo-mixin/runbook.md#TempoPollsFailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace) (increase(tempodb_blocklist_poll_errors_total{}[1h])) &gt; 2 and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace) (increase(tempodb_blocklist_poll_errors_total{}[5m])) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=tempotenantindexfailures>TempoTenantIndexFailures</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_29db6c861d>
Copy</button></div><div id=clipboard_29db6c861d><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>TempoTenantIndexFailures</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Greater than 2 tenant index failures in the past hour.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://github.com/grafana/tempo/tree/main/operations/tempo-mixin/runbook.md#TempoTenantIndexFailures</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace) (increase(tempodb_blocklist_tenant_index_errors_total{}[1h])) &gt; 2 and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace) (increase(tempodb_blocklist_tenant_index_errors_total{}[5m])) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=temponotenantindexbuilders>TempoNoTenantIndexBuilders</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_9e83e21509>
Copy</button></div><div id=clipboard_9e83e21509><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>TempoNoTenantIndexBuilders</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#00a8c8>No</span> <span style=color:#ae81ff>tenant index builders for tenant {{ $labels.tenant }}. Tenant index</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>will quickly become stale.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://github.com/grafana/tempo/tree/main/operations/tempo-mixin/runbook.md#TempoNoTenantIndexBuilders</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, tenant) (tempodb_blocklist_tenant_index_builder{}) == 0 and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  max by (cluster, namespace) (tempodb_blocklist_length{}) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=tempotenantindextooold>TempoTenantIndexTooOld</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_ac06b76bc6>
Copy</button></div><div id=clipboard_ac06b76bc6><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>TempoTenantIndexTooOld</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Tenant index age is 600 seconds old for tenant {{ $labels.tenant }}.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://github.com/grafana/tempo/tree/main/operations/tempo-mixin/runbook.md#TempoTenantIndexTooOld</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>max by (cluster, namespace, tenant) (tempodb_blocklist_tenant_index_age_seconds{}) &gt; 600</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=tempobadoverrides>TempoBadOverrides</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_9f1e36ca17>
Copy</button></div><div id=clipboard_9f1e36ca17><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>TempoBadOverrides</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#d88200>&#39;{{ $labels.job }} failed to reload overrides.&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://github.com/grafana/tempo/tree/main/operations/tempo-mixin/runbook.md#TempoBadOverrides</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum(tempo_runtime_config_last_reload_successful{namespace=~&#34;.*&#34;} == 0) by (cluster, namespace, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=tempoprovisioningtoomanywrites>TempoProvisioningTooManyWrites</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_ee739109ea>
Copy</button></div><div id=clipboard_ee739109ea><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>TempoProvisioningTooManyWrites</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Ingesters in {{ $labels.cluster }}/{{ $labels.namespace }} are receiving</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>more data/second than desired, add more ingesters.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://github.com/grafana/tempo/tree/main/operations/tempo-mixin/runbook.md#TempoProvisioningTooManyWrites</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>avg by (cluster, namespace) (rate(tempo_ingester_bytes_received_total{job=~&#34;.+/ingester&#34;}[1m])) / 1024 / 1024 &gt; 30</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=tempocompactorstoomanyoutstandingblocks>TempoCompactorsTooManyOutstandingBlocks</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_3dec56605b>
Copy</button></div><div id=clipboard_3dec56605b><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>TempoCompactorsTooManyOutstandingBlocks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>There are too many outstanding compaction blocks in {{ $labels.cluster</span>
</span></span><span style=display:flex><span>    }}<span style=color:#ae81ff>/{{ $labels.namespace }} for tenant {{ $labels.tenant }}, increase compactor&#39;s</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>CPU or add more compactors.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://github.com/grafana/tempo/tree/main/operations/tempo-mixin/runbook.md#TempoCompactorsTooManyOutstandingBlocks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum by (cluster, namespace, tenant) (tempodb_compaction_outstanding_blocks{container=&#34;compactor&#34;, namespace=~&#34;.*&#34;}) / ignoring(tenant) group_left count(tempo_build_info{container=&#34;compactor&#34;, namespace=~&#34;.*&#34;}) by (cluster, namespace) &gt; 100</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>6h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=tempocompactorstoomanyoutstandingblocks-1>TempoCompactorsTooManyOutstandingBlocks</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_fdf6e8a0c8>
Copy</button></div><div id=clipboard_fdf6e8a0c8><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>TempoCompactorsTooManyOutstandingBlocks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>There are too many outstanding compaction blocks in {{ $labels.cluster</span>
</span></span><span style=display:flex><span>    }}<span style=color:#ae81ff>/{{ $labels.namespace }} for tenant {{ $labels.tenant }}, increase compactor&#39;s</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>CPU or add more compactors.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://github.com/grafana/tempo/tree/main/operations/tempo-mixin/runbook.md#TempoCompactorsTooManyOutstandingBlocks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum by (cluster, namespace, tenant) (tempodb_compaction_outstanding_blocks{container=&#34;compactor&#34;, namespace=~&#34;.*&#34;}) / ignoring(tenant) group_left count(tempo_build_info{container=&#34;compactor&#34;, namespace=~&#34;.*&#34;}) by (cluster, namespace) &gt; 250</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>24h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=tempoingesterreplayerrors>TempoIngesterReplayErrors</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_2e8977161f>
Copy</button></div><div id=clipboard_2e8977161f><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>TempoIngesterReplayErrors</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Tempo ingester has encountered errors while replaying a block on startup</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>in {{ $labels.cluster }}/{{ $labels.namespace }} for tenant {{ $labels.tenant</span>
</span></span><span style=display:flex><span>    }}
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://github.com/grafana/tempo/tree/main/operations/tempo-mixin/runbook.md#TempoIngesterReplayErrors</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum by (cluster, namespace, tenant) (increase(tempo_ingester_replay_errors_total{namespace=~&#34;.*&#34;}[5m])) &gt; 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h2 id=recording-rules>Recording rules</h2><div class="card my-3 border-top-0 border-right-0 border-bottom-0 border-left border-warning rounded" style=border-width:4px!important><div class="wrap border border-left-0 rounded"><div class="card-body pt-1">Complete list of pregenerated recording rules is available <a href=https://github.com/observeproject/sites/blob/main/assets/tempo/rules.yaml>here</a>.</div></div></div><h3 id=tempo_rules>tempo_rules</h3><h5 id=cluster_namespace_job_routetempo_request_duration_seconds99quantile>cluster_namespace_job_route:tempo_request_duration_seconds:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_fbc5ed02d0>
Copy</button></div><div id=clipboard_fbc5ed02d0><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(tempo_request_duration_seconds_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, namespace, job, route))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:tempo_request_duration_seconds:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routetempo_request_duration_seconds50quantile>cluster_namespace_job_route:tempo_request_duration_seconds:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_182580e38e>
Copy</button></div><div id=clipboard_182580e38e><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(tempo_request_duration_seconds_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, namespace, job, route))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:tempo_request_duration_seconds:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routetempo_request_duration_secondsavg>cluster_namespace_job_route:tempo_request_duration_seconds:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_6a8c75f7a5>
Copy</button></div><div id=clipboard_6a8c75f7a5><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(tempo_request_duration_seconds_sum[1m])) by (cluster, namespace, job,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>route) / sum(rate(tempo_request_duration_seconds_count[1m])) by (cluster, namespace,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:tempo_request_duration_seconds:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routetempo_request_duration_seconds_bucketsum_rate>cluster_namespace_job_route:tempo_request_duration_seconds_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_ebb671fc07>
Copy</button></div><div id=clipboard_ebb671fc07><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(tempo_request_duration_seconds_bucket[1m])) by (le, cluster, namespace,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:tempo_request_duration_seconds_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routetempo_request_duration_seconds_sumsum_rate>cluster_namespace_job_route:tempo_request_duration_seconds_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_f5af4763ec>
Copy</button></div><div id=clipboard_f5af4763ec><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(tempo_request_duration_seconds_sum[1m])) by (cluster, namespace, job,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:tempo_request_duration_seconds_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routetempo_request_duration_seconds_countsum_rate>cluster_namespace_job_route:tempo_request_duration_seconds_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_63a9ad05bc>
Copy</button></div><div id=clipboard_63a9ad05bc><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(tempo_request_duration_seconds_count[1m])) by (cluster, namespace,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:tempo_request_duration_seconds_count:sum_rate</span>
</span></span></code></pre></div></div></div><h2 id=dashboards>Dashboards</h2><p>Following dashboards are generated from mixins and hosted on github:</p><ul><li><a href=https://github.com/observeproject/sites/blob/main/assets/tempo/dashboards/tempo-operational.json>tempo-operational</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/tempo/dashboards/tempo-reads.json>tempo-reads</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/tempo/dashboards/tempo-resources.json>tempo-resources</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/tempo/dashboards/tempo-rollout-progress.json>tempo-rollout-progress</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/tempo/dashboards/tempo-tenants.json>tempo-tenants</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/tempo/dashboards/tempo-writes.json>tempo-writes</a></li></ul><div class=row></div></div></div></div><script src=https://stack.observability.udmire.cn/lib/jquery.min.js></script>
<script src=https://stack.observability.udmire.cn/lib/popper.min.js></script>
<script src=https://stack.observability.udmire.cn/js/bootstrap.min.js></script>
<script type=text/javascript src=/plugins/lunr.min.js></script>
<script type=text/javascript src=/plugins/auto-complete.js></script>
<link href=/plugins/auto-complete.css rel=stylesheet><script type=text/javascript>var baseurl="https://stack.observability.udmire.cn/"</script><script type=text/javascript src=/plugins/search.js></script>
<script type=text/javascript src=/plugins/clipboard.js></script>
<script>new ClipboardJS(".btn")</script></body></html>