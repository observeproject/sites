<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=alternate type=application/rss+xml href=https://stack.observability.udmire.cn/mimir/index.xml title="Mixins for Observability Stack"><link rel=canonical href=https://stack.observability.udmire.cn/mimir/><title>mimir | Mixins for Observability Stack</title><link href=https://stack.observability.udmire.cn/css/fontawesome.min.css rel=stylesheet><link rel=stylesheet href=https://stack.observability.udmire.cn/css/ace.min.css></head><body><nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow sticky-top" id=navbarMain><div class=container><div><a class=navbar-brand href=/>Mixins for Observability Stack</a></div><button class="navbar-toggler navbar-toggler-right collapsed" type=button data-toggle=collapse data-target=#navbarMainCollapse aria-controls=navbarMainCollapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarMainCollapse><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/>Homepage</a></li><li class=nav-item><a class=nav-link href=https://github.com/monitoring-mixins/docs>About mixins</a></li><li class=nav-item><a class=nav-link href=https://github.com/observeproject/sites>GitHub</a></li></ul></div></div><div class=feed-icons><a href=https://stack.observability.udmire.cn/mimir/index.xml><img src=/img/feed-icon.svg alt="RSS feed"></a></div></nav><div class=container-fluid><div class=row><div class="docs-sidenav order-0 col-12 col-md-3 col-lg-2 col-xl-2 position-sticky border-right"><nav class="navbar navbar-expand-md navbar-light pl-0"><button class="navbar-toggler navbar-toggler-right collapsed" type=button data-toggle=collapse data-target=#sidenav-left-collapse aria-controls=sidenav-left-collapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse align-items-start flex-column" id=sidenav-left-collapse><ul class="navbar-nav flex-column pt-3"><li data-nav-id=/kubernetes/ class="nav-item my-1"><a class="nav-link p-0" href=/kubernetes/><h6>kubernetes</h6></a></li><li data-nav-id=/mimir/ class="nav-item my-1 active"><a class="nav-link p-0" href=/mimir/><h6>mimir</h6></a></li></ul></div></nav></div><div class="docs-toc large order-lg-2 order-md-0 order-xs-1 col-12 col-lg-3 col-xl-3 position-sticky border-left"><div class=docs-toc><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#alerts>Alerts</a><ul><li><a href=#mimir_alerts>mimir_alerts</a></li><li><a href=#mimir_instance_limits_alerts>mimir_instance_limits_alerts</a></li><li><a href=#mimir-rollout-alerts>mimir-rollout-alerts</a></li><li><a href=#mimir-provisioning>mimir-provisioning</a></li><li><a href=#ruler_alerts>ruler_alerts</a></li><li><a href=#gossip_alerts>gossip_alerts</a></li><li><a href=#etcd_alerts>etcd_alerts</a></li><li><a href=#alertmanager_alerts>alertmanager_alerts</a></li><li><a href=#mimir_blocks_alerts>mimir_blocks_alerts</a></li><li><a href=#mimir_compactor_alerts>mimir_compactor_alerts</a></li><li><a href=#mimir_autoscaling_querier>mimir_autoscaling_querier</a></li><li><a href=#mimir_continuous_test>mimir_continuous_test</a></li></ul></li><li><a href=#recording-rules>Recording rules</a><ul><li><a href=#mimir_api_1>mimir_api_1</a></li><li><a href=#mimir_api_2>mimir_api_2</a></li><li><a href=#mimir_api_3>mimir_api_3</a></li><li><a href=#mimir_querier_api>mimir_querier_api</a></li><li><a href=#mimir_cache>mimir_cache</a></li><li><a href=#mimir_storage>mimir_storage</a></li><li><a href=#mimir_queries>mimir_queries</a></li><li><a href=#mimir_ingester_queries>mimir_ingester_queries</a></li><li><a href=#mimir_received_samples>mimir_received_samples</a></li><li><a href=#mimir_exemplars_in>mimir_exemplars_in</a></li><li><a href=#mimir_received_exemplars>mimir_received_exemplars</a></li><li><a href=#mimir_exemplars_ingested>mimir_exemplars_ingested</a></li><li><a href=#mimir_exemplars_appended>mimir_exemplars_appended</a></li><li><a href=#mimir_scaling_rules>mimir_scaling_rules</a></li><li><a href=#mimir_alertmanager_rules>mimir_alertmanager_rules</a></li><li><a href=#mimir_ingester_rules>mimir_ingester_rules</a></li></ul></li><li><a href=#dashboards>Dashboards</a></li></ul></nav></div></div><div class="main col-12 order-1 col-md-9 col-lg-9 col-xl-7 py-3"><h1>mimir</h1><h2 id=overview>Overview</h2><p>The mimir Mixin is a set of configurable, reusable, and extensible alerts and dashboards for Mimir/Cortex.</p><div class="card my-3 border-top-0 border-right-0 border-bottom-0 border-left border-danger rounded" style=border-width:4px!important><div class="wrap border border-left-0 rounded"><div class="card-body pt-1">Jsonnet source code is available at <a href=https://github.com/grafana/mimir/tree/master/operations/mimir-mixin>github.com/grafana/mimir</a></div></div></div><h2 id=alerts>Alerts</h2><div class="card my-3 border-top-0 border-right-0 border-bottom-0 border-left border-warning rounded" style=border-width:4px!important><div class="wrap border border-left-0 rounded"><div class="card-body pt-1">Complete list of pregenerated alerts is available <a href=https://github.com/observeproject/sites/blob/main/assets/mimir/alerts.yaml>here</a>.</div></div></div><h3 id=mimir_alerts>mimir_alerts</h3><h5 id=mimiringesterunhealthy>MimirIngesterUnhealthy</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_ec84c08caf>
Copy</button></div><div id=clipboard_ec84c08caf><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirIngesterUnhealthy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir cluster {{ $labels.cluster }}/{{ $labels.namespace }} has {{ printf</span>
</span></span><span style=display:flex><span>    <span style=color:#d88200>&#34;%f&#34;</span> <span style=color:#ae81ff>$value }} unhealthy ingester(s).</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>min by (cluster, namespace) (cortex_ring_members{state=&#34;Unhealthy&#34;, name=&#34;ingester&#34;}) &gt; 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimirrequesterrors>MimirRequestErrors</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_3020ffb718>
Copy</button></div><div id=clipboard_3020ffb718><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirRequestErrors</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>The route {{ $labels.route }} in {{ $labels.cluster }}/{{ $labels.namespace }} is experiencing {{ printf &#34;%.2f&#34; $value }}% errors.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  100 * sum by (cluster, namespace, job, route) (rate(cortex_request_duration_seconds_count{status_code=~&#34;5..&#34;,route!~&#34;ready&#34;}[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>    /
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, job, route) (rate(cortex_request_duration_seconds_count{route!~&#34;ready&#34;}[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>    &gt; 1</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimirrequestlatency>MimirRequestLatency</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_64ab1f9b99>
Copy</button></div><div id=clipboard_64ab1f9b99><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirRequestLatency</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    {{ <span style=color:#ae81ff>$labels.job }} {{ $labels.route }} is experiencing {{ printf &#34;%.2f&#34; $value }}s 99th percentile latency.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  cluster_namespace_job_route:cortex_request_duration_seconds:99quantile{route!~&#34;metrics|/frontend.Frontend/Process|ready|/schedulerpb.SchedulerForFrontend/FrontendLoop|/schedulerpb.SchedulerForQuerier/QuerierLoop&#34;}
</span></span></span><span style=display:flex><span><span style=color:#d88200>     &gt;
</span></span></span><span style=display:flex><span><span style=color:#d88200>  2.5</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=mimirqueriesincorrect>MimirQueriesIncorrect</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_89b5a1143f>
Copy</button></div><div id=clipboard_89b5a1143f><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirQueriesIncorrect</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>The Mimir cluster {{ $labels.cluster }}/{{ $labels.namespace }} is experiencing {{ printf &#34;%.2f&#34; $value }}% incorrect query results.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  100 * sum by (cluster, namespace) (rate(test_exporter_test_case_result_total{result=&#34;fail&#34;}[5m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>    /
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace) (rate(test_exporter_test_case_result_total[5m])) &gt; 1</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=mimirinconsistentruntimeconfig>MimirInconsistentRuntimeConfig</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_d8737d5fef>
Copy</button></div><div id=clipboard_d8737d5fef><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirInconsistentRuntimeConfig</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>An inconsistent runtime config file is used across cluster {{ $labels.cluster }}/{{ $labels.namespace }}.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>count(count by(cluster, namespace, job, sha256) (cortex_runtime_config_hash)) without(sha256) &gt; 1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>1h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimirbadruntimeconfig>MimirBadRuntimeConfig</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_3a407a0452>
Copy</button></div><div id=clipboard_3a407a0452><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirBadRuntimeConfig</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    {{ <span style=color:#ae81ff>$labels.job }} failed to reload runtime config.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # The metric value is reset to 0 on error while reloading the config at runtime.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  cortex_runtime_config_last_reload_successful == 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimirfrontendqueriesstuck>MimirFrontendQueriesStuck</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_9de7ea0133>
Copy</button></div><div id=clipboard_9de7ea0133><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirFrontendQueriesStuck</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>There are {{ $value }} queued up queries in {{ $labels.cluster }}/{{ $labels.namespace }} {{ $labels.job }}.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum by (cluster, namespace, job) (min_over_time(cortex_query_frontend_queue_length[1m])) &gt; 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimirschedulerqueriesstuck>MimirSchedulerQueriesStuck</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_019b5f007a>
Copy</button></div><div id=clipboard_019b5f007a><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirSchedulerQueriesStuck</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>There are {{ $value }} queued up queries in {{ $labels.cluster }}/{{ $labels.namespace }} {{ $labels.job }}.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum by (cluster, namespace, job) (min_over_time(cortex_query_scheduler_queue_length[1m])) &gt; 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimirmemcachedrequesterrors>MimirMemcachedRequestErrors</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_716e3c8924>
Copy</button></div><div id=clipboard_716e3c8924><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirMemcachedRequestErrors</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Memcached {{ $labels.name }} used by Mimir {{ $labels.cluster }}/{{ $labels.namespace }} is experiencing {{ printf &#34;%.2f&#34; $value }}% errors for {{ $labels.operation }} operation.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by(cluster, namespace, name, operation) (rate(thanos_memcached_operation_failures_total[1m])) /
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by(cluster, namespace, name, operation) (rate(thanos_memcached_operations_total[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) * 100 &gt; 5</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=mimiringesterrestarts>MimirIngesterRestarts</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_10a0076b1c>
Copy</button></div><div id=clipboard_10a0076b1c><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirIngesterRestarts</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#d88200>&#39;{{ $labels.job }}/{{ $labels.pod }} has restarted {{ printf &#34;%.2f&#34; $value
</span></span></span><span style=display:flex><span><span style=color:#d88200>    }} times in the last 30 mins.&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>changes(process_start_time_seconds{job=~&#34;.+(cortex|ingester.*)&#34;}[30m]) &gt;= 2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=mimirkvstorefailure>MimirKVStoreFailure</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_51095b4ddf>
Copy</button></div><div id=clipboard_51095b4ddf><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirKVStoreFailure</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Mimir {{ $labels.pod }} in  {{ $labels.cluster }}/{{ $labels.namespace }} is failing to talk to the KV store {{ $labels.kv_name }}.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by(cluster, namespace, pod, status_code, kv_name) (rate(cortex_kv_request_duration_seconds_count{status_code!~&#34;2.+&#34;}[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>    /
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by(cluster, namespace, pod, status_code, kv_name) (rate(cortex_kv_request_duration_seconds_count[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # We want to get alerted only in case there&#39;s a constant failure.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  == 1</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimirmemorymapareastoohigh>MimirMemoryMapAreasTooHigh</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_e612527e0d>
Copy</button></div><div id=clipboard_e612527e0d><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirMemoryMapAreasTooHigh</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#d88200>&#39;{{ $labels.job }}/{{ $labels.pod }} has a number of mmap-ed areas close
</span></span></span><span style=display:flex><span><span style=color:#d88200>    to the limit.&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>process_memory_map_areas{job=~&#34;.+(cortex|ingester.*|store-gateway.*)&#34;} / process_memory_map_areas_limit{job=~&#34;.+(cortex|ingester.*|store-gateway.*)&#34;} &gt; 0.8</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h3 id=mimir_instance_limits_alerts>mimir_instance_limits_alerts</h3><h5 id=mimiringesterreachingserieslimit>MimirIngesterReachingSeriesLimit</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_6672fa2210>
Copy</button></div><div id=clipboard_6672fa2210><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirIngesterReachingSeriesLimit</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Ingester {{ $labels.job }}/{{ $labels.pod }} has reached {{ $value | humanizePercentage }} of its series limit.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      (cortex_ingester_memory_series / ignoring(limit) cortex_ingester_instance_limits{limit=&#34;max_series&#34;})
</span></span></span><span style=display:flex><span><span style=color:#d88200>      and ignoring (limit)
</span></span></span><span style=display:flex><span><span style=color:#d88200>      (cortex_ingester_instance_limits{limit=&#34;max_series&#34;} &gt; 0)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 0.8</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>3h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=mimiringesterreachingserieslimit-1>MimirIngesterReachingSeriesLimit</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_82baad2ee1>
Copy</button></div><div id=clipboard_82baad2ee1><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirIngesterReachingSeriesLimit</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Ingester {{ $labels.job }}/{{ $labels.pod }} has reached {{ $value | humanizePercentage }} of its series limit.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      (cortex_ingester_memory_series / ignoring(limit) cortex_ingester_instance_limits{limit=&#34;max_series&#34;})
</span></span></span><span style=display:flex><span><span style=color:#d88200>      and ignoring (limit)
</span></span></span><span style=display:flex><span><span style=color:#d88200>      (cortex_ingester_instance_limits{limit=&#34;max_series&#34;} &gt; 0)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 0.9</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimiringesterreachingtenantslimit>MimirIngesterReachingTenantsLimit</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_0ca2ef8f1e>
Copy</button></div><div id=clipboard_0ca2ef8f1e><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirIngesterReachingTenantsLimit</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Ingester {{ $labels.job }}/{{ $labels.pod }} has reached {{ $value | humanizePercentage }} of its tenant limit.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      (cortex_ingester_memory_users / ignoring(limit) cortex_ingester_instance_limits{limit=&#34;max_tenants&#34;})
</span></span></span><span style=display:flex><span><span style=color:#d88200>      and ignoring (limit)
</span></span></span><span style=display:flex><span><span style=color:#d88200>      (cortex_ingester_instance_limits{limit=&#34;max_tenants&#34;} &gt; 0)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 0.7</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=mimiringesterreachingtenantslimit-1>MimirIngesterReachingTenantsLimit</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_97b506a386>
Copy</button></div><div id=clipboard_97b506a386><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirIngesterReachingTenantsLimit</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Ingester {{ $labels.job }}/{{ $labels.pod }} has reached {{ $value | humanizePercentage }} of its tenant limit.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      (cortex_ingester_memory_users / ignoring(limit) cortex_ingester_instance_limits{limit=&#34;max_tenants&#34;})
</span></span></span><span style=display:flex><span><span style=color:#d88200>      and ignoring (limit)
</span></span></span><span style=display:flex><span><span style=color:#d88200>      (cortex_ingester_instance_limits{limit=&#34;max_tenants&#34;} &gt; 0)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 0.8</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimirreachingtcpconnectionslimit>MimirReachingTCPConnectionsLimit</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_470562808a>
Copy</button></div><div id=clipboard_470562808a><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirReachingTCPConnectionsLimit</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Mimir instance {{ $labels.job }}/{{ $labels.pod }} has reached {{ $value | humanizePercentage }} of its TCP connections limit for {{ $labels.protocol }} protocol.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  cortex_tcp_connections / cortex_tcp_connections_limit &gt; 0.8 and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  cortex_tcp_connections_limit &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimirdistributorreachinginflightpushrequestlimit>MimirDistributorReachingInflightPushRequestLimit</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_5f17e9d316>
Copy</button></div><div id=clipboard_5f17e9d316><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirDistributorReachingInflightPushRequestLimit</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Distributor {{ $labels.job }}/{{ $labels.pod }} has reached {{ $value | humanizePercentage }} of its inflight push request limit.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      (cortex_distributor_inflight_push_requests / ignoring(limit) cortex_distributor_instance_limits{limit=&#34;max_inflight_push_requests&#34;})
</span></span></span><span style=display:flex><span><span style=color:#d88200>      and ignoring (limit)
</span></span></span><span style=display:flex><span><span style=color:#d88200>      (cortex_distributor_instance_limits{limit=&#34;max_inflight_push_requests&#34;} &gt; 0)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 0.8</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h3 id=mimir-rollout-alerts>mimir-rollout-alerts</h3><h5 id=mimirrolloutstuck>MimirRolloutStuck</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_25fd093206>
Copy</button></div><div id=clipboard_25fd093206><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirRolloutStuck</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>The {{ $labels.rollout_group }} rollout is stuck in {{ $labels.cluster }}/{{ $labels.namespace }}.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    max without (revision) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      sum without(statefulset) (label_replace(kube_statefulset_status_current_revision, &#34;rollout_group&#34;, &#34;$1&#34;, &#34;statefulset&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;))
</span></span></span><span style=display:flex><span><span style=color:#d88200>        unless
</span></span></span><span style=display:flex><span><span style=color:#d88200>      sum without(statefulset) (label_replace(kube_statefulset_status_update_revision, &#34;rollout_group&#34;, &#34;$1&#34;, &#34;statefulset&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;))
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>      *
</span></span></span><span style=display:flex><span><span style=color:#d88200>    (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      sum without(statefulset) (label_replace(kube_statefulset_replicas, &#34;rollout_group&#34;, &#34;$1&#34;, &#34;statefulset&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;))
</span></span></span><span style=display:flex><span><span style=color:#d88200>        !=
</span></span></span><span style=display:flex><span><span style=color:#d88200>      sum without(statefulset) (label_replace(kube_statefulset_status_replicas_updated, &#34;rollout_group&#34;, &#34;$1&#34;, &#34;statefulset&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;))
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) and (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    changes(sum without(statefulset) (label_replace(kube_statefulset_status_replicas_updated, &#34;rollout_group&#34;, &#34;$1&#34;, &#34;statefulset&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;))[15m:1m])
</span></span></span><span style=display:flex><span><span style=color:#d88200>      ==
</span></span></span><span style=display:flex><span><span style=color:#d88200>    0
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  * on(cluster, namespace) group_left max by(cluster, namespace) (cortex_build_info)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>30m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=mimirrolloutstuck-1>MimirRolloutStuck</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_6863aa6748>
Copy</button></div><div id=clipboard_6863aa6748><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirRolloutStuck</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>The {{ $labels.rollout_group }} rollout is stuck in {{ $labels.cluster }}/{{ $labels.namespace }}.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum without(deployment) (label_replace(kube_deployment_spec_replicas, &#34;rollout_group&#34;, &#34;$1&#34;, &#34;deployment&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;))
</span></span></span><span style=display:flex><span><span style=color:#d88200>      !=
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum without(deployment) (label_replace(kube_deployment_status_replicas_updated, &#34;rollout_group&#34;, &#34;$1&#34;, &#34;deployment&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) and (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    changes(sum without(deployment) (label_replace(kube_deployment_status_replicas_updated, &#34;rollout_group&#34;, &#34;$1&#34;, &#34;deployment&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;))[15m:1m])
</span></span></span><span style=display:flex><span><span style=color:#d88200>      ==
</span></span></span><span style=display:flex><span><span style=color:#d88200>    0
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  * on(cluster, namespace) group_left max by(cluster, namespace) (cortex_build_info)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>30m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=rolloutoperatornotreconciling>RolloutOperatorNotReconciling</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_6c0cba5176>
Copy</button></div><div id=clipboard_6c0cba5176><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>RolloutOperatorNotReconciling</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Rollout operator is not reconciling the rollout group {{ $labels.rollout_group }} in {{ $labels.cluster }}/{{ $labels.namespace }}.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>max by(cluster, namespace, rollout_group) (time() - rollout_operator_last_successful_group_reconcile_timestamp_seconds) &gt; 600</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h3 id=mimir-provisioning>mimir-provisioning</h3><h5 id=mimirprovisioningtoomanyactiveseries>MimirProvisioningTooManyActiveSeries</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_afac00f809>
Copy</button></div><div id=clipboard_afac00f809><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirProvisioningTooManyActiveSeries</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>The number of in-memory series per ingester in {{ $labels.cluster }}/{{ $labels.namespace }} is too high.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>avg by (cluster, namespace) (cortex_ingester_memory_series) &gt; 1.6e6</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>2h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=mimirprovisioningtoomanywrites>MimirProvisioningTooManyWrites</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_bfb5d0fcfc>
Copy</button></div><div id=clipboard_bfb5d0fcfc><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirProvisioningTooManyWrites</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Ingesters in {{ $labels.cluster }}/{{ $labels.namespace }} ingest too many samples per second.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>avg by (cluster, namespace) (cluster_namespace_pod:cortex_ingester_ingested_samples_total:rate1m) &gt; 80e3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=mimirallocatingtoomuchmemory>MimirAllocatingTooMuchMemory</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_b18942060b>
Copy</button></div><div id=clipboard_b18942060b><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirAllocatingTooMuchMemory</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is using too much memory.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    # We use RSS instead of working set memory because of the ingester&#39;s extensive usage of mmap.
</span></span></span><span style=display:flex><span><span style=color:#d88200>    # See: https://github.com/grafana/mimir/issues/2466
</span></span></span><span style=display:flex><span><span style=color:#d88200>    container_memory_rss{container=&#34;ingester&#34;}
</span></span></span><span style=display:flex><span><span style=color:#d88200>      /
</span></span></span><span style=display:flex><span><span style=color:#d88200>    ( container_spec_memory_limit_bytes{container=&#34;ingester&#34;} &gt; 0 )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 0.65</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=mimirallocatingtoomuchmemory-1>MimirAllocatingTooMuchMemory</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_dcba3db7eb>
Copy</button></div><div id=clipboard_dcba3db7eb><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirAllocatingTooMuchMemory</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is using too much memory.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    # We use RSS instead of working set memory because of the ingester&#39;s extensive usage of mmap.
</span></span></span><span style=display:flex><span><span style=color:#d88200>    # See: https://github.com/grafana/mimir/issues/2466
</span></span></span><span style=display:flex><span><span style=color:#d88200>    container_memory_rss{container=&#34;ingester&#34;}
</span></span></span><span style=display:flex><span><span style=color:#d88200>      /
</span></span></span><span style=display:flex><span><span style=color:#d88200>    ( container_spec_memory_limit_bytes{container=&#34;ingester&#34;} &gt; 0 )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 0.8</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h3 id=ruler_alerts>ruler_alerts</h3><h5 id=mimirrulertoomanyfailedpushes>MimirRulerTooManyFailedPushes</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_aa9ad5fb17>
Copy</button></div><div id=clipboard_aa9ad5fb17><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirRulerTooManyFailedPushes</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Mimir Ruler {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is experiencing {{ printf &#34;%.2f&#34; $value }}% write (push) errors.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  100 * (
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, pod) (rate(cortex_ruler_write_requests_failed_total[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>    /
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, pod) (rate(cortex_ruler_write_requests_total[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 1</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimirrulertoomanyfailedqueries>MimirRulerTooManyFailedQueries</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_aa5adfd82f>
Copy</button></div><div id=clipboard_aa5adfd82f><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirRulerTooManyFailedQueries</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Mimir Ruler {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is experiencing {{ printf &#34;%.2f&#34; $value }}% errors while evaluating rules.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  100 * (
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, pod) (rate(cortex_ruler_queries_failed_total[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>    /
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, pod) (rate(cortex_ruler_queries_total[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 1</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimirrulermissedevaluations>MimirRulerMissedEvaluations</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_0847fe6e5d>
Copy</button></div><div id=clipboard_0847fe6e5d><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirRulerMissedEvaluations</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Mimir Ruler {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is experiencing {{ printf &#34;%.2f&#34; $value }}% missed iterations for the rule group {{ $labels.rule_group }}.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  100 * (
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, pod, rule_group) (rate(cortex_prometheus_rule_group_iterations_missed_total[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>    /
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, pod, rule_group) (rate(cortex_prometheus_rule_group_iterations_total[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 1</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=mimirrulerfailedringcheck>MimirRulerFailedRingCheck</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_267ff8c8f3>
Copy</button></div><div id=clipboard_267ff8c8f3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirRulerFailedRingCheck</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Mimir Rulers in {{ $labels.cluster }}/{{ $labels.namespace }} are experiencing errors when checking the ring for rule group ownership.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, job) (rate(cortex_ruler_ring_check_errors_total[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>     &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h3 id=gossip_alerts>gossip_alerts</h3><h5 id=mimirgossipmembersmismatch>MimirGossipMembersMismatch</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_7f8ee7909d>
Copy</button></div><div id=clipboard_7f8ee7909d><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirGossipMembersMismatch</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir instance {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>sees incorrect number of gossip members.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>avg by (cluster, namespace) (memberlist_client_cluster_members_count) != sum by (cluster, namespace) (up{job=~&#34;.+/(alertmanager|compactor|distributor|ingester.*|querier.*|ruler|ruler-querier.*|store-gateway.*|cortex|mimir)&#34;})</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h3 id=etcd_alerts>etcd_alerts</h3><h5 id=etcdallocatingtoomuchmemory>EtcdAllocatingTooMuchMemory</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_ac1de420dd>
Copy</button></div><div id=clipboard_ac1de420dd><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>EtcdAllocatingTooMuchMemory</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Too much memory being used by {{ $labels.namespace }}/{{ $labels.pod }} - bump memory limit.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    container_memory_working_set_bytes{container=&#34;etcd&#34;}
</span></span></span><span style=display:flex><span><span style=color:#d88200>      /
</span></span></span><span style=display:flex><span><span style=color:#d88200>    ( container_spec_memory_limit_bytes{container=&#34;etcd&#34;} &gt; 0 )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 0.65</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=etcdallocatingtoomuchmemory-1>EtcdAllocatingTooMuchMemory</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_dea894bb2f>
Copy</button></div><div id=clipboard_dea894bb2f><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>EtcdAllocatingTooMuchMemory</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Too much memory being used by {{ $labels.namespace }}/{{ $labels.pod }} - bump memory limit.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    container_memory_working_set_bytes{container=&#34;etcd&#34;}
</span></span></span><span style=display:flex><span><span style=color:#d88200>      /
</span></span></span><span style=display:flex><span><span style=color:#d88200>    ( container_spec_memory_limit_bytes{container=&#34;etcd&#34;} &gt; 0 )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 0.8</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h3 id=alertmanager_alerts>alertmanager_alerts</h3><h5 id=mimiralertmanagersyncconfigsfailing>MimirAlertmanagerSyncConfigsFailing</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_63e80cb5a4>
Copy</button></div><div id=clipboard_63e80cb5a4><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirAlertmanagerSyncConfigsFailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Mimir Alertmanager {{ $labels.job }}/{{ $labels.pod }} is failing to read tenant configurations from storage.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>rate(cortex_alertmanager_sync_configs_failed_total[5m]) &gt; 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>30m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimiralertmanagerringcheckfailing>MimirAlertmanagerRingCheckFailing</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_a35990f9d1>
Copy</button></div><div id=clipboard_a35990f9d1><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirAlertmanagerRingCheckFailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Mimir Alertmanager {{ $labels.job }}/{{ $labels.pod }} is unable to check tenants ownership via the ring.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>rate(cortex_alertmanager_ring_check_errors_total[2m]) &gt; 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>10m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimiralertmanagerpartialstatemergefailing>MimirAlertmanagerPartialStateMergeFailing</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_de7677817c>
Copy</button></div><div id=clipboard_de7677817c><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirAlertmanagerPartialStateMergeFailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Mimir Alertmanager {{ $labels.job }}/{{ $labels.pod }} is failing to merge partial state changes received from a replica.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>rate(cortex_alertmanager_partial_state_merges_failed_total[2m]) &gt; 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>10m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimiralertmanagerreplicationfailing>MimirAlertmanagerReplicationFailing</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_6606442364>
Copy</button></div><div id=clipboard_6606442364><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirAlertmanagerReplicationFailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Mimir Alertmanager {{ $labels.job }}/{{ $labels.pod }} is failing to replicating partial state to its replicas.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>rate(cortex_alertmanager_state_replication_failed_total[2m]) &gt; 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>10m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimiralertmanagerpersiststatefailing>MimirAlertmanagerPersistStateFailing</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_1eefc80099>
Copy</button></div><div id=clipboard_1eefc80099><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirAlertmanagerPersistStateFailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Mimir Alertmanager {{ $labels.job }}/{{ $labels.pod }} is unable to persist full state snaphots to remote storage.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>rate(cortex_alertmanager_state_persist_failed_total[15m]) &gt; 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>1h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimiralertmanagerinitialsyncfailed>MimirAlertmanagerInitialSyncFailed</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_2f9f449dde>
Copy</button></div><div id=clipboard_2f9f449dde><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirAlertmanagerInitialSyncFailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Mimir Alertmanager {{ $labels.job }}/{{ $labels.pod }} was unable to obtain some initial state when starting up.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>increase(cortex_alertmanager_state_initial_sync_completed_total{outcome=&#34;failed&#34;}[1m]) &gt; 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimiralertmanagerallocatingtoomuchmemory>MimirAlertmanagerAllocatingTooMuchMemory</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_185b7381e1>
Copy</button></div><div id=clipboard_185b7381e1><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirAlertmanagerAllocatingTooMuchMemory</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Alertmanager {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is using too much memory.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (container_memory_working_set_bytes{container=&#34;alertmanager&#34;} / container_spec_memory_limit_bytes{container=&#34;alertmanager&#34;}) &gt; 0.80
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (container_spec_memory_limit_bytes{container=&#34;alertmanager&#34;} &gt; 0)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=mimiralertmanagerallocatingtoomuchmemory-1>MimirAlertmanagerAllocatingTooMuchMemory</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_13c12403c3>
Copy</button></div><div id=clipboard_13c12403c3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirAlertmanagerAllocatingTooMuchMemory</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    </span>    <span style=color:#ae81ff>Alertmanager {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is using too much memory.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (container_memory_working_set_bytes{container=&#34;alertmanager&#34;} / container_spec_memory_limit_bytes{container=&#34;alertmanager&#34;}) &gt; 0.90
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (container_spec_memory_limit_bytes{container=&#34;alertmanager&#34;} &gt; 0)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h3 id=mimir_blocks_alerts>mimir_blocks_alerts</h3><h5 id=mimiringesterhasnotshippedblocks>MimirIngesterHasNotShippedBlocks</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_ab1e95c5d0>
Copy</button></div><div id=clipboard_ab1e95c5d0><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirIngesterHasNotShippedBlocks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir Ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>has not shipped any block in the last 4 hours.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (min by(cluster, namespace, pod) (time() - thanos_objstore_bucket_last_successful_upload_time{job=~&#34;.+/ingester.*&#34;}) &gt; 60 * 60 * 4)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (max by(cluster, namespace, pod) (thanos_objstore_bucket_last_successful_upload_time{job=~&#34;.+/ingester.*&#34;}) &gt; 0)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # Only if the ingester has ingested samples over the last 4h.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (max by(cluster, namespace, pod) (max_over_time(cluster_namespace_pod:cortex_ingester_ingested_samples_total:rate1m[4h])) &gt; 0)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # Only if the ingester was ingesting samples 4h ago. This protects against the case where the ingester replica
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # had ingested samples in the past, then no traffic was received for a long period and then it starts
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # receiving samples again. Without this check, the alert would fire as soon as it gets back receiving
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # samples, while the a block shipping is expected within the next 4h.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (max by(cluster, namespace, pod) (max_over_time(cluster_namespace_pod:cortex_ingester_ingested_samples_total:rate1m[1h] offset 4h)) &gt; 0)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimiringesterhasnotshippedblockssincestart>MimirIngesterHasNotShippedBlocksSinceStart</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_842f3c858c>
Copy</button></div><div id=clipboard_842f3c858c><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirIngesterHasNotShippedBlocksSinceStart</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir Ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>has not shipped any block in the last 4 hours.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (max by(cluster, namespace, pod) (thanos_objstore_bucket_last_successful_upload_time{job=~&#34;.+/ingester.*&#34;}) == 0)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (max by(cluster, namespace, pod) (max_over_time(cluster_namespace_pod:cortex_ingester_ingested_samples_total:rate1m[4h])) &gt; 0)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>4h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimiringesterhasunshippedblocks>MimirIngesterHasUnshippedBlocks</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_dd5c7a7d56>
Copy</button></div><div id=clipboard_dd5c7a7d56><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirIngesterHasUnshippedBlocks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir Ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>has compacted a block {{ $value | humanizeDuration }} ago but it hasn&#39;t been</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>successfully uploaded to the storage yet.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (time() - cortex_ingester_oldest_unshipped_block_timestamp_seconds &gt; 3600)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (cortex_ingester_oldest_unshipped_block_timestamp_seconds &gt; 0)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimiringestertsdbheadcompactionfailed>MimirIngesterTSDBHeadCompactionFailed</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_5f013b0364>
Copy</button></div><div id=clipboard_5f013b0364><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirIngesterTSDBHeadCompactionFailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir Ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>is failing to compact TSDB head.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>rate(cortex_ingester_tsdb_compactions_failed_total[5m]) &gt; 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimiringestertsdbheadtruncationfailed>MimirIngesterTSDBHeadTruncationFailed</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_4da86b6bfe>
Copy</button></div><div id=clipboard_4da86b6bfe><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirIngesterTSDBHeadTruncationFailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir Ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>is failing to truncate TSDB head.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>rate(cortex_ingester_tsdb_head_truncations_failed_total[5m]) &gt; 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimiringestertsdbcheckpointcreationfailed>MimirIngesterTSDBCheckpointCreationFailed</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_c89888dc81>
Copy</button></div><div id=clipboard_c89888dc81><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirIngesterTSDBCheckpointCreationFailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir Ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>is failing to create TSDB checkpoint.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>rate(cortex_ingester_tsdb_checkpoint_creations_failed_total[5m]) &gt; 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimiringestertsdbcheckpointdeletionfailed>MimirIngesterTSDBCheckpointDeletionFailed</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_1c15dbece3>
Copy</button></div><div id=clipboard_1c15dbece3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirIngesterTSDBCheckpointDeletionFailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir Ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>is failing to delete TSDB checkpoint.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>rate(cortex_ingester_tsdb_checkpoint_deletions_failed_total[5m]) &gt; 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimiringestertsdbwaltruncationfailed>MimirIngesterTSDBWALTruncationFailed</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_bca08604fc>
Copy</button></div><div id=clipboard_bca08604fc><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirIngesterTSDBWALTruncationFailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir Ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>is failing to truncate TSDB WAL.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>rate(cortex_ingester_tsdb_wal_truncations_failed_total[5m]) &gt; 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=mimiringestertsdbwalcorrupted>MimirIngesterTSDBWALCorrupted</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_03c395918e>
Copy</button></div><div id=clipboard_03c395918e><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirIngesterTSDBWALCorrupted</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir Ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>got a corrupted TSDB WAL.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>rate(cortex_ingester_tsdb_wal_corruptions_total[5m]) &gt; 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimiringestertsdbwalwritesfailed>MimirIngesterTSDBWALWritesFailed</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_0e3b206a69>
Copy</button></div><div id=clipboard_0e3b206a69><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirIngesterTSDBWALWritesFailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir Ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>is failing to write to TSDB WAL.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>rate(cortex_ingester_tsdb_wal_writes_failed_total[1m]) &gt; 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>3m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimirquerierhasnotscanthebucket>MimirQuerierHasNotScanTheBucket</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_ea139ac490>
Copy</button></div><div id=clipboard_ea139ac490><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirQuerierHasNotScanTheBucket</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir Querier {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>has not successfully scanned the bucket since {{ $value | humanizeDuration</span>
</span></span><span style=display:flex><span>    }}<span style=color:#ae81ff>.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (time() - cortex_querier_blocks_last_successful_scan_timestamp_seconds &gt; 60 * 30)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  cortex_querier_blocks_last_successful_scan_timestamp_seconds &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimirquerierhighrefetchrate>MimirQuerierHighRefetchRate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_02c1961f74>
Copy</button></div><div id=clipboard_02c1961f74><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirQuerierHighRefetchRate</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir Queries in {{ $labels.cluster }}/{{ $labels.namespace }} are refetching</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>series from different store-gateways (because of missing blocks) for the {{ printf</span>
</span></span><span style=display:flex><span>    <span style=color:#d88200>&#34;%.0f&#34;</span> <span style=color:#ae81ff>$value }}% of queries.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  100 * (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      sum by(cluster, namespace) (rate(cortex_querier_storegateway_refetches_per_query_count[5m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>      -
</span></span></span><span style=display:flex><span><span style=color:#d88200>      sum by(cluster, namespace) (rate(cortex_querier_storegateway_refetches_per_query_bucket{le=&#34;0.0&#34;}[5m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>    /
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by(cluster, namespace) (rate(cortex_querier_storegateway_refetches_per_query_count[5m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  &gt; 1</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>10m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=mimirstoregatewayhasnotsyncthebucket>MimirStoreGatewayHasNotSyncTheBucket</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_b201fe922b>
Copy</button></div><div id=clipboard_b201fe922b><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirStoreGatewayHasNotSyncTheBucket</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir store-gateway {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>has not successfully synched the bucket since {{ $value | humanizeDuration</span>
</span></span><span style=display:flex><span>    }}<span style=color:#ae81ff>.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (time() - cortex_bucket_stores_blocks_last_successful_sync_timestamp_seconds{component=&#34;store-gateway&#34;} &gt; 60 * 30)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  cortex_bucket_stores_blocks_last_successful_sync_timestamp_seconds{component=&#34;store-gateway&#34;} &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimirstoregatewaynosyncedtenants>MimirStoreGatewayNoSyncedTenants</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_be42dba6c2>
Copy</button></div><div id=clipboard_be42dba6c2><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirStoreGatewayNoSyncedTenants</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir store-gateway {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>is not syncing any blocks for any tenant.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>min by(cluster, namespace, pod) (cortex_bucket_stores_tenants_synced{component=&#34;store-gateway&#34;}) == 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>1h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=mimirbucketindexnotupdated>MimirBucketIndexNotUpdated</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_43b5c232f9>
Copy</button></div><div id=clipboard_43b5c232f9><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirBucketIndexNotUpdated</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir bucket index for tenant {{ $labels.user }} in {{ $labels.cluster</span>
</span></span><span style=display:flex><span>    }}<span style=color:#ae81ff>/{{ $labels.namespace }} has not been updated since {{ $value | humanizeDuration</span>
</span></span><span style=display:flex><span>    }}<span style=color:#ae81ff>.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>min by(cluster, namespace, user) (time() - cortex_bucket_index_last_successful_update_timestamp_seconds) &gt; 7200</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimirtenanthaspartialblocks>MimirTenantHasPartialBlocks</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_a6b3886907>
Copy</button></div><div id=clipboard_a6b3886907><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirTenantHasPartialBlocks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir tenant {{ $labels.user }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>has {{ $value }} partial blocks.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>max by(cluster, namespace, user) (cortex_bucket_blocks_partials_count) &gt; 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>6h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h3 id=mimir_compactor_alerts>mimir_compactor_alerts</h3><h5 id=mimircompactorhasnotsuccessfullycleanedupblocks>MimirCompactorHasNotSuccessfullyCleanedUpBlocks</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_72d2d5112b>
Copy</button></div><div id=clipboard_72d2d5112b><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirCompactorHasNotSuccessfullyCleanedUpBlocks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir Compactor {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>has not successfully cleaned up blocks in the last 6 hours.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>(time() - cortex_compactor_block_cleanup_last_successful_run_timestamp_seconds &gt; 60 * 60 * 6)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>1h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimircompactorhasnotsuccessfullyruncompaction>MimirCompactorHasNotSuccessfullyRunCompaction</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_b7744840f3>
Copy</button></div><div id=clipboard_b7744840f3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirCompactorHasNotSuccessfullyRunCompaction</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir Compactor {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>has not run compaction in the last 24 hours.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (time() - cortex_compactor_last_successful_run_timestamp_seconds &gt; 60 * 60 * 24)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (cortex_compactor_last_successful_run_timestamp_seconds &gt; 0)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>1h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reason</span><span style=color:#111>:</span> <span style=color:#ae81ff>in-last-24h</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimircompactorhasnotsuccessfullyruncompaction-1>MimirCompactorHasNotSuccessfullyRunCompaction</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_d81799c71a>
Copy</button></div><div id=clipboard_d81799c71a><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirCompactorHasNotSuccessfullyRunCompaction</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir Compactor {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>has not run compaction in the last 24 hours.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>cortex_compactor_last_successful_run_timestamp_seconds == 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>24h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reason</span><span style=color:#111>:</span> <span style=color:#ae81ff>since-startup</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimircompactorhasnotsuccessfullyruncompaction-2>MimirCompactorHasNotSuccessfullyRunCompaction</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_3684b5dd70>
Copy</button></div><div id=clipboard_3684b5dd70><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirCompactorHasNotSuccessfullyRunCompaction</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir Compactor {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>failed to run 2 consecutive compactions.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>increase(cortex_compactor_runs_failed_total[2h]) &gt;= 2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reason</span><span style=color:#111>:</span> <span style=color:#ae81ff>consecutive-failures</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimircompactorhasnotuploadedblocks>MimirCompactorHasNotUploadedBlocks</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_01e8812039>
Copy</button></div><div id=clipboard_01e8812039><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirCompactorHasNotUploadedBlocks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir Compactor {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>has not uploaded any block in the last 24 hours.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (time() - thanos_objstore_bucket_last_successful_upload_time{component=&#34;compactor&#34;} &gt; 60 * 60 * 24)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (thanos_objstore_bucket_last_successful_upload_time{component=&#34;compactor&#34;} &gt; 0)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimircompactorhasnotuploadedblocks-1>MimirCompactorHasNotUploadedBlocks</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_806fb034d9>
Copy</button></div><div id=clipboard_806fb034d9><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirCompactorHasNotUploadedBlocks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir Compactor {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>has not uploaded any block in the last 24 hours.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>thanos_objstore_bucket_last_successful_upload_time{component=&#34;compactor&#34;} == 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>24h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=mimircompactorskippedblockswithoutoforderchunks>MimirCompactorSkippedBlocksWithOutOfOrderChunks</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_69b57d0853>
Copy</button></div><div id=clipboard_69b57d0853><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirCompactorSkippedBlocksWithOutOfOrderChunks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir Compactor {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>has found and ignored blocks with out of order chunks.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>increase(cortex_compactor_blocks_marked_for_no_compaction_total{component=&#34;compactor&#34;, reason=&#34;block-index-out-of-order-chunk&#34;}[5m]) &gt; 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>1m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h3 id=mimir_autoscaling_querier>mimir_autoscaling_querier</h3><h5 id=mimirquerierautoscalernotactive>MimirQuerierAutoscalerNotActive</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_11502fcbc8>
Copy</button></div><div id=clipboard_11502fcbc8><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirQuerierAutoscalerNotActive</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>The Horizontal Pod Autoscaler (HPA) {{ $labels.horizontalpodautoscaler</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>in {{ $labels.namespace }} is not active.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  kube_horizontalpodautoscaler_status_condition{horizontalpodautoscaler=~&#34;(keda-hpa-querier)|(keda-hpa-ruler-querier)&#34;,condition=&#34;ScalingActive&#34;,status=&#34;false&#34;}
</span></span></span><span style=display:flex><span><span style=color:#d88200>  * on(cluster, namespace) group_left max by(cluster, namespace) (cortex_build_info)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>1h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h3 id=mimir_continuous_test>mimir_continuous_test</h3><h5 id=mimircontinuoustestnotrunningonwrites>MimirContinuousTestNotRunningOnWrites</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_859e0e60eb>
Copy</button></div><div id=clipboard_859e0e60eb><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirContinuousTestNotRunningOnWrites</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir continuous test {{ $labels.test }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>is not effectively running because writes are failing.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum by(cluster, namespace, test) (rate(mimir_continuous_test_writes_failed_total[5m])) &gt; 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>1h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=mimircontinuoustestnotrunningonreads>MimirContinuousTestNotRunningOnReads</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_dcdeddba7f>
Copy</button></div><div id=clipboard_dcdeddba7f><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirContinuousTestNotRunningOnReads</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir continuous test {{ $labels.test }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>is not effectively running because queries are failing.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum by(cluster, namespace, test) (rate(mimir_continuous_test_queries_failed_total[5m])) &gt; 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>1h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=mimircontinuoustestfailed>MimirContinuousTestFailed</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_3cc8f2a6bd>
Copy</button></div><div id=clipboard_3cc8f2a6bd><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MimirContinuousTestFailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Mimir continuous test {{ $labels.test }} in {{ $labels.cluster }}/{{ $labels.namespace</span>
</span></span><span style=display:flex><span>    }} <span style=color:#ae81ff>failed when asserting query results.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum by(cluster, namespace, test) (rate(mimir_continuous_test_query_result_checks_failed_total[10m])) &gt; 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h2 id=recording-rules>Recording rules</h2><div class="card my-3 border-top-0 border-right-0 border-bottom-0 border-left border-warning rounded" style=border-width:4px!important><div class="wrap border border-left-0 rounded"><div class="card-body pt-1">Complete list of pregenerated recording rules is available <a href=https://github.com/observeproject/sites/blob/main/assets/mimir/rules.yaml>here</a>.</div></div></div><h3 id=mimir_api_1>mimir_api_1</h3><h5 id=cluster_jobcortex_request_duration_seconds99quantile>cluster_job:cortex_request_duration_seconds:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_e13628c31a>
Copy</button></div><div id=clipboard_e13628c31a><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_request_duration_seconds_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_request_duration_seconds:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_request_duration_seconds50quantile>cluster_job:cortex_request_duration_seconds:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_22eab08d84>
Copy</button></div><div id=clipboard_22eab08d84><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_request_duration_seconds_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_request_duration_seconds:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_request_duration_secondsavg>cluster_job:cortex_request_duration_seconds:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_2858741b95>
Copy</button></div><div id=clipboard_2858741b95><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds_sum[1m])) by (cluster, job) / sum(rate(cortex_request_duration_seconds_count[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_request_duration_seconds:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_request_duration_seconds_bucketsum_rate>cluster_job:cortex_request_duration_seconds_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_7e06e22c31>
Copy</button></div><div id=clipboard_7e06e22c31><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds_bucket[1m])) by (le, cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_request_duration_seconds_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_request_duration_seconds_sumsum_rate>cluster_job:cortex_request_duration_seconds_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_7f3bbe92bd>
Copy</button></div><div id=clipboard_7f3bbe92bd><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds_sum[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_request_duration_seconds_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_request_duration_seconds_countsum_rate>cluster_job:cortex_request_duration_seconds_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_51a7c37000>
Copy</button></div><div id=clipboard_51a7c37000><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_request_duration_seconds_count:sum_rate</span>
</span></span></code></pre></div></div></div><h3 id=mimir_api_2>mimir_api_2</h3><h5 id=cluster_job_routecortex_request_duration_seconds99quantile>cluster_job_route:cortex_request_duration_seconds:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_0941348072>
Copy</button></div><div id=clipboard_0941348072><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_request_duration_seconds_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job, route))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_request_duration_seconds:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_routecortex_request_duration_seconds50quantile>cluster_job_route:cortex_request_duration_seconds:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_1cc35d07c4>
Copy</button></div><div id=clipboard_1cc35d07c4><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_request_duration_seconds_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job, route))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_request_duration_seconds:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_routecortex_request_duration_secondsavg>cluster_job_route:cortex_request_duration_seconds:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_2b5000f33d>
Copy</button></div><div id=clipboard_2b5000f33d><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds_sum[1m])) by (cluster, job, route)</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>/ sum(rate(cortex_request_duration_seconds_count[1m])) by (cluster, job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_request_duration_seconds:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_routecortex_request_duration_seconds_bucketsum_rate>cluster_job_route:cortex_request_duration_seconds_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_1fc515273f>
Copy</button></div><div id=clipboard_1fc515273f><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds_bucket[1m])) by (le, cluster, job,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_request_duration_seconds_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_routecortex_request_duration_seconds_sumsum_rate>cluster_job_route:cortex_request_duration_seconds_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_ffb86f54a1>
Copy</button></div><div id=clipboard_ffb86f54a1><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds_sum[1m])) by (cluster, job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_request_duration_seconds_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_routecortex_request_duration_seconds_countsum_rate>cluster_job_route:cortex_request_duration_seconds_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_774cf15841>
Copy</button></div><div id=clipboard_774cf15841><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds_count[1m])) by (cluster, job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_request_duration_seconds_count:sum_rate</span>
</span></span></code></pre></div></div></div><h3 id=mimir_api_3>mimir_api_3</h3><h5 id=cluster_namespace_job_routecortex_request_duration_seconds99quantile>cluster_namespace_job_route:cortex_request_duration_seconds:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_f0afa3374b>
Copy</button></div><div id=clipboard_f0afa3374b><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_request_duration_seconds_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, namespace, job, route))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_request_duration_seconds:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routecortex_request_duration_seconds50quantile>cluster_namespace_job_route:cortex_request_duration_seconds:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_234670e764>
Copy</button></div><div id=clipboard_234670e764><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_request_duration_seconds_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, namespace, job, route))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_request_duration_seconds:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routecortex_request_duration_secondsavg>cluster_namespace_job_route:cortex_request_duration_seconds:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_009c822e21>
Copy</button></div><div id=clipboard_009c822e21><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds_sum[1m])) by (cluster, namespace, job,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>route) / sum(rate(cortex_request_duration_seconds_count[1m])) by (cluster, namespace,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_request_duration_seconds:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routecortex_request_duration_seconds_bucketsum_rate>cluster_namespace_job_route:cortex_request_duration_seconds_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_c90bae4b87>
Copy</button></div><div id=clipboard_c90bae4b87><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds_bucket[1m])) by (le, cluster, namespace,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_request_duration_seconds_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routecortex_request_duration_seconds_sumsum_rate>cluster_namespace_job_route:cortex_request_duration_seconds_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_ba79f28abd>
Copy</button></div><div id=clipboard_ba79f28abd><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds_sum[1m])) by (cluster, namespace, job,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_request_duration_seconds_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routecortex_request_duration_seconds_countsum_rate>cluster_namespace_job_route:cortex_request_duration_seconds_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_96d09f1eeb>
Copy</button></div><div id=clipboard_96d09f1eeb><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds_count[1m])) by (cluster, namespace,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_request_duration_seconds_count:sum_rate</span>
</span></span></code></pre></div></div></div><h3 id=mimir_querier_api>mimir_querier_api</h3><h5 id=cluster_jobcortex_querier_request_duration_seconds99quantile>cluster_job:cortex_querier_request_duration_seconds:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_008b62f4f1>
Copy</button></div><div id=clipboard_008b62f4f1><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_querier_request_duration_seconds_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_querier_request_duration_seconds:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_querier_request_duration_seconds50quantile>cluster_job:cortex_querier_request_duration_seconds:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_928f33bdc3>
Copy</button></div><div id=clipboard_928f33bdc3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_querier_request_duration_seconds_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_querier_request_duration_seconds:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_querier_request_duration_secondsavg>cluster_job:cortex_querier_request_duration_seconds:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_fd326e0210>
Copy</button></div><div id=clipboard_fd326e0210><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_querier_request_duration_seconds_sum[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>/ sum(rate(cortex_querier_request_duration_seconds_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_querier_request_duration_seconds:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_querier_request_duration_seconds_bucketsum_rate>cluster_job:cortex_querier_request_duration_seconds_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_fe08b7a413>
Copy</button></div><div id=clipboard_fe08b7a413><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_querier_request_duration_seconds_bucket[1m])) by (le, cluster,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_querier_request_duration_seconds_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_querier_request_duration_seconds_sumsum_rate>cluster_job:cortex_querier_request_duration_seconds_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_3d4163220d>
Copy</button></div><div id=clipboard_3d4163220d><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_querier_request_duration_seconds_sum[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_querier_request_duration_seconds_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_querier_request_duration_seconds_countsum_rate>cluster_job:cortex_querier_request_duration_seconds_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_a719c8ea94>
Copy</button></div><div id=clipboard_a719c8ea94><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_querier_request_duration_seconds_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_querier_request_duration_seconds_count:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_routecortex_querier_request_duration_seconds99quantile>cluster_job_route:cortex_querier_request_duration_seconds:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_b3d9a9f8a9>
Copy</button></div><div id=clipboard_b3d9a9f8a9><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_querier_request_duration_seconds_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job, route))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_querier_request_duration_seconds:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_routecortex_querier_request_duration_seconds50quantile>cluster_job_route:cortex_querier_request_duration_seconds:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_43a1c73ae3>
Copy</button></div><div id=clipboard_43a1c73ae3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_querier_request_duration_seconds_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job, route))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_querier_request_duration_seconds:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_routecortex_querier_request_duration_secondsavg>cluster_job_route:cortex_querier_request_duration_seconds:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_b4b79afe55>
Copy</button></div><div id=clipboard_b4b79afe55><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_querier_request_duration_seconds_sum[1m])) by (cluster, job,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>route) / sum(rate(cortex_querier_request_duration_seconds_count[1m])) by (cluster,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_querier_request_duration_seconds:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_routecortex_querier_request_duration_seconds_bucketsum_rate>cluster_job_route:cortex_querier_request_duration_seconds_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_6fd410eaff>
Copy</button></div><div id=clipboard_6fd410eaff><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_querier_request_duration_seconds_bucket[1m])) by (le, cluster,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_querier_request_duration_seconds_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_routecortex_querier_request_duration_seconds_sumsum_rate>cluster_job_route:cortex_querier_request_duration_seconds_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_a77ac5b292>
Copy</button></div><div id=clipboard_a77ac5b292><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_querier_request_duration_seconds_sum[1m])) by (cluster, job,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_querier_request_duration_seconds_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_routecortex_querier_request_duration_seconds_countsum_rate>cluster_job_route:cortex_querier_request_duration_seconds_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_74d62e5b5f>
Copy</button></div><div id=clipboard_74d62e5b5f><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_querier_request_duration_seconds_count[1m])) by (cluster, job,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_querier_request_duration_seconds_count:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routecortex_querier_request_duration_seconds99quantile>cluster_namespace_job_route:cortex_querier_request_duration_seconds:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_c54a15b6d2>
Copy</button></div><div id=clipboard_c54a15b6d2><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_querier_request_duration_seconds_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, namespace, job, route))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_querier_request_duration_seconds:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routecortex_querier_request_duration_seconds50quantile>cluster_namespace_job_route:cortex_querier_request_duration_seconds:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_36e052737c>
Copy</button></div><div id=clipboard_36e052737c><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_querier_request_duration_seconds_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, namespace, job, route))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_querier_request_duration_seconds:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routecortex_querier_request_duration_secondsavg>cluster_namespace_job_route:cortex_querier_request_duration_seconds:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_82675f3982>
Copy</button></div><div id=clipboard_82675f3982><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_querier_request_duration_seconds_sum[1m])) by (cluster, namespace,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>job, route) / sum(rate(cortex_querier_request_duration_seconds_count[1m])) by (cluster,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>namespace, job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_querier_request_duration_seconds:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routecortex_querier_request_duration_seconds_bucketsum_rate>cluster_namespace_job_route:cortex_querier_request_duration_seconds_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_607e758426>
Copy</button></div><div id=clipboard_607e758426><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_querier_request_duration_seconds_bucket[1m])) by (le, cluster,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>namespace, job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_querier_request_duration_seconds_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routecortex_querier_request_duration_seconds_sumsum_rate>cluster_namespace_job_route:cortex_querier_request_duration_seconds_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_0f1a029407>
Copy</button></div><div id=clipboard_0f1a029407><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_querier_request_duration_seconds_sum[1m])) by (cluster, namespace,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_querier_request_duration_seconds_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routecortex_querier_request_duration_seconds_countsum_rate>cluster_namespace_job_route:cortex_querier_request_duration_seconds_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_f6ae276d9d>
Copy</button></div><div id=clipboard_f6ae276d9d><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_querier_request_duration_seconds_count[1m])) by (cluster, namespace,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_querier_request_duration_seconds_count:sum_rate</span>
</span></span></code></pre></div></div></div><h3 id=mimir_cache>mimir_cache</h3><h5 id=cluster_job_methodcortex_memcache_request_duration_seconds99quantile>cluster_job_method:cortex_memcache_request_duration_seconds:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_1e6c998fac>
Copy</button></div><div id=clipboard_1e6c998fac><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_memcache_request_duration_seconds_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job, method))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_method:cortex_memcache_request_duration_seconds:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_methodcortex_memcache_request_duration_seconds50quantile>cluster_job_method:cortex_memcache_request_duration_seconds:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_13d978a299>
Copy</button></div><div id=clipboard_13d978a299><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_memcache_request_duration_seconds_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job, method))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_method:cortex_memcache_request_duration_seconds:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_methodcortex_memcache_request_duration_secondsavg>cluster_job_method:cortex_memcache_request_duration_seconds:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_90a6fc2921>
Copy</button></div><div id=clipboard_90a6fc2921><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_memcache_request_duration_seconds_sum[1m])) by (cluster, job,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>method) / sum(rate(cortex_memcache_request_duration_seconds_count[1m])) by (cluster,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>job, method)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_method:cortex_memcache_request_duration_seconds:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_methodcortex_memcache_request_duration_seconds_bucketsum_rate>cluster_job_method:cortex_memcache_request_duration_seconds_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_be42507904>
Copy</button></div><div id=clipboard_be42507904><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_memcache_request_duration_seconds_bucket[1m])) by (le, cluster,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>job, method)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_method:cortex_memcache_request_duration_seconds_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_methodcortex_memcache_request_duration_seconds_sumsum_rate>cluster_job_method:cortex_memcache_request_duration_seconds_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_5536935291>
Copy</button></div><div id=clipboard_5536935291><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_memcache_request_duration_seconds_sum[1m])) by (cluster, job,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>method)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_method:cortex_memcache_request_duration_seconds_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_methodcortex_memcache_request_duration_seconds_countsum_rate>cluster_job_method:cortex_memcache_request_duration_seconds_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_785cad401b>
Copy</button></div><div id=clipboard_785cad401b><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_memcache_request_duration_seconds_count[1m])) by (cluster, job,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>method)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_method:cortex_memcache_request_duration_seconds_count:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_cache_request_duration_seconds99quantile>cluster_job:cortex_cache_request_duration_seconds:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_89ef0ced6e>
Copy</button></div><div id=clipboard_89ef0ced6e><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_cache_request_duration_seconds_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_cache_request_duration_seconds:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_cache_request_duration_seconds50quantile>cluster_job:cortex_cache_request_duration_seconds:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_f20383908b>
Copy</button></div><div id=clipboard_f20383908b><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_cache_request_duration_seconds_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_cache_request_duration_seconds:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_cache_request_duration_secondsavg>cluster_job:cortex_cache_request_duration_seconds:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_afb0465e16>
Copy</button></div><div id=clipboard_afb0465e16><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_cache_request_duration_seconds_sum[1m])) by (cluster, job) /</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>sum(rate(cortex_cache_request_duration_seconds_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_cache_request_duration_seconds:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_cache_request_duration_seconds_bucketsum_rate>cluster_job:cortex_cache_request_duration_seconds_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_ba4c4f0547>
Copy</button></div><div id=clipboard_ba4c4f0547><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_cache_request_duration_seconds_bucket[1m])) by (le, cluster,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_cache_request_duration_seconds_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_cache_request_duration_seconds_sumsum_rate>cluster_job:cortex_cache_request_duration_seconds_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_3816d024a6>
Copy</button></div><div id=clipboard_3816d024a6><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_cache_request_duration_seconds_sum[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_cache_request_duration_seconds_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_cache_request_duration_seconds_countsum_rate>cluster_job:cortex_cache_request_duration_seconds_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_2415774cfd>
Copy</button></div><div id=clipboard_2415774cfd><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_cache_request_duration_seconds_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_cache_request_duration_seconds_count:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_methodcortex_cache_request_duration_seconds99quantile>cluster_job_method:cortex_cache_request_duration_seconds:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_59dc193666>
Copy</button></div><div id=clipboard_59dc193666><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_cache_request_duration_seconds_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job, method))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_method:cortex_cache_request_duration_seconds:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_methodcortex_cache_request_duration_seconds50quantile>cluster_job_method:cortex_cache_request_duration_seconds:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_3c8d2a3a07>
Copy</button></div><div id=clipboard_3c8d2a3a07><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_cache_request_duration_seconds_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job, method))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_method:cortex_cache_request_duration_seconds:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_methodcortex_cache_request_duration_secondsavg>cluster_job_method:cortex_cache_request_duration_seconds:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_571059f932>
Copy</button></div><div id=clipboard_571059f932><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_cache_request_duration_seconds_sum[1m])) by (cluster, job, method)</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>/ sum(rate(cortex_cache_request_duration_seconds_count[1m])) by (cluster, job, method)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_method:cortex_cache_request_duration_seconds:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_methodcortex_cache_request_duration_seconds_bucketsum_rate>cluster_job_method:cortex_cache_request_duration_seconds_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_4d1d177c25>
Copy</button></div><div id=clipboard_4d1d177c25><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_cache_request_duration_seconds_bucket[1m])) by (le, cluster,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>job, method)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_method:cortex_cache_request_duration_seconds_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_methodcortex_cache_request_duration_seconds_sumsum_rate>cluster_job_method:cortex_cache_request_duration_seconds_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_158458e703>
Copy</button></div><div id=clipboard_158458e703><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_cache_request_duration_seconds_sum[1m])) by (cluster, job, method)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_method:cortex_cache_request_duration_seconds_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_methodcortex_cache_request_duration_seconds_countsum_rate>cluster_job_method:cortex_cache_request_duration_seconds_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_7aa9f30acc>
Copy</button></div><div id=clipboard_7aa9f30acc><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_cache_request_duration_seconds_count[1m])) by (cluster, job,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>method)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_method:cortex_cache_request_duration_seconds_count:sum_rate</span>
</span></span></code></pre></div></div></div><h3 id=mimir_storage>mimir_storage</h3><h5 id=cluster_jobcortex_kv_request_duration_seconds99quantile>cluster_job:cortex_kv_request_duration_seconds:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_dda73799cd>
Copy</button></div><div id=clipboard_dda73799cd><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_kv_request_duration_seconds_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_kv_request_duration_seconds:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_kv_request_duration_seconds50quantile>cluster_job:cortex_kv_request_duration_seconds:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_e0004af2ec>
Copy</button></div><div id=clipboard_e0004af2ec><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_kv_request_duration_seconds_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_kv_request_duration_seconds:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_kv_request_duration_secondsavg>cluster_job:cortex_kv_request_duration_seconds:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_2430eaa90e>
Copy</button></div><div id=clipboard_2430eaa90e><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_kv_request_duration_seconds_sum[1m])) by (cluster, job) / sum(rate(cortex_kv_request_duration_seconds_count[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_kv_request_duration_seconds:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_kv_request_duration_seconds_bucketsum_rate>cluster_job:cortex_kv_request_duration_seconds_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_a2c4e4452b>
Copy</button></div><div id=clipboard_a2c4e4452b><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_kv_request_duration_seconds_bucket[1m])) by (le, cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_kv_request_duration_seconds_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_kv_request_duration_seconds_sumsum_rate>cluster_job:cortex_kv_request_duration_seconds_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_c31a400f2a>
Copy</button></div><div id=clipboard_c31a400f2a><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_kv_request_duration_seconds_sum[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_kv_request_duration_seconds_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_kv_request_duration_seconds_countsum_rate>cluster_job:cortex_kv_request_duration_seconds_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_4245c9d0e8>
Copy</button></div><div id=clipboard_4245c9d0e8><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_kv_request_duration_seconds_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_kv_request_duration_seconds_count:sum_rate</span>
</span></span></code></pre></div></div></div><h3 id=mimir_queries>mimir_queries</h3><h5 id=cluster_jobcortex_query_frontend_retries99quantile>cluster_job:cortex_query_frontend_retries:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_4505806675>
Copy</button></div><div id=clipboard_4505806675><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_query_frontend_retries_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_query_frontend_retries:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_query_frontend_retries50quantile>cluster_job:cortex_query_frontend_retries:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_16ebd3a1b0>
Copy</button></div><div id=clipboard_16ebd3a1b0><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_query_frontend_retries_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_query_frontend_retries:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_query_frontend_retriesavg>cluster_job:cortex_query_frontend_retries:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_3e78c9041d>
Copy</button></div><div id=clipboard_3e78c9041d><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_query_frontend_retries_sum[1m])) by (cluster, job) / sum(rate(cortex_query_frontend_retries_count[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_query_frontend_retries:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_query_frontend_retries_bucketsum_rate>cluster_job:cortex_query_frontend_retries_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_bb334618a7>
Copy</button></div><div id=clipboard_bb334618a7><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_query_frontend_retries_bucket[1m])) by (le, cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_query_frontend_retries_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_query_frontend_retries_sumsum_rate>cluster_job:cortex_query_frontend_retries_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_51d53cc532>
Copy</button></div><div id=clipboard_51d53cc532><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_query_frontend_retries_sum[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_query_frontend_retries_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_query_frontend_retries_countsum_rate>cluster_job:cortex_query_frontend_retries_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_4711f68a69>
Copy</button></div><div id=clipboard_4711f68a69><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_query_frontend_retries_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_query_frontend_retries_count:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_query_frontend_queue_duration_seconds99quantile>cluster_job:cortex_query_frontend_queue_duration_seconds:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_e51f6e0ad3>
Copy</button></div><div id=clipboard_e51f6e0ad3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_query_frontend_queue_duration_seconds_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_query_frontend_queue_duration_seconds:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_query_frontend_queue_duration_seconds50quantile>cluster_job:cortex_query_frontend_queue_duration_seconds:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_1750eab350>
Copy</button></div><div id=clipboard_1750eab350><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_query_frontend_queue_duration_seconds_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_query_frontend_queue_duration_seconds:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_query_frontend_queue_duration_secondsavg>cluster_job:cortex_query_frontend_queue_duration_seconds:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_f24c8c21e3>
Copy</button></div><div id=clipboard_f24c8c21e3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_query_frontend_queue_duration_seconds_sum[1m])) by (cluster,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>job) / sum(rate(cortex_query_frontend_queue_duration_seconds_count[1m])) by (cluster,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_query_frontend_queue_duration_seconds:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_query_frontend_queue_duration_seconds_bucketsum_rate>cluster_job:cortex_query_frontend_queue_duration_seconds_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_bf584baa1b>
Copy</button></div><div id=clipboard_bf584baa1b><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_query_frontend_queue_duration_seconds_bucket[1m])) by (le, cluster,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_query_frontend_queue_duration_seconds_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_query_frontend_queue_duration_seconds_sumsum_rate>cluster_job:cortex_query_frontend_queue_duration_seconds_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_b56427b815>
Copy</button></div><div id=clipboard_b56427b815><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_query_frontend_queue_duration_seconds_sum[1m])) by (cluster,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_query_frontend_queue_duration_seconds_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_query_frontend_queue_duration_seconds_countsum_rate>cluster_job:cortex_query_frontend_queue_duration_seconds_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_0b0dd2c852>
Copy</button></div><div id=clipboard_0b0dd2c852><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_query_frontend_queue_duration_seconds_count[1m])) by (cluster,</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_query_frontend_queue_duration_seconds_count:sum_rate</span>
</span></span></code></pre></div></div></div><h3 id=mimir_ingester_queries>mimir_ingester_queries</h3><h5 id=cluster_jobcortex_ingester_queried_series99quantile>cluster_job:cortex_ingester_queried_series:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_0bd3398dec>
Copy</button></div><div id=clipboard_0bd3398dec><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_ingester_queried_series_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_series:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_series50quantile>cluster_job:cortex_ingester_queried_series:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_46a3ad2329>
Copy</button></div><div id=clipboard_46a3ad2329><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_ingester_queried_series_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_series:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_seriesavg>cluster_job:cortex_ingester_queried_series:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_78a2eff750>
Copy</button></div><div id=clipboard_78a2eff750><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_ingester_queried_series_sum[1m])) by (cluster, job) / sum(rate(cortex_ingester_queried_series_count[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_series:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_series_bucketsum_rate>cluster_job:cortex_ingester_queried_series_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_80bbce9606>
Copy</button></div><div id=clipboard_80bbce9606><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_ingester_queried_series_bucket[1m])) by (le, cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_series_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_series_sumsum_rate>cluster_job:cortex_ingester_queried_series_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_d8eaf0fcc0>
Copy</button></div><div id=clipboard_d8eaf0fcc0><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_ingester_queried_series_sum[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_series_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_series_countsum_rate>cluster_job:cortex_ingester_queried_series_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_311313cd78>
Copy</button></div><div id=clipboard_311313cd78><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_ingester_queried_series_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_series_count:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_samples99quantile>cluster_job:cortex_ingester_queried_samples:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_124b8deaed>
Copy</button></div><div id=clipboard_124b8deaed><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_ingester_queried_samples_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_samples:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_samples50quantile>cluster_job:cortex_ingester_queried_samples:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_794545dc0b>
Copy</button></div><div id=clipboard_794545dc0b><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_ingester_queried_samples_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_samples:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_samplesavg>cluster_job:cortex_ingester_queried_samples:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_7d57c1f4b4>
Copy</button></div><div id=clipboard_7d57c1f4b4><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_ingester_queried_samples_sum[1m])) by (cluster, job) / sum(rate(cortex_ingester_queried_samples_count[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_samples:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_samples_bucketsum_rate>cluster_job:cortex_ingester_queried_samples_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_eef7c35785>
Copy</button></div><div id=clipboard_eef7c35785><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_ingester_queried_samples_bucket[1m])) by (le, cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_samples_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_samples_sumsum_rate>cluster_job:cortex_ingester_queried_samples_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_0c2576451f>
Copy</button></div><div id=clipboard_0c2576451f><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_ingester_queried_samples_sum[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_samples_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_samples_countsum_rate>cluster_job:cortex_ingester_queried_samples_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_14cb695bea>
Copy</button></div><div id=clipboard_14cb695bea><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_ingester_queried_samples_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_samples_count:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_exemplars99quantile>cluster_job:cortex_ingester_queried_exemplars:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_fba8a32a50>
Copy</button></div><div id=clipboard_fba8a32a50><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_ingester_queried_exemplars_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_exemplars:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_exemplars50quantile>cluster_job:cortex_ingester_queried_exemplars:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_15b3d8dd82>
Copy</button></div><div id=clipboard_15b3d8dd82><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_ingester_queried_exemplars_bucket[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_exemplars:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_exemplarsavg>cluster_job:cortex_ingester_queried_exemplars:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_4ada693ae9>
Copy</button></div><div id=clipboard_4ada693ae9><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_ingester_queried_exemplars_sum[1m])) by (cluster, job) / sum(rate(cortex_ingester_queried_exemplars_count[1m]))</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_exemplars:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_exemplars_bucketsum_rate>cluster_job:cortex_ingester_queried_exemplars_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_2644021d8f>
Copy</button></div><div id=clipboard_2644021d8f><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_ingester_queried_exemplars_bucket[1m])) by (le, cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_exemplars_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_exemplars_sumsum_rate>cluster_job:cortex_ingester_queried_exemplars_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_c6c94f7139>
Copy</button></div><div id=clipboard_c6c94f7139><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_ingester_queried_exemplars_sum[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_exemplars_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_exemplars_countsum_rate>cluster_job:cortex_ingester_queried_exemplars_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_b36e7466d6>
Copy</button></div><div id=clipboard_b36e7466d6><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_ingester_queried_exemplars_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_exemplars_count:sum_rate</span>
</span></span></code></pre></div></div></div><h3 id=mimir_received_samples>mimir_received_samples</h3><h5 id=cluster_namespace_jobcortex_distributor_received_samplesrate5m>cluster_namespace_job:cortex_distributor_received_samples:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_e8a1dca1e3>
Copy</button></div><div id=clipboard_e8a1dca1e3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum by (cluster, namespace, job) (rate(cortex_distributor_received_samples_total[5m]))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job:cortex_distributor_received_samples:rate5m</span>
</span></span></code></pre></div></div></div><h3 id=mimir_exemplars_in>mimir_exemplars_in</h3><h5 id=cluster_namespace_jobcortex_distributor_exemplars_inrate5m>cluster_namespace_job:cortex_distributor_exemplars_in:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_b6fdc8785a>
Copy</button></div><div id=clipboard_b6fdc8785a><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum by (cluster, namespace, job) (rate(cortex_distributor_exemplars_in_total[5m]))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job:cortex_distributor_exemplars_in:rate5m</span>
</span></span></code></pre></div></div></div><h3 id=mimir_received_exemplars>mimir_received_exemplars</h3><h5 id=cluster_namespace_jobcortex_distributor_received_exemplarsrate5m>cluster_namespace_job:cortex_distributor_received_exemplars:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_9ea1cd35dc>
Copy</button></div><div id=clipboard_9ea1cd35dc><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum by (cluster, namespace, job) (rate(cortex_distributor_received_exemplars_total[5m]))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job:cortex_distributor_received_exemplars:rate5m</span>
</span></span></code></pre></div></div></div><h3 id=mimir_exemplars_ingested>mimir_exemplars_ingested</h3><h5 id=cluster_namespace_jobcortex_ingester_ingested_exemplarsrate5m>cluster_namespace_job:cortex_ingester_ingested_exemplars:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_9b97199b34>
Copy</button></div><div id=clipboard_9b97199b34><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum by (cluster, namespace, job) (rate(cortex_ingester_ingested_exemplars_total[5m]))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job:cortex_ingester_ingested_exemplars:rate5m</span>
</span></span></code></pre></div></div></div><h3 id=mimir_exemplars_appended>mimir_exemplars_appended</h3><h5 id=cluster_namespace_jobcortex_ingester_tsdb_exemplar_exemplars_appendedrate5m>cluster_namespace_job:cortex_ingester_tsdb_exemplar_exemplars_appended:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_14809940c4>
Copy</button></div><div id=clipboard_14809940c4><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum by (cluster, namespace, job) (rate(cortex_ingester_tsdb_exemplar_exemplars_appended_total[5m]))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job:cortex_ingester_tsdb_exemplar_exemplars_appended:rate5m</span>
</span></span></code></pre></div></div></div><h3 id=mimir_scaling_rules>mimir_scaling_rules</h3><h5 id=cluster_namespace_deploymentactual_replicascount>cluster_namespace_deployment:actual_replicas:count</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_1a2d593ff0>
Copy</button></div><div id=clipboard_1a2d593ff0><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, deployment) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>      kube_deployment_spec_replicas,
</span></span></span><span style=display:flex><span><span style=color:#d88200>      # The question mark in &#34;(.*?)&#34; is used to make it non-greedy, otherwise it
</span></span></span><span style=display:flex><span><span style=color:#d88200>      # always matches everything and the (optional) zone is not removed.
</span></span></span><span style=display:flex><span><span style=color:#d88200>      &#34;deployment&#34;, &#34;$1&#34;, &#34;deployment&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  or
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, deployment) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    label_replace(kube_statefulset_replicas, &#34;deployment&#34;, &#34;$1&#34;, &#34;statefulset&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment:actual_replicas:count</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_deployment_reasonrequired_replicascount>cluster_namespace_deployment_reason:required_replicas:count</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_10a0cea098>
Copy</button></div><div id=clipboard_10a0cea098><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ceil(
</span></span></span><span style=display:flex><span><span style=color:#d88200>    quantile_over_time(0.99,
</span></span></span><span style=display:flex><span><span style=color:#d88200>      sum by (cluster, namespace) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>        cluster_namespace_job:cortex_distributor_received_samples:rate5m
</span></span></span><span style=display:flex><span><span style=color:#d88200>      )[24h:]
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>    / 240000
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>deployment</span><span style=color:#111>:</span> <span style=color:#ae81ff>distributor</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reason</span><span style=color:#111>:</span> <span style=color:#ae81ff>sample_rate</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment_reason:required_replicas:count</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_deployment_reasonrequired_replicascount-1>cluster_namespace_deployment_reason:required_replicas:count</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_cffb83cfb9>
Copy</button></div><div id=clipboard_cffb83cfb9><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ceil(
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by (cluster, namespace) (cortex_limits_overrides{limit_name=&#34;ingestion_rate&#34;})
</span></span></span><span style=display:flex><span><span style=color:#d88200>    * 0.59999999999999998 / 240000
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>deployment</span><span style=color:#111>:</span> <span style=color:#ae81ff>distributor</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reason</span><span style=color:#111>:</span> <span style=color:#ae81ff>sample_rate_limits</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment_reason:required_replicas:count</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_deployment_reasonrequired_replicascount-2>cluster_namespace_deployment_reason:required_replicas:count</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_7532590acc>
Copy</button></div><div id=clipboard_7532590acc><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ceil(
</span></span></span><span style=display:flex><span><span style=color:#d88200>    quantile_over_time(0.99,
</span></span></span><span style=display:flex><span><span style=color:#d88200>      sum by (cluster, namespace) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>        cluster_namespace_job:cortex_distributor_received_samples:rate5m
</span></span></span><span style=display:flex><span><span style=color:#d88200>      )[24h:]
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>    * 3 / 80000
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>deployment</span><span style=color:#111>:</span> <span style=color:#ae81ff>ingester</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reason</span><span style=color:#111>:</span> <span style=color:#ae81ff>sample_rate</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment_reason:required_replicas:count</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_deployment_reasonrequired_replicascount-3>cluster_namespace_deployment_reason:required_replicas:count</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_44bf1cbda9>
Copy</button></div><div id=clipboard_44bf1cbda9><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ceil(
</span></span></span><span style=display:flex><span><span style=color:#d88200>    quantile_over_time(0.99,
</span></span></span><span style=display:flex><span><span style=color:#d88200>      sum by(cluster, namespace) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>        cortex_ingester_memory_series
</span></span></span><span style=display:flex><span><span style=color:#d88200>      )[24h:]
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>    / 1500000
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>deployment</span><span style=color:#111>:</span> <span style=color:#ae81ff>ingester</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reason</span><span style=color:#111>:</span> <span style=color:#ae81ff>active_series</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment_reason:required_replicas:count</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_deployment_reasonrequired_replicascount-4>cluster_namespace_deployment_reason:required_replicas:count</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_28c6734f06>
Copy</button></div><div id=clipboard_28c6734f06><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ceil(
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by (cluster, namespace) (cortex_limits_overrides{limit_name=&#34;max_global_series_per_user&#34;})
</span></span></span><span style=display:flex><span><span style=color:#d88200>    * 3 * 0.59999999999999998 / 1500000
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>deployment</span><span style=color:#111>:</span> <span style=color:#ae81ff>ingester</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reason</span><span style=color:#111>:</span> <span style=color:#ae81ff>active_series_limits</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment_reason:required_replicas:count</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_deployment_reasonrequired_replicascount-5>cluster_namespace_deployment_reason:required_replicas:count</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_4cca0bd0d8>
Copy</button></div><div id=clipboard_4cca0bd0d8><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ceil(
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by (cluster, namespace) (cortex_limits_overrides{limit_name=&#34;ingestion_rate&#34;})
</span></span></span><span style=display:flex><span><span style=color:#d88200>    * 0.59999999999999998 / 80000
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>deployment</span><span style=color:#111>:</span> <span style=color:#ae81ff>ingester</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reason</span><span style=color:#111>:</span> <span style=color:#ae81ff>sample_rate_limits</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment_reason:required_replicas:count</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_deployment_reasonrequired_replicascount-6>cluster_namespace_deployment_reason:required_replicas:count</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_40a818bb26>
Copy</button></div><div id=clipboard_40a818bb26><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ceil(
</span></span></span><span style=display:flex><span><span style=color:#d88200>    (sum by (cluster, namespace) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      cortex_ingester_tsdb_storage_blocks_bytes{job=~&#34;.+/ingester.*&#34;}
</span></span></span><span style=display:flex><span><span style=color:#d88200>    ) / 4)
</span></span></span><span style=display:flex><span><span style=color:#d88200>      /
</span></span></span><span style=display:flex><span><span style=color:#d88200>    avg by (cluster, namespace) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      memcached_limit_bytes{job=~&#34;.+/memcached&#34;}
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>deployment</span><span style=color:#111>:</span> <span style=color:#ae81ff>memcached</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reason</span><span style=color:#111>:</span> <span style=color:#ae81ff>active_series</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment_reason:required_replicas:count</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_deploymentcontainer_cpu_usage_seconds_totalsum_rate>cluster_namespace_deployment:container_cpu_usage_seconds_total:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_5735d8c700>
Copy</button></div><div id=clipboard_5735d8c700><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, deployment) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>      label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>        node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate,
</span></span></span><span style=display:flex><span><span style=color:#d88200>        &#34;deployment&#34;, &#34;$1&#34;, &#34;pod&#34;, &#34;(.*)-(?:([0-9]+)|([a-z0-9]+)-([a-z0-9]+))&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>      ),
</span></span></span><span style=display:flex><span><span style=color:#d88200>      # The question mark in &#34;(.*?)&#34; is used to make it non-greedy, otherwise it
</span></span></span><span style=display:flex><span><span style=color:#d88200>      # always matches everything and the (optional) zone is not removed.
</span></span></span><span style=display:flex><span><span style=color:#d88200>      &#34;deployment&#34;, &#34;$1&#34;, &#34;deployment&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment:container_cpu_usage_seconds_total:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=heading></h5><p>cluster_namespace_deployment:kube_pod_container_resource_requests_cpu_cores:sum</p><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_5691216b4f>
Copy</button></div><div id=clipboard_5691216b4f><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # This recording rule is made compatible with the breaking changes introduced in kube-state-metrics v2
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # that remove resource metrics, ref:
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # - https://github.com/kubernetes/kube-state-metrics/blob/master/CHANGELOG.md#v200-alpha--2020-09-16
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # - https://github.com/kubernetes/kube-state-metrics/pull/1004
</span></span></span><span style=display:flex><span><span style=color:#d88200>  #
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # This is the old expression, compatible with kube-state-metrics &lt; v2.0.0,
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # where kube_pod_container_resource_requests_cpu_cores was removed:
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by (cluster, namespace, deployment) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>        label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>          kube_pod_container_resource_requests_cpu_cores,
</span></span></span><span style=display:flex><span><span style=color:#d88200>          &#34;deployment&#34;, &#34;$1&#34;, &#34;pod&#34;, &#34;(.*)-(?:([0-9]+)|([a-z0-9]+)-([a-z0-9]+))&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>        ),
</span></span></span><span style=display:flex><span><span style=color:#d88200>        # The question mark in &#34;(.*?)&#34; is used to make it non-greedy, otherwise it
</span></span></span><span style=display:flex><span><span style=color:#d88200>        # always matches everything and the (optional) zone is not removed.
</span></span></span><span style=display:flex><span><span style=color:#d88200>        &#34;deployment&#34;, &#34;$1&#34;, &#34;deployment&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>      )
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  or
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # This expression is compatible with kube-state-metrics &gt;= v1.4.0,
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # where kube_pod_container_resource_requests was introduced.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by (cluster, namespace, deployment) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>        label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>          kube_pod_container_resource_requests{resource=&#34;cpu&#34;},
</span></span></span><span style=display:flex><span><span style=color:#d88200>          &#34;deployment&#34;, &#34;$1&#34;, &#34;pod&#34;, &#34;(.*)-(?:([0-9]+)|([a-z0-9]+)-([a-z0-9]+))&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>        ),
</span></span></span><span style=display:flex><span><span style=color:#d88200>        # The question mark in &#34;(.*?)&#34; is used to make it non-greedy, otherwise it
</span></span></span><span style=display:flex><span><span style=color:#d88200>        # always matches everything and the (optional) zone is not removed.
</span></span></span><span style=display:flex><span><span style=color:#d88200>        &#34;deployment&#34;, &#34;$1&#34;, &#34;deployment&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>      )
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment:kube_pod_container_resource_requests_cpu_cores:sum</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_deployment_reasonrequired_replicascount-7>cluster_namespace_deployment_reason:required_replicas:count</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_4c58fcdba3>
Copy</button></div><div id=clipboard_4c58fcdba3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ceil(
</span></span></span><span style=display:flex><span><span style=color:#d88200>    cluster_namespace_deployment:actual_replicas:count
</span></span></span><span style=display:flex><span><span style=color:#d88200>      *
</span></span></span><span style=display:flex><span><span style=color:#d88200>    quantile_over_time(0.99, cluster_namespace_deployment:container_cpu_usage_seconds_total:sum_rate[24h])
</span></span></span><span style=display:flex><span><span style=color:#d88200>      /
</span></span></span><span style=display:flex><span><span style=color:#d88200>    cluster_namespace_deployment:kube_pod_container_resource_requests_cpu_cores:sum
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reason</span><span style=color:#111>:</span> <span style=color:#ae81ff>cpu_usage</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment_reason:required_replicas:count</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_deploymentcontainer_memory_usage_bytessum>cluster_namespace_deployment:container_memory_usage_bytes:sum</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_9502a023c2>
Copy</button></div><div id=clipboard_9502a023c2><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, deployment) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>      label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>        container_memory_usage_bytes{image!=&#34;&#34;},
</span></span></span><span style=display:flex><span><span style=color:#d88200>        &#34;deployment&#34;, &#34;$1&#34;, &#34;pod&#34;, &#34;(.*)-(?:([0-9]+)|([a-z0-9]+)-([a-z0-9]+))&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>      ),
</span></span></span><span style=display:flex><span><span style=color:#d88200>      # The question mark in &#34;(.*?)&#34; is used to make it non-greedy, otherwise it
</span></span></span><span style=display:flex><span><span style=color:#d88200>      # always matches everything and the (optional) zone is not removed.
</span></span></span><span style=display:flex><span><span style=color:#d88200>      &#34;deployment&#34;, &#34;$1&#34;, &#34;deployment&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment:container_memory_usage_bytes:sum</span>
</span></span></code></pre></div></div></div><h5 id=heading-1></h5><p>cluster_namespace_deployment:kube_pod_container_resource_requests_memory_bytes:sum</p><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_3bddd63a08>
Copy</button></div><div id=clipboard_3bddd63a08><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # This recording rule is made compatible with the breaking changes introduced in kube-state-metrics v2
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # that remove resource metrics, ref:
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # - https://github.com/kubernetes/kube-state-metrics/blob/master/CHANGELOG.md#v200-alpha--2020-09-16
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # - https://github.com/kubernetes/kube-state-metrics/pull/1004
</span></span></span><span style=display:flex><span><span style=color:#d88200>  #
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # This is the old expression, compatible with kube-state-metrics &lt; v2.0.0,
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # where kube_pod_container_resource_requests_memory_bytes was removed:
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by (cluster, namespace, deployment) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>        label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>          kube_pod_container_resource_requests_memory_bytes,
</span></span></span><span style=display:flex><span><span style=color:#d88200>          &#34;deployment&#34;, &#34;$1&#34;, &#34;pod&#34;, &#34;(.*)-(?:([0-9]+)|([a-z0-9]+)-([a-z0-9]+))&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>        ),
</span></span></span><span style=display:flex><span><span style=color:#d88200>        # The question mark in &#34;(.*?)&#34; is used to make it non-greedy, otherwise it
</span></span></span><span style=display:flex><span><span style=color:#d88200>        # always matches everything and the (optional) zone is not removed.
</span></span></span><span style=display:flex><span><span style=color:#d88200>        &#34;deployment&#34;, &#34;$1&#34;, &#34;deployment&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>      )
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  or
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # This expression is compatible with kube-state-metrics &gt;= v1.4.0,
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # where kube_pod_container_resource_requests was introduced.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by (cluster, namespace, deployment) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>        label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>          kube_pod_container_resource_requests{resource=&#34;memory&#34;},
</span></span></span><span style=display:flex><span><span style=color:#d88200>          &#34;deployment&#34;, &#34;$1&#34;, &#34;pod&#34;, &#34;(.*)-(?:([0-9]+)|([a-z0-9]+)-([a-z0-9]+))&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>        ),
</span></span></span><span style=display:flex><span><span style=color:#d88200>        # The question mark in &#34;(.*?)&#34; is used to make it non-greedy, otherwise it
</span></span></span><span style=display:flex><span><span style=color:#d88200>        # always matches everything and the (optional) zone is not removed.
</span></span></span><span style=display:flex><span><span style=color:#d88200>        &#34;deployment&#34;, &#34;$1&#34;, &#34;deployment&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>      )
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment:kube_pod_container_resource_requests_memory_bytes:sum</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_deployment_reasonrequired_replicascount-8>cluster_namespace_deployment_reason:required_replicas:count</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_507e0a695d>
Copy</button></div><div id=clipboard_507e0a695d><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ceil(
</span></span></span><span style=display:flex><span><span style=color:#d88200>    cluster_namespace_deployment:actual_replicas:count
</span></span></span><span style=display:flex><span><span style=color:#d88200>      *
</span></span></span><span style=display:flex><span><span style=color:#d88200>    quantile_over_time(0.99, cluster_namespace_deployment:container_memory_usage_bytes:sum[24h])
</span></span></span><span style=display:flex><span><span style=color:#d88200>      /
</span></span></span><span style=display:flex><span><span style=color:#d88200>    cluster_namespace_deployment:kube_pod_container_resource_requests_memory_bytes:sum
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reason</span><span style=color:#111>:</span> <span style=color:#ae81ff>memory_usage</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment_reason:required_replicas:count</span>
</span></span></code></pre></div></div></div><h3 id=mimir_alertmanager_rules>mimir_alertmanager_rules</h3><h5 id=cluster_job_podcortex_alertmanager_alertssum>cluster_job_pod:cortex_alertmanager_alerts:sum</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_1d205a83c8>
Copy</button></div><div id=clipboard_1d205a83c8><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum by (cluster, job, pod) (cortex_alertmanager_alerts)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_pod:cortex_alertmanager_alerts:sum</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_podcortex_alertmanager_silencessum>cluster_job_pod:cortex_alertmanager_silences:sum</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_bc0a1db0b1>
Copy</button></div><div id=clipboard_bc0a1db0b1><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum by (cluster, job, pod) (cortex_alertmanager_silences)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_pod:cortex_alertmanager_silences:sum</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_alertmanager_alerts_received_totalrate5m>cluster_job:cortex_alertmanager_alerts_received_total:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_d01266c4a6>
Copy</button></div><div id=clipboard_d01266c4a6><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum by (cluster, job) (rate(cortex_alertmanager_alerts_received_total[5m]))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_alertmanager_alerts_received_total:rate5m</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_alertmanager_alerts_invalid_totalrate5m>cluster_job:cortex_alertmanager_alerts_invalid_total:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_dbf507dea1>
Copy</button></div><div id=clipboard_dbf507dea1><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum by (cluster, job) (rate(cortex_alertmanager_alerts_invalid_total[5m]))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_alertmanager_alerts_invalid_total:rate5m</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_integrationcortex_alertmanager_notifications_totalrate5m>cluster_job_integration:cortex_alertmanager_notifications_total:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_4a08114d59>
Copy</button></div><div id=clipboard_4a08114d59><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum by (cluster, job, integration) (rate(cortex_alertmanager_notifications_total[5m]))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_integration:cortex_alertmanager_notifications_total:rate5m</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_integrationcortex_alertmanager_notifications_failed_totalrate5m>cluster_job_integration:cortex_alertmanager_notifications_failed_total:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_7fd0bdd137>
Copy</button></div><div id=clipboard_7fd0bdd137><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum by (cluster, job, integration) (rate(cortex_alertmanager_notifications_failed_total[5m]))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_integration:cortex_alertmanager_notifications_failed_total:rate5m</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_alertmanager_state_replication_totalrate5m>cluster_job:cortex_alertmanager_state_replication_total:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_ea84261c03>
Copy</button></div><div id=clipboard_ea84261c03><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum by (cluster, job) (rate(cortex_alertmanager_state_replication_total[5m]))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_alertmanager_state_replication_total:rate5m</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_alertmanager_state_replication_failed_totalrate5m>cluster_job:cortex_alertmanager_state_replication_failed_total:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_565b5ac5a6>
Copy</button></div><div id=clipboard_565b5ac5a6><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum by (cluster, job) (rate(cortex_alertmanager_state_replication_failed_total[5m]))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_alertmanager_state_replication_failed_total:rate5m</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_alertmanager_partial_state_merges_totalrate5m>cluster_job:cortex_alertmanager_partial_state_merges_total:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_9a7d7a738b>
Copy</button></div><div id=clipboard_9a7d7a738b><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum by (cluster, job) (rate(cortex_alertmanager_partial_state_merges_total[5m]))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_alertmanager_partial_state_merges_total:rate5m</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_alertmanager_partial_state_merges_failed_totalrate5m>cluster_job:cortex_alertmanager_partial_state_merges_failed_total:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_93ae6cd61e>
Copy</button></div><div id=clipboard_93ae6cd61e><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum by (cluster, job) (rate(cortex_alertmanager_partial_state_merges_failed_total[5m]))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_alertmanager_partial_state_merges_failed_total:rate5m</span>
</span></span></code></pre></div></div></div><h3 id=mimir_ingester_rules>mimir_ingester_rules</h3><h5 id=cluster_namespace_podcortex_ingester_ingested_samples_totalrate1m>cluster_namespace_pod:cortex_ingester_ingested_samples_total:rate1m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_28f2c92381>
Copy</button></div><div id=clipboard_28f2c92381><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  </span>  <span style=color:#ae81ff>sum by(cluster, namespace, pod) (rate(cortex_ingester_ingested_samples_total[1m]))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_pod:cortex_ingester_ingested_samples_total:rate1m</span>
</span></span></code></pre></div></div></div><h2 id=dashboards>Dashboards</h2><p>Following dashboards are generated from mixins and hosted on github:</p><ul><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-alertmanager-resources.json>mimir-alertmanager-resources</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-alertmanager.json>mimir-alertmanager</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-compactor-resources.json>mimir-compactor-resources</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-compactor.json>mimir-compactor</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-config.json>mimir-config</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-object-store.json>mimir-object-store</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-overrides.json>mimir-overrides</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-overview.json>mimir-overview</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-queries.json>mimir-queries</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-reads-networking.json>mimir-reads-networking</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-reads-resources.json>mimir-reads-resources</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-reads.json>mimir-reads</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-remote-ruler-reads-resources.json>mimir-remote-ruler-reads-resources</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-remote-ruler-reads.json>mimir-remote-ruler-reads</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-rollout-progress.json>mimir-rollout-progress</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-ruler.json>mimir-ruler</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-scaling.json>mimir-scaling</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-slow-queries.json>mimir-slow-queries</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-tenants.json>mimir-tenants</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-top-tenants.json>mimir-top-tenants</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-writes-networking.json>mimir-writes-networking</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-writes-resources.json>mimir-writes-resources</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-writes.json>mimir-writes</a></li></ul><div class=row></div></div></div></div><script src=https://stack.observability.udmire.cn/lib/jquery.min.js></script>
<script src=https://stack.observability.udmire.cn/lib/popper.min.js></script>
<script src=https://stack.observability.udmire.cn/js/bootstrap.min.js></script>
<script type=text/javascript src=/plugins/lunr.min.js></script>
<script type=text/javascript src=/plugins/auto-complete.js></script>
<link href=/plugins/auto-complete.css rel=stylesheet><script type=text/javascript>var baseurl="https://stack.observability.udmire.cn/"</script><script type=text/javascript src=/plugins/search.js></script>
<script type=text/javascript src=/plugins/clipboard.js></script>
<script>new ClipboardJS(".btn")</script></body></html>