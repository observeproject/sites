<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=alternate type=application/rss+xml href=https://stack.observability.udmire.cn/mimir/index.xml title="Mixins for Observability Stack"><link rel=canonical href=https://stack.observability.udmire.cn/mimir/><title>mimir | Mixins for Observability Stack
</title><link href=https://stack.observability.udmire.cn/css/fontawesome.min.css rel=stylesheet><link rel=stylesheet href=https://stack.observability.udmire.cn/css/ace.min.css></head><body><nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow sticky-top" id=navbarMain><div class=container><div><a class=navbar-brand href=/>Mixins for Observability Stack</a></div><button class="navbar-toggler navbar-toggler-right collapsed" type=button data-toggle=collapse data-target=#navbarMainCollapse aria-controls=navbarMainCollapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarMainCollapse><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/>Homepage</a></li><li class=nav-item><a class=nav-link href=https://github.com/monitoring-mixins/docs>About mixins</a></li><li class=nav-item><a class=nav-link href=https://github.com/observeproject/sites>GitHub</a></li></ul></div></div><div class=feed-icons><a href=https://stack.observability.udmire.cn/mimir/index.xml><img src=/img/feed-icon.svg alt="RSS feed"></a></div></nav><div class=container-fluid><div class=row><div class="docs-sidenav order-0 col-12 col-md-3 col-lg-2 col-xl-2 position-sticky border-right"><nav class="navbar navbar-expand-md navbar-light pl-0"><button class="navbar-toggler navbar-toggler-right collapsed" type=button data-toggle=collapse data-target=#sidenav-left-collapse aria-controls=sidenav-left-collapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse align-items-start flex-column" id=sidenav-left-collapse><ul class="navbar-nav flex-column pt-3"><li data-nav-id=/cert-manager/ class="nav-item my-1"><a class="nav-link p-0" href=/cert-manager/><h6>cert-manager</h6></a></li><li data-nav-id=/coredns/ class="nav-item my-1"><a class="nav-link p-0" href=/coredns/><h6>coredns</h6></a></li><li data-nav-id=/etcd/ class="nav-item my-1"><a class="nav-link p-0" href=/etcd/><h6>etcd</h6></a></li><li data-nav-id=/grafana/ class="nav-item my-1"><a class="nav-link p-0" href=/grafana/><h6>grafana</h6></a></li><li data-nav-id=/grafana-agent/ class="nav-item my-1"><a class="nav-link p-0" href=/grafana-agent/><h6>grafana-agent</h6></a></li><li data-nav-id=/kube-state-metrics/ class="nav-item my-1"><a class="nav-link p-0" href=/kube-state-metrics/><h6>kube-state-metrics</h6></a></li><li data-nav-id=/kubernetes/ class="nav-item my-1"><a class="nav-link p-0" href=/kubernetes/><h6>kubernetes</h6></a></li><li data-nav-id=/loki/ class="nav-item my-1"><a class="nav-link p-0" href=/loki/><h6>loki</h6></a></li><li data-nav-id=/memcached/ class="nav-item my-1"><a class="nav-link p-0" href=/memcached/><h6>memcached</h6></a></li><li data-nav-id=/mimir/ class="nav-item my-1 active"><a class="nav-link p-0" href=/mimir/><h6>mimir</h6></a></li><li data-nav-id=/node-exporter/ class="nav-item my-1"><a class="nav-link p-0" href=/node-exporter/><h6>node-exporter</h6></a></li><li data-nav-id=/pyroscope/ class="nav-item my-1"><a class="nav-link p-0" href=/pyroscope/><h6>pyroscope</h6></a></li><li data-nav-id=/tempo/ class="nav-item my-1"><a class="nav-link p-0" href=/tempo/><h6>tempo</h6></a></li></ul></div></nav></div><div class="docs-toc large order-lg-2 order-md-0 order-xs-1 col-12 col-lg-3 col-xl-3 position-sticky border-left"><div class=docs-toc><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#alerts>Alerts</a><ul><li><a href=#mimir_alerts>mimir_alerts</a></li><li><a href=#mimir_instance_limits_alerts>mimir_instance_limits_alerts</a></li><li><a href=#mimir-rollout-alerts>mimir-rollout-alerts</a></li><li><a href=#mimir-provisioning>mimir-provisioning</a></li><li><a href=#ruler_alerts>ruler_alerts</a></li><li><a href=#gossip_alerts>gossip_alerts</a></li><li><a href=#etcd_alerts>etcd_alerts</a></li><li><a href=#alertmanager_alerts>alertmanager_alerts</a></li><li><a href=#mimir_blocks_alerts>mimir_blocks_alerts</a></li><li><a href=#mimir_compactor_alerts>mimir_compactor_alerts</a></li><li><a href=#mimir_autoscaling>mimir_autoscaling</a></li><li><a href=#mimir_ingest_storage_alerts>mimir_ingest_storage_alerts</a></li><li><a href=#mimir_continuous_test>mimir_continuous_test</a></li></ul></li><li><a href=#recording-rules>Recording Rules</a><ul><li><a href=#mimir_api_1>mimir_api_1</a></li><li><a href=#mimir_api_2>mimir_api_2</a></li><li><a href=#mimir_api_3>mimir_api_3</a></li><li><a href=#mimir_querier_api>mimir_querier_api</a></li><li><a href=#mimir_storage>mimir_storage</a></li><li><a href=#mimir_queries>mimir_queries</a></li><li><a href=#mimir_ingester_queries>mimir_ingester_queries</a></li><li><a href=#mimir_received_samples>mimir_received_samples</a></li><li><a href=#mimir_exemplars_in>mimir_exemplars_in</a></li><li><a href=#mimir_received_exemplars>mimir_received_exemplars</a></li><li><a href=#mimir_exemplars_ingested>mimir_exemplars_ingested</a></li><li><a href=#mimir_exemplars_appended>mimir_exemplars_appended</a></li><li><a href=#mimir_scaling_rules>mimir_scaling_rules</a></li><li><a href=#mimir_alertmanager_rules>mimir_alertmanager_rules</a></li><li><a href=#mimir_ingester_rules>mimir_ingester_rules</a></li></ul></li><li><a href=#dashboards>Dashboards</a></li></ul></nav></div></div><div class="main col-12 order-1 col-md-9 col-lg-9 col-xl-7 py-3"><h1>mimir</h1><h2 id=overview>Overview</h2><p>The mimir Mixin is a set of configurable, reusable, and extensible alerts and dashboards for Mimir/Cortex.</p><div class="card my-3 border-top-0 border-right-0 border-bottom-0 border-left border-danger rounded" style=border-width:4px!important><div class="wrap border border-left-0 rounded"><div class="card-body pt-1">Jsonnet 源码地址：<a href=https://github.com/grafana/mimir/tree/master/operations/mimir-mixin>github.com/grafana/mimir</a></div></div></div><h2 id=alerts>Alerts</h2><div class="card my-3 border-top-0 border-right-0 border-bottom-0 border-left border-warning rounded" style=border-width:4px!important><div class="wrap border border-left-0 rounded"><div class="card-body pt-1">告警Alerts配置列表 <a href=https://github.com/observeproject/sites/blob/main/assets/mimir/alerts.yaml>源文件</a>.</div></div></div><h3 id=mimir_alerts>mimir_alerts</h3><h5 id=metricingesterunhealthy>MetricIngesterUnhealthy</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_2844fa4976>
Copy</button></div><div id=clipboard_2844fa4976><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricIngesterUnhealthy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric cluster {{ $labels.cluster }}/{{ $labels.namespace }} has {{ printf &#34;%f&#34; $value }} unhealthy ingester(s).</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricingesterunhealthy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  min by (cluster, namespace) (cortex_ring_members{state=&#34;Unhealthy&#34;, name=&#34;ingester&#34;}) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricrequesterrors>MetricRequestErrors</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_4ea569619c>
Copy</button></div><div id=clipboard_4ea569619c><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricRequestErrors</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    The route {{ $labels.route }} in {{ $labels.cluster }}/{{ $labels.namespace }} is experiencing {{ printf &#34;%.2f&#34; $value }}% errors.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricrequesterrors</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  100 * sum by (cluster, namespace, job, route) (rate(cortex_request_duration_seconds_count{status_code=~&#34;5..&#34;,route!~&#34;ready|debug_pprof&#34;}[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>    /
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, job, route) (rate(cortex_request_duration_seconds_count{route!~&#34;ready|debug_pprof&#34;}[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>    &gt; 1</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricrequestlatency>MetricRequestLatency</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_e842251b97>
Copy</button></div><div id=clipboard_e842251b97><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricRequestLatency</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    {{ $labels.job }} {{ $labels.route }} is experiencing {{ printf &#34;%.2f&#34; $value }}s 99th percentile latency.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricrequestlatency</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  cluster_namespace_job_route:cortex_request_duration_seconds:99quantile{route!~&#34;metrics|/frontend.Frontend/Process|ready|/schedulerpb.SchedulerForFrontend/FrontendLoop|/schedulerpb.SchedulerForQuerier/QuerierLoop|debug_pprof&#34;}
</span></span></span><span style=display:flex><span><span style=color:#d88200>     &gt;
</span></span></span><span style=display:flex><span><span style=color:#d88200>  2.5</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=metricinconsistentruntimeconfig>MetricInconsistentRuntimeConfig</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_4cb89fcd71>
Copy</button></div><div id=clipboard_4cb89fcd71><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricInconsistentRuntimeConfig</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    An inconsistent runtime config file is used across cluster {{ $labels.cluster }}/{{ $labels.namespace }}.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricinconsistentruntimeconfig</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  count(count by(cluster, namespace, job, sha256) (cortex_runtime_config_hash)) without(sha256) &gt; 1</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>1h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricbadruntimeconfig>MetricBadRuntimeConfig</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_2b8e132d38>
Copy</button></div><div id=clipboard_2b8e132d38><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricBadRuntimeConfig</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    {{ $labels.job }} failed to reload runtime config.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricbadruntimeconfig</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # The metric value is reset to 0 on error while reloading the config at runtime.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  cortex_runtime_config_last_reload_successful == 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricfrontendqueriesstuck>MetricFrontendQueriesStuck</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_1d1105b1aa>
Copy</button></div><div id=clipboard_1d1105b1aa><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricFrontendQueriesStuck</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    There are {{ $value }} queued up queries in {{ $labels.cluster }}/{{ $labels.namespace }} {{ $labels.job }}.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricfrontendqueriesstuck</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, job) (min_over_time(cortex_query_frontend_queue_length[1m])) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricschedulerqueriesstuck>MetricSchedulerQueriesStuck</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_af5c7fac4c>
Copy</button></div><div id=clipboard_af5c7fac4c><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricSchedulerQueriesStuck</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    There are {{ $value }} queued up queries in {{ $labels.cluster }}/{{ $labels.namespace }} {{ $labels.job }}.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricschedulerqueriesstuck</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, job) (min_over_time(cortex_query_scheduler_queue_length[1m])) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>7m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metriccacherequesterrors>MetricCacheRequestErrors</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_e6c4d70746>
Copy</button></div><div id=clipboard_e6c4d70746><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricCacheRequestErrors</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    The cache {{ $labels.name }} used by Metric {{ $labels.cluster }}/{{ $labels.namespace }} is experiencing {{ printf &#34;%.2f&#34; $value }}% errors for {{ $labels.operation }} operation.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metriccacherequesterrors</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by(cluster, namespace, name, operation) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      rate(thanos_memcached_operation_failures_total[1m])
</span></span></span><span style=display:flex><span><span style=color:#d88200>      or
</span></span></span><span style=display:flex><span><span style=color:#d88200>      rate(thanos_cache_operation_failures_total[1m])
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>    /
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by(cluster, namespace, name, operation) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      rate(thanos_memcached_operations_total[1m])
</span></span></span><span style=display:flex><span><span style=color:#d88200>      or
</span></span></span><span style=display:flex><span><span style=color:#d88200>      rate(thanos_cache_operations_total[1m])
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) * 100 &gt; 5</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=metricingesterrestarts>MetricIngesterRestarts</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_9a4ab0ae2a>
Copy</button></div><div id=clipboard_9a4ab0ae2a><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricIngesterRestarts</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} has restarted {{ printf &#34;%.2f&#34; $value }} times in the last 30 mins.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricingesterrestarts</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by(cluster, namespace, pod) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      increase(kube_pod_container_status_restarts_total{container=~&#34;(ingester|mimir-write)&#34;}[30m])
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>    &gt;= 2
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    count by(cluster, namespace, pod) (cortex_build_info) &gt; 0
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=metrickvstorefailure>MetricKVStoreFailure</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_79baeed66e>
Copy</button></div><div id=clipboard_79baeed66e><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricKVStoreFailure</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Metric {{ $labels.pod }} in  {{ $labels.cluster }}/{{ $labels.namespace }} is failing to talk to the KV store {{ $labels.kv_name }}.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metrickvstorefailure</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by(cluster, namespace, pod, status_code, kv_name) (rate(cortex_kv_request_duration_seconds_count{status_code!~&#34;2.+&#34;}[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>    /
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by(cluster, namespace, pod, status_code, kv_name) (rate(cortex_kv_request_duration_seconds_count[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # We want to get alerted only in case there&#39;s a constant failure.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  == 1</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricmemorymapareastoohigh>MetricMemoryMapAreasTooHigh</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_61127814f8>
Copy</button></div><div id=clipboard_61127814f8><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricMemoryMapAreasTooHigh</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#d88200>&#39;{{ $labels.job }}/{{ $labels.pod }} has a number of mmap-ed areas close to the limit.&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricmemorymapareastoohigh</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  process_memory_map_areas{job=~&#34;.*/(ingester.*|cortex|mimir|mimir-write.*|store-gateway.*|cortex|mimir|mimir-backend.*)&#34;} / process_memory_map_areas_limit{job=~&#34;.*/(ingester.*|cortex|mimir|mimir-write.*|store-gateway.*|cortex|mimir|mimir-backend.*)&#34;} &gt; 0.8</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricingesterinstancehasnotenants>MetricIngesterInstanceHasNoTenants</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_34fb7e6971>
Copy</button></div><div id=clipboard_34fb7e6971><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricIngesterInstanceHasNoTenants</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} has no tenants assigned.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricingesterinstancehasnotenants</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (min by(cluster, namespace, pod) (cortex_ingester_memory_users) == 0)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and on (cluster, namespace)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # Only if there are more time-series than would be expected due to continuous testing load
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by(cluster, namespace) (cortex_ingester_memory_series)
</span></span></span><span style=display:flex><span><span style=color:#d88200>    /
</span></span></span><span style=display:flex><span><span style=color:#d88200>    max by(cluster, namespace) (cortex_distributor_replication_factor)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 100000</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>1h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=metricrulerinstancehasnorulegroups>MetricRulerInstanceHasNoRuleGroups</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_98db2ddbe5>
Copy</button></div><div id=clipboard_98db2ddbe5><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricRulerInstanceHasNoRuleGroups</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric ruler {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} has no rule groups assigned.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricrulerinstancehasnorulegroups</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # Alert on ruler instances in microservices mode that have no rule groups assigned,
</span></span></span><span style=display:flex><span><span style=color:#d88200>  min by(cluster, namespace, pod) (cortex_ruler_managers_total{pod=~&#34;(.*mimir-)?ruler.*&#34;}) == 0
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # but only if other ruler instances of the same cell do have rule groups assigned
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and on (cluster, namespace)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (max by(cluster, namespace) (cortex_ruler_managers_total) &gt; 0)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # and there are more than two instances overall
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and on (cluster, namespace)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (count by (cluster, namespace) (cortex_ruler_managers_total) &gt; 2)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>1h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=metricingesteddatatoofarinthefuture>MetricIngestedDataTooFarInTheFuture</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_10109cb7dd>
Copy</button></div><div id=clipboard_10109cb7dd><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricIngestedDataTooFarInTheFuture</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} has ingested samples with timestamps more than 1h in the future.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricingesteddatatoofarinthefuture</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  max by(cluster, namespace, pod) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      cortex_ingester_tsdb_head_max_timestamp_seconds - time()
</span></span></span><span style=display:flex><span><span style=color:#d88200>      and
</span></span></span><span style=display:flex><span><span style=color:#d88200>      cortex_ingester_tsdb_head_max_timestamp_seconds &gt; 0
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 60*60</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=metricstoregatewaytoomanyfailedoperations>MetricStoreGatewayTooManyFailedOperations</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_ba840ada90>
Copy</button></div><div id=clipboard_ba840ada90><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricStoreGatewayTooManyFailedOperations</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric store-gateway {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is experiencing {{ $value | humanizePercentage }} errors while doing {{ $labels.operation }} on the object storage.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricstoregatewaytoomanyfailedoperations</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by(cluster, namespace, operation) (rate(thanos_objstore_bucket_operation_failures_total{component=&#34;store-gateway&#34;}[1m])) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=metricringmembersmismatch>MetricRingMembersMismatch</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_77c4105926>
Copy</button></div><div id=clipboard_77c4105926><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricRingMembersMismatch</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Number of members in Metric ingester hash ring does not match the expected number in {{ $labels.cluster }}/{{ $labels.namespace }}.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricringmembersmismatch</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    avg by(cluster, namespace) (sum by(cluster, namespace, pod) (cortex_ring_members{name=&#34;ingester&#34;,job=~&#34;.*/(ingester.*|cortex|mimir|mimir-write.*)&#34;}))
</span></span></span><span style=display:flex><span><span style=color:#d88200>    != sum by(cluster, namespace) (up{job=~&#34;.*/(ingester.*|cortex|mimir|mimir-write.*)&#34;})
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    count by(cluster, namespace) (cortex_build_info) &gt; 0
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>component</span><span style=color:#111>:</span> <span style=color:#ae81ff>ingester</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h3 id=mimir_instance_limits_alerts>mimir_instance_limits_alerts</h3><h5 id=metricingesterreachingserieslimit>MetricIngesterReachingSeriesLimit</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_025c2e8b18>
Copy</button></div><div id=clipboard_025c2e8b18><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricIngesterReachingSeriesLimit</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Ingester {{ $labels.job }}/{{ $labels.pod }} has reached {{ $value | humanizePercentage }} of its series limit.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricingesterreachingserieslimit</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      (cortex_ingester_memory_series / ignoring(limit) cortex_ingester_instance_limits{limit=&#34;max_series&#34;})
</span></span></span><span style=display:flex><span><span style=color:#d88200>      and ignoring (limit)
</span></span></span><span style=display:flex><span><span style=color:#d88200>      (cortex_ingester_instance_limits{limit=&#34;max_series&#34;} &gt; 0)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 0.8</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>3h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=metricingesterreachingserieslimit-1>MetricIngesterReachingSeriesLimit</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_376b160951>
Copy</button></div><div id=clipboard_376b160951><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricIngesterReachingSeriesLimit</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Ingester {{ $labels.job }}/{{ $labels.pod }} has reached {{ $value | humanizePercentage }} of its series limit.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricingesterreachingserieslimit</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      (cortex_ingester_memory_series / ignoring(limit) cortex_ingester_instance_limits{limit=&#34;max_series&#34;})
</span></span></span><span style=display:flex><span><span style=color:#d88200>      and ignoring (limit)
</span></span></span><span style=display:flex><span><span style=color:#d88200>      (cortex_ingester_instance_limits{limit=&#34;max_series&#34;} &gt; 0)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 0.9</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricingesterreachingtenantslimit>MetricIngesterReachingTenantsLimit</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_0f8f937b33>
Copy</button></div><div id=clipboard_0f8f937b33><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricIngesterReachingTenantsLimit</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Ingester {{ $labels.job }}/{{ $labels.pod }} has reached {{ $value | humanizePercentage }} of its tenant limit.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricingesterreachingtenantslimit</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      (cortex_ingester_memory_users / ignoring(limit) cortex_ingester_instance_limits{limit=&#34;max_tenants&#34;})
</span></span></span><span style=display:flex><span><span style=color:#d88200>      and ignoring (limit)
</span></span></span><span style=display:flex><span><span style=color:#d88200>      (cortex_ingester_instance_limits{limit=&#34;max_tenants&#34;} &gt; 0)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 0.7</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=metricingesterreachingtenantslimit-1>MetricIngesterReachingTenantsLimit</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_542c20fec8>
Copy</button></div><div id=clipboard_542c20fec8><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricIngesterReachingTenantsLimit</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Ingester {{ $labels.job }}/{{ $labels.pod }} has reached {{ $value | humanizePercentage }} of its tenant limit.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricingesterreachingtenantslimit</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      (cortex_ingester_memory_users / ignoring(limit) cortex_ingester_instance_limits{limit=&#34;max_tenants&#34;})
</span></span></span><span style=display:flex><span><span style=color:#d88200>      and ignoring (limit)
</span></span></span><span style=display:flex><span><span style=color:#d88200>      (cortex_ingester_instance_limits{limit=&#34;max_tenants&#34;} &gt; 0)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 0.8</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricreachingtcpconnectionslimit>MetricReachingTCPConnectionsLimit</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_c5b382409e>
Copy</button></div><div id=clipboard_c5b382409e><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricReachingTCPConnectionsLimit</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Metric instance {{ $labels.job }}/{{ $labels.pod }} has reached {{ $value | humanizePercentage }} of its TCP connections limit for {{ $labels.protocol }} protocol.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricreachingtcpconnectionslimit</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  cortex_tcp_connections / cortex_tcp_connections_limit &gt; 0.8 and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  cortex_tcp_connections_limit &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricdistributorreachinginflightpushrequestlimit>MetricDistributorReachingInflightPushRequestLimit</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_1613b669f3>
Copy</button></div><div id=clipboard_1613b669f3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricDistributorReachingInflightPushRequestLimit</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Distributor {{ $labels.job }}/{{ $labels.pod }} has reached {{ $value | humanizePercentage }} of its inflight push request limit.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricdistributorreachinginflightpushrequestlimit</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      (cortex_distributor_inflight_push_requests / ignoring(limit) cortex_distributor_instance_limits{limit=&#34;max_inflight_push_requests&#34;})
</span></span></span><span style=display:flex><span><span style=color:#d88200>      and ignoring (limit)
</span></span></span><span style=display:flex><span><span style=color:#d88200>      (cortex_distributor_instance_limits{limit=&#34;max_inflight_push_requests&#34;} &gt; 0)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 0.8</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h3 id=mimir-rollout-alerts>mimir-rollout-alerts</h3><h5 id=metricrolloutstuck>MetricRolloutStuck</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_0d4dc08acc>
Copy</button></div><div id=clipboard_0d4dc08acc><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricRolloutStuck</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    The {{ $labels.rollout_group }} rollout is stuck in {{ $labels.cluster }}/{{ $labels.namespace }}.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricrolloutstuck</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    max without (revision) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      sum without(statefulset) (label_replace(kube_statefulset_status_current_revision, &#34;rollout_group&#34;, &#34;$1&#34;, &#34;statefulset&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;))
</span></span></span><span style=display:flex><span><span style=color:#d88200>        unless
</span></span></span><span style=display:flex><span><span style=color:#d88200>      sum without(statefulset) (label_replace(kube_statefulset_status_update_revision, &#34;rollout_group&#34;, &#34;$1&#34;, &#34;statefulset&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;))
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>      *
</span></span></span><span style=display:flex><span><span style=color:#d88200>    (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      sum without(statefulset) (label_replace(kube_statefulset_replicas, &#34;rollout_group&#34;, &#34;$1&#34;, &#34;statefulset&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;))
</span></span></span><span style=display:flex><span><span style=color:#d88200>        !=
</span></span></span><span style=display:flex><span><span style=color:#d88200>      sum without(statefulset) (label_replace(kube_statefulset_status_replicas_updated, &#34;rollout_group&#34;, &#34;$1&#34;, &#34;statefulset&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;))
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) and (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    changes(sum without(statefulset) (label_replace(kube_statefulset_status_replicas_updated, &#34;rollout_group&#34;, &#34;$1&#34;, &#34;statefulset&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;))[15m:1m])
</span></span></span><span style=display:flex><span><span style=color:#d88200>      ==
</span></span></span><span style=display:flex><span><span style=color:#d88200>    0
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  * on(cluster, namespace) group_left max by(cluster, namespace) (cortex_build_info)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>30m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>workload_type</span><span style=color:#111>:</span> <span style=color:#ae81ff>statefulset</span>
</span></span></code></pre></div></div></div><h5 id=metricrolloutstuck-1>MetricRolloutStuck</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_f566ecfd25>
Copy</button></div><div id=clipboard_f566ecfd25><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricRolloutStuck</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    The {{ $labels.rollout_group }} rollout is stuck in {{ $labels.cluster }}/{{ $labels.namespace }}.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricrolloutstuck</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum without(deployment) (label_replace(kube_deployment_spec_replicas, &#34;rollout_group&#34;, &#34;$1&#34;, &#34;deployment&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;))
</span></span></span><span style=display:flex><span><span style=color:#d88200>      !=
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum without(deployment) (label_replace(kube_deployment_status_replicas_updated, &#34;rollout_group&#34;, &#34;$1&#34;, &#34;deployment&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) and (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    changes(sum without(deployment) (label_replace(kube_deployment_status_replicas_updated, &#34;rollout_group&#34;, &#34;$1&#34;, &#34;deployment&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;))[15m:1m])
</span></span></span><span style=display:flex><span><span style=color:#d88200>      ==
</span></span></span><span style=display:flex><span><span style=color:#d88200>    0
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  * on(cluster, namespace) group_left max by(cluster, namespace) (cortex_build_info)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>30m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>workload_type</span><span style=color:#111>:</span> <span style=color:#ae81ff>deployment</span>
</span></span></code></pre></div></div></div><h5 id=rolloutoperatornotreconciling>RolloutOperatorNotReconciling</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_be0769a32e>
Copy</button></div><div id=clipboard_be0769a32e><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>RolloutOperatorNotReconciling</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Rollout operator is not reconciling the rollout group {{ $labels.rollout_group }} in {{ $labels.cluster }}/{{ $labels.namespace }}.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#rolloutoperatornotreconciling</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  max by(cluster, namespace, rollout_group) (time() - rollout_operator_last_successful_group_reconcile_timestamp_seconds) &gt; 600</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h3 id=mimir-provisioning>mimir-provisioning</h3><h5 id=metricallocatingtoomuchmemory>MetricAllocatingTooMuchMemory</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_80172dd96b>
Copy</button></div><div id=clipboard_80172dd96b><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricAllocatingTooMuchMemory</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Instance {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is using too much memory.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricallocatingtoomuchmemory</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    # We use RSS instead of working set memory because of the ingester&#39;s extensive usage of mmap.
</span></span></span><span style=display:flex><span><span style=color:#d88200>    # See: https://github.com/grafana/mimir/issues/2466
</span></span></span><span style=display:flex><span><span style=color:#d88200>    container_memory_rss{container=~&#34;(ingester|mimir-write|mimir-backend)&#34;}
</span></span></span><span style=display:flex><span><span style=color:#d88200>      /
</span></span></span><span style=display:flex><span><span style=color:#d88200>    ( container_spec_memory_limit_bytes{container=~&#34;(ingester|mimir-write|mimir-backend)&#34;} &gt; 0 )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # Match only Mimir namespaces.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  * on(cluster, namespace) group_left max by(cluster, namespace) (cortex_build_info)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  &gt; 0.65</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=metricallocatingtoomuchmemory-1>MetricAllocatingTooMuchMemory</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_cda4ad9f20>
Copy</button></div><div id=clipboard_cda4ad9f20><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricAllocatingTooMuchMemory</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Instance {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is using too much memory.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricallocatingtoomuchmemory</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    # We use RSS instead of working set memory because of the ingester&#39;s extensive usage of mmap.
</span></span></span><span style=display:flex><span><span style=color:#d88200>    # See: https://github.com/grafana/mimir/issues/2466
</span></span></span><span style=display:flex><span><span style=color:#d88200>    container_memory_rss{container=~&#34;(ingester|mimir-write|mimir-backend)&#34;}
</span></span></span><span style=display:flex><span><span style=color:#d88200>      /
</span></span></span><span style=display:flex><span><span style=color:#d88200>    ( container_spec_memory_limit_bytes{container=~&#34;(ingester|mimir-write|mimir-backend)&#34;} &gt; 0 )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # Match only Mimir namespaces.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  * on(cluster, namespace) group_left max by(cluster, namespace) (cortex_build_info)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  &gt; 0.8</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h3 id=ruler_alerts>ruler_alerts</h3><h5 id=metricrulertoomanyfailedpushes>MetricRulerTooManyFailedPushes</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_8b7bb37b26>
Copy</button></div><div id=clipboard_8b7bb37b26><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricRulerTooManyFailedPushes</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Metric Ruler {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is experiencing {{ printf &#34;%.2f&#34; $value }}% write (push) errors.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricrulertoomanyfailedpushes</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  100 * (
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, pod) (rate(cortex_ruler_write_requests_failed_total[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>    /
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, pod) (rate(cortex_ruler_write_requests_total[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 1</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricrulertoomanyfailedqueries>MetricRulerTooManyFailedQueries</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_785daeead0>
Copy</button></div><div id=clipboard_785daeead0><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricRulerTooManyFailedQueries</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Metric Ruler {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is experiencing {{ printf &#34;%.2f&#34; $value }}% errors while evaluating rules.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricrulertoomanyfailedqueries</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  100 * (
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, pod) (rate(cortex_ruler_queries_failed_total[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>    /
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, pod) (rate(cortex_ruler_queries_total[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 1</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricrulermissedevaluations>MetricRulerMissedEvaluations</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_ac98c4723b>
Copy</button></div><div id=clipboard_ac98c4723b><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricRulerMissedEvaluations</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Metric Ruler {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is experiencing {{ printf &#34;%.2f&#34; $value }}% missed iterations for the rule group {{ $labels.rule_group }}.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricrulermissedevaluations</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  100 * (
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, pod, rule_group) (rate(cortex_prometheus_rule_group_iterations_missed_total[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>    /
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, pod, rule_group) (rate(cortex_prometheus_rule_group_iterations_total[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 1</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=metricrulerfailedringcheck>MetricRulerFailedRingCheck</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_4bc8c9ddcb>
Copy</button></div><div id=clipboard_4bc8c9ddcb><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricRulerFailedRingCheck</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Metric Rulers in {{ $labels.cluster }}/{{ $labels.namespace }} are experiencing errors when checking the ring for rule group ownership.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricrulerfailedringcheck</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, job) (rate(cortex_ruler_ring_check_errors_total[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>     &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricrulerremoteevaluationfailing>MetricRulerRemoteEvaluationFailing</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_18c5c733e6>
Copy</button></div><div id=clipboard_18c5c733e6><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricRulerRemoteEvaluationFailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Metric rulers in {{ $labels.cluster }}/{{ $labels.namespace }} are failing to perform {{ printf &#34;%.2f&#34; $value }}% of remote evaluations through the ruler-query-frontend.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricrulerremoteevaluationfailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  100 * (
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace) (rate(cortex_request_duration_seconds_count{route=&#34;/httpgrpc.HTTP/Handle&#34;, status_code=~&#34;5..&#34;, job=~&#34;.*/(ruler-query-frontend.*)&#34;}[5m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>    /
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace) (rate(cortex_request_duration_seconds_count{route=&#34;/httpgrpc.HTTP/Handle&#34;, job=~&#34;.*/(ruler-query-frontend.*)&#34;}[5m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 1</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h3 id=gossip_alerts>gossip_alerts</h3><h5 id=metricgossipmemberstoohigh>MetricGossipMembersTooHigh</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_a9367b6211>
Copy</button></div><div id=clipboard_a9367b6211><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricGossipMembersTooHigh</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>One or more Metric instances in {{ $labels.cluster }}/{{ $labels.namespace }} consistently sees a higher than expected number of gossip members.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricgossipmemberstoohigh</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  max by (cluster, namespace) (memberlist_client_cluster_members_count)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  &gt;
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (sum by (cluster, namespace) (up{job=~&#34;.+/(admin-api|alertmanager|compactor.*|distributor.*|ingester.*|querier.*|ruler|ruler-querier.*|store-gateway.*|cortex|mimir|mimir-write.*|mimir-read.*|mimir-backend.*)&#34;}) + 10)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>20m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=metricgossipmemberstoolow>MetricGossipMembersTooLow</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_938cc80c8c>
Copy</button></div><div id=clipboard_938cc80c8c><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricGossipMembersTooLow</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>One or more Metric instances in {{ $labels.cluster }}/{{ $labels.namespace }} consistently sees a lower than expected number of gossip members.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricgossipmemberstoolow</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  min by (cluster, namespace) (memberlist_client_cluster_members_count)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  &lt;
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (sum by (cluster, namespace) (up{job=~&#34;.+/(admin-api|alertmanager|compactor.*|distributor.*|ingester.*|querier.*|ruler|ruler-querier.*|store-gateway.*|cortex|mimir|mimir-write.*|mimir-read.*|mimir-backend.*)&#34;}) * 0.5)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>20m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h3 id=etcd_alerts>etcd_alerts</h3><h5 id=etcdallocatingtoomuchmemory>EtcdAllocatingTooMuchMemory</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_13143cbab9>
Copy</button></div><div id=clipboard_13143cbab9><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>EtcdAllocatingTooMuchMemory</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Too much memory being used by {{ $labels.namespace }}/{{ $labels.pod }} - bump memory limit.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#etcdallocatingtoomuchmemory</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    container_memory_working_set_bytes{container=&#34;etcd&#34;}
</span></span></span><span style=display:flex><span><span style=color:#d88200>      /
</span></span></span><span style=display:flex><span><span style=color:#d88200>    ( container_spec_memory_limit_bytes{container=&#34;etcd&#34;} &gt; 0 )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 0.65</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=etcdallocatingtoomuchmemory-1>EtcdAllocatingTooMuchMemory</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_f6894aaa7f>
Copy</button></div><div id=clipboard_f6894aaa7f><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>EtcdAllocatingTooMuchMemory</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Too much memory being used by {{ $labels.namespace }}/{{ $labels.pod }} - bump memory limit.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#etcdallocatingtoomuchmemory</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    container_memory_working_set_bytes{container=&#34;etcd&#34;}
</span></span></span><span style=display:flex><span><span style=color:#d88200>      /
</span></span></span><span style=display:flex><span><span style=color:#d88200>    ( container_spec_memory_limit_bytes{container=&#34;etcd&#34;} &gt; 0 )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; 0.8</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h3 id=alertmanager_alerts>alertmanager_alerts</h3><h5 id=metricalertmanagersyncconfigsfailing>MetricAlertmanagerSyncConfigsFailing</h5><p><a href=https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagersyncconfigsfailing>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagersyncconfigsfailing</a></p><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_1ba34941ca>
Copy</button></div><div id=clipboard_1ba34941ca><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricAlertmanagerSyncConfigsFailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Metric Alertmanager {{ $labels.job }}/{{ $labels.pod }} is failing to read tenant configurations from storage.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagersyncconfigsfailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  rate(cortex_alertmanager_sync_configs_failed_total[5m]) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>30m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricalertmanagerringcheckfailing>MetricAlertmanagerRingCheckFailing</h5><p><a href=https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagerringcheckfailing>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagerringcheckfailing</a></p><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_7f0687ae69>
Copy</button></div><div id=clipboard_7f0687ae69><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricAlertmanagerRingCheckFailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Metric Alertmanager {{ $labels.job }}/{{ $labels.pod }} is unable to check tenants ownership via the ring.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagerringcheckfailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  rate(cortex_alertmanager_ring_check_errors_total[2m]) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>10m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricalertmanagerpartialstatemergefailing>MetricAlertmanagerPartialStateMergeFailing</h5><p><a href=https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagerpartialstatemergefailing>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagerpartialstatemergefailing</a></p><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_721d61691e>
Copy</button></div><div id=clipboard_721d61691e><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricAlertmanagerPartialStateMergeFailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Metric Alertmanager {{ $labels.job }}/{{ $labels.pod }} is failing to merge partial state changes received from a replica.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagerpartialstatemergefailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  rate(cortex_alertmanager_partial_state_merges_failed_total[2m]) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>10m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricalertmanagerreplicationfailing>MetricAlertmanagerReplicationFailing</h5><p><a href=https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagerreplicationfailing>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagerreplicationfailing</a></p><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_9c181f0e1a>
Copy</button></div><div id=clipboard_9c181f0e1a><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricAlertmanagerReplicationFailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Metric Alertmanager {{ $labels.job }}/{{ $labels.pod }} is failing to replicating partial state to its replicas.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagerreplicationfailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  rate(cortex_alertmanager_state_replication_failed_total[2m]) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>10m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricalertmanagerpersiststatefailing>MetricAlertmanagerPersistStateFailing</h5><p><a href=https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagerpersiststatefailing>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagerpersiststatefailing</a></p><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_b8f62adc10>
Copy</button></div><div id=clipboard_b8f62adc10><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricAlertmanagerPersistStateFailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Metric Alertmanager {{ $labels.job }}/{{ $labels.pod }} is unable to persist full state snaphots to remote storage.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagerpersiststatefailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  rate(cortex_alertmanager_state_persist_failed_total[15m]) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>1h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricalertmanagerinitialsyncfailed>MetricAlertmanagerInitialSyncFailed</h5><p><a href=https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagerinitialsyncfailed>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagerinitialsyncfailed</a></p><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_c538655f73>
Copy</button></div><div id=clipboard_c538655f73><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricAlertmanagerInitialSyncFailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Metric Alertmanager {{ $labels.job }}/{{ $labels.pod }} was unable to obtain some initial state when starting up.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagerinitialsyncfailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  increase(cortex_alertmanager_state_initial_sync_completed_total{outcome=&#34;failed&#34;}[1m]) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricalertmanagerallocatingtoomuchmemory>MetricAlertmanagerAllocatingTooMuchMemory</h5><p><a href=https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagerallocatingtoomuchmemory>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagerallocatingtoomuchmemory</a></p><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_4589519074>
Copy</button></div><div id=clipboard_4589519074><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricAlertmanagerAllocatingTooMuchMemory</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Alertmanager {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is using too much memory.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagerallocatingtoomuchmemory</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (container_memory_working_set_bytes{container=&#34;alertmanager&#34;} / container_spec_memory_limit_bytes{container=&#34;alertmanager&#34;}) &gt; 0.80
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (container_spec_memory_limit_bytes{container=&#34;alertmanager&#34;} &gt; 0)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=metricalertmanagerallocatingtoomuchmemory-1>MetricAlertmanagerAllocatingTooMuchMemory</h5><p><a href=https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagerallocatingtoomuchmemory>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagerallocatingtoomuchmemory</a></p><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_62fb9d24b5>
Copy</button></div><div id=clipboard_62fb9d24b5><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricAlertmanagerAllocatingTooMuchMemory</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>    Alertmanager {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is using too much memory.</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagerallocatingtoomuchmemory</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (container_memory_working_set_bytes{container=&#34;alertmanager&#34;} / container_spec_memory_limit_bytes{container=&#34;alertmanager&#34;}) &gt; 0.90
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (container_spec_memory_limit_bytes{container=&#34;alertmanager&#34;} &gt; 0)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricalertmanagerinstancehasnotenants>MetricAlertmanagerInstanceHasNoTenants</h5><p>Metric alertmanager {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} owns no tenants.
<a href=https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagerinstancehasnotenants>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagerinstancehasnotenants</a></p><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_7436b93365>
Copy</button></div><div id=clipboard_7436b93365><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricAlertmanagerInstanceHasNoTenants</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric alertmanager {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} owns no tenants.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricalertmanagerinstancehasnotenants</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # Alert on alertmanager instances in microservices mode that own no tenants,
</span></span></span><span style=display:flex><span><span style=color:#d88200>  min by(cluster, namespace, pod) (cortex_alertmanager_tenants_owned{pod=~&#34;(.*mimir-)?alertmanager.*&#34;}) == 0
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # but only if other instances of the same cell do have tenants assigned.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and on (cluster, namespace)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  max by(cluster, namespace) (cortex_alertmanager_tenants_owned) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>1h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h3 id=mimir_blocks_alerts>mimir_blocks_alerts</h3><h5 id=metricingesterhasnotshippedblocks>MetricIngesterHasNotShippedBlocks</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_453cfe779f>
Copy</button></div><div id=clipboard_453cfe779f><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricIngesterHasNotShippedBlocks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric Ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} has not shipped any block in the last 4 hours.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricingesterhasnotshippedblocks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (min by(cluster, namespace, pod) (time() - cortex_ingester_shipper_last_successful_upload_timestamp_seconds) &gt; 60 * 60 * 4)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (max by(cluster, namespace, pod) (cortex_ingester_shipper_last_successful_upload_timestamp_seconds) &gt; 0)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # Only if the ingester has ingested samples over the last 4h.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (max by(cluster, namespace, pod) (max_over_time(cluster_namespace_pod:cortex_ingester_ingested_samples_total:rate1m[4h])) &gt; 0)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # Only if the ingester was ingesting samples 4h ago. This protects against the case where the ingester replica
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # had ingested samples in the past, then no traffic was received for a long period and then it starts
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # receiving samples again. Without this check, the alert would fire as soon as it gets back receiving
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # samples, while the a block shipping is expected within the next 4h.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (max by(cluster, namespace, pod) (max_over_time(cluster_namespace_pod:cortex_ingester_ingested_samples_total:rate1m[1h] offset 4h)) &gt; 0)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricingesterhasnotshippedblockssincestart>MetricIngesterHasNotShippedBlocksSinceStart</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_0b3f9c9c80>
Copy</button></div><div id=clipboard_0b3f9c9c80><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricIngesterHasNotShippedBlocksSinceStart</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric Ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} has not shipped any block in the last 4 hours.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricingesterhasnotshippedblockssincestart</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (max by(cluster, namespace, pod) (cortex_ingester_shipper_last_successful_upload_timestamp_seconds) == 0)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (max by(cluster, namespace, pod) (max_over_time(cluster_namespace_pod:cortex_ingester_ingested_samples_total:rate1m[4h])) &gt; 0)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>4h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricingesterhasunshippedblocks>MetricIngesterHasUnshippedBlocks</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_8adc11ef7a>
Copy</button></div><div id=clipboard_8adc11ef7a><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricIngesterHasUnshippedBlocks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric Ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} has compacted a block {{ $value | humanizeDuration }} ago but it hasn&#39;t been successfully uploaded to the storage yet.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricingesterhasunshippedblocks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (time() - cortex_ingester_oldest_unshipped_block_timestamp_seconds &gt; 3600)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (cortex_ingester_oldest_unshipped_block_timestamp_seconds &gt; 0)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricingestertsdbheadcompactionfailed>MetricIngesterTSDBHeadCompactionFailed</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_f8a0071dbd>
Copy</button></div><div id=clipboard_f8a0071dbd><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricIngesterTSDBHeadCompactionFailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric Ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is failing to compact TSDB head.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricingestertsdbheadcompactionfailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  rate(cortex_ingester_tsdb_compactions_failed_total[5m]) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricingestertsdbheadtruncationfailed>MetricIngesterTSDBHeadTruncationFailed</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_0cf04cdf8f>
Copy</button></div><div id=clipboard_0cf04cdf8f><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricIngesterTSDBHeadTruncationFailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric Ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is failing to truncate TSDB head.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricingestertsdbheadtruncationfailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  rate(cortex_ingester_tsdb_head_truncations_failed_total[5m]) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricingestertsdbcheckpointcreationfailed>MetricIngesterTSDBCheckpointCreationFailed</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_79a94aed04>
Copy</button></div><div id=clipboard_79a94aed04><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricIngesterTSDBCheckpointCreationFailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric Ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is failing to create TSDB checkpoint.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricingestertsdbcheckpointcreationfailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  rate(cortex_ingester_tsdb_checkpoint_creations_failed_total[5m]) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricingestertsdbcheckpointdeletionfailed>MetricIngesterTSDBCheckpointDeletionFailed</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_9e5ee21c01>
Copy</button></div><div id=clipboard_9e5ee21c01><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricIngesterTSDBCheckpointDeletionFailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric Ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is failing to delete TSDB checkpoint.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricingestertsdbcheckpointdeletionfailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  rate(cortex_ingester_tsdb_checkpoint_deletions_failed_total[5m]) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricingestertsdbwaltruncationfailed>MetricIngesterTSDBWALTruncationFailed</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_6b57efc955>
Copy</button></div><div id=clipboard_6b57efc955><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricIngesterTSDBWALTruncationFailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric Ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is failing to truncate TSDB WAL.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricingestertsdbwaltruncationfailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  rate(cortex_ingester_tsdb_wal_truncations_failed_total[5m]) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=metricingestertsdbwalcorrupted>MetricIngesterTSDBWALCorrupted</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_16629aaca8>
Copy</button></div><div id=clipboard_16629aaca8><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricIngesterTSDBWALCorrupted</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric Ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} got a corrupted TSDB WAL.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricingestertsdbwalcorrupted</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # alert when there are more than one corruptions
</span></span></span><span style=display:flex><span><span style=color:#d88200>  count by (cluster, namespace) (rate(cortex_ingester_tsdb_wal_corruptions_total[5m]) &gt; 0) &gt; 1
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # and there is only one zone
</span></span></span><span style=display:flex><span><span style=color:#d88200>  count by (cluster, namespace) (group by (cluster, namespace, job) (cortex_ingester_tsdb_wal_corruptions_total)) == 1</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>deployment</span><span style=color:#111>:</span> <span style=color:#ae81ff>single-zone</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricingestertsdbwalcorrupted-1>MetricIngesterTSDBWALCorrupted</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_2346a67c15>
Copy</button></div><div id=clipboard_2346a67c15><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricIngesterTSDBWALCorrupted</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric Ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} got a corrupted TSDB WAL.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricingestertsdbwalcorrupted</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # alert when there are more than one corruptions
</span></span></span><span style=display:flex><span><span style=color:#d88200>  count by (cluster, namespace) (sum by (cluster, namespace, job) (rate(cortex_ingester_tsdb_wal_corruptions_total[5m]) &gt; 0)) &gt; 1
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # and there are multiple zones
</span></span></span><span style=display:flex><span><span style=color:#d88200>  count by (cluster, namespace) (group by (cluster, namespace, job) (cortex_ingester_tsdb_wal_corruptions_total)) &gt; 1</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>deployment</span><span style=color:#111>:</span> <span style=color:#ae81ff>multi-zone</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricingestertsdbwalwritesfailed>MetricIngesterTSDBWALWritesFailed</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_7506d57a8f>
Copy</button></div><div id=clipboard_7506d57a8f><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricIngesterTSDBWALWritesFailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric Ingester {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is failing to write to TSDB WAL.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricingestertsdbwalwritesfailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  rate(cortex_ingester_tsdb_wal_writes_failed_total[1m]) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>3m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricstoregatewayhasnotsyncthebucket>MetricStoreGatewayHasNotSyncTheBucket</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_7bbb29912a>
Copy</button></div><div id=clipboard_7bbb29912a><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricStoreGatewayHasNotSyncTheBucket</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric store-gateway {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} has not successfully synched the bucket since {{ $value | humanizeDuration }}.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricstoregatewayhasnotsyncthebucket</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (time() - cortex_bucket_stores_blocks_last_successful_sync_timestamp_seconds{component=&#34;store-gateway&#34;} &gt; 60 * 30)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  cortex_bucket_stores_blocks_last_successful_sync_timestamp_seconds{component=&#34;store-gateway&#34;} &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricstoregatewaynosyncedtenants>MetricStoreGatewayNoSyncedTenants</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_486351ed59>
Copy</button></div><div id=clipboard_486351ed59><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricStoreGatewayNoSyncedTenants</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric store-gateway {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is not syncing any blocks for any tenant.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricstoregatewaynosyncedtenants</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  min by(cluster, namespace, pod) (cortex_bucket_stores_tenants_synced{component=&#34;store-gateway&#34;}) == 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>1h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=metricbucketindexnotupdated>MetricBucketIndexNotUpdated</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_beeead4e87>
Copy</button></div><div id=clipboard_beeead4e87><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricBucketIndexNotUpdated</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric bucket index for tenant {{ $labels.user }} in {{ $labels.cluster }}/{{ $labels.namespace }} has not been updated since {{ $value | humanizeDuration }}.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricbucketindexnotupdated</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  min by(cluster, namespace, user) (time() - cortex_bucket_index_last_successful_update_timestamp_seconds) &gt; 2100</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h3 id=mimir_compactor_alerts>mimir_compactor_alerts</h3><h5 id=metriccompactorhasnotsuccessfullycleanedupblocks>MetricCompactorHasNotSuccessfullyCleanedUpBlocks</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_29cddc8496>
Copy</button></div><div id=clipboard_29cddc8496><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricCompactorHasNotSuccessfullyCleanedUpBlocks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric Compactor {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} has not successfully cleaned up blocks in the last 6 hours.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metriccompactorhasnotsuccessfullycleanedupblocks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # The &#34;last successful run&#34; metric is updated even if the compactor owns no tenants,
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # so this alert correctly doesn&#39;t fire if compactor has nothing to do.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (time() - cortex_compactor_block_cleanup_last_successful_run_timestamp_seconds &gt; 60 * 60 * 6)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>1h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metriccompactorhasnotsuccessfullyruncompaction>MetricCompactorHasNotSuccessfullyRunCompaction</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_143e3daedd>
Copy</button></div><div id=clipboard_143e3daedd><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricCompactorHasNotSuccessfullyRunCompaction</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric Compactor {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} has not run compaction in the last 24 hours.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metriccompactorhasnotsuccessfullyruncompaction</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # The &#34;last successful run&#34; metric is updated even if the compactor owns no tenants,
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # so this alert correctly doesn&#39;t fire if compactor has nothing to do.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (time() - cortex_compactor_last_successful_run_timestamp_seconds &gt; 60 * 60 * 24)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (cortex_compactor_last_successful_run_timestamp_seconds &gt; 0)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>1h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reason</span><span style=color:#111>:</span> <span style=color:#ae81ff>in-last-24h</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metriccompactorhasnotsuccessfullyruncompaction-1>MetricCompactorHasNotSuccessfullyRunCompaction</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_108e7997d8>
Copy</button></div><div id=clipboard_108e7997d8><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricCompactorHasNotSuccessfullyRunCompaction</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric Compactor {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} has not run compaction in the last 24 hours.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metriccompactorhasnotsuccessfullyruncompaction</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # The &#34;last successful run&#34; metric is updated even if the compactor owns no tenants,
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # so this alert correctly doesn&#39;t fire if compactor has nothing to do.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  cortex_compactor_last_successful_run_timestamp_seconds == 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>24h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reason</span><span style=color:#111>:</span> <span style=color:#ae81ff>since-startup</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metriccompactorhasnotsuccessfullyruncompaction-2>MetricCompactorHasNotSuccessfullyRunCompaction</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_f092aec95f>
Copy</button></div><div id=clipboard_f092aec95f><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricCompactorHasNotSuccessfullyRunCompaction</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric Compactor {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} failed to run 2 consecutive compactions.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metriccompactorhasnotsuccessfullyruncompaction</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  increase(cortex_compactor_runs_failed_total{reason!=&#34;shutdown&#34;}[2h]) &gt;= 2</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reason</span><span style=color:#111>:</span> <span style=color:#ae81ff>consecutive-failures</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metriccompactorhasnotuploadedblocks>MetricCompactorHasNotUploadedBlocks</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_fe7397b73c>
Copy</button></div><div id=clipboard_fe7397b73c><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricCompactorHasNotUploadedBlocks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric Compactor {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} has not uploaded any block in the last 24 hours.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metriccompactorhasnotuploadedblocks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (time() - (max by(cluster, namespace, pod) (thanos_objstore_bucket_last_successful_upload_time{component=&#34;compactor&#34;})) &gt; 60 * 60 * 24)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (max by(cluster, namespace, pod) (thanos_objstore_bucket_last_successful_upload_time{component=&#34;compactor&#34;}) &gt; 0)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # Only if some compactions have started. We don&#39;t want to fire this alert if the compactor has nothing to do
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # (e.g. there are more replicas than required because running as part of mimir-backend).
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (sum by(cluster, namespace, pod) (rate(cortex_compactor_group_compaction_runs_started_total[24h])) &gt; 0)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>time_period</span><span style=color:#111>:</span> <span style=color:#ae81ff>24h</span>
</span></span></code></pre></div></div></div><h5 id=metriccompactorhasnotuploadedblocks-1>MetricCompactorHasNotUploadedBlocks</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_78ebbc1c48>
Copy</button></div><div id=clipboard_78ebbc1c48><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricCompactorHasNotUploadedBlocks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric Compactor {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} has not uploaded any block since its start.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metriccompactorhasnotuploadedblocks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (max by(cluster, namespace, pod) (thanos_objstore_bucket_last_successful_upload_time{component=&#34;compactor&#34;}) == 0)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # Only if some compactions have started. We don&#39;t want to fire this alert if the compactor has nothing to do
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # (e.g. there are more replicas than required because running as part of mimir-backend).
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (sum by(cluster, namespace, pod) (rate(cortex_compactor_group_compaction_runs_started_total[24h])) &gt; 0)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>24h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>time_period</span><span style=color:#111>:</span> <span style=color:#ae81ff>since-start</span>
</span></span></code></pre></div></div></div><h5 id=metriccompactorskippedunhealthyblocks>MetricCompactorSkippedUnhealthyBlocks</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_516377f12a>
Copy</button></div><div id=clipboard_516377f12a><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricCompactorSkippedUnhealthyBlocks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric Compactor {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} has found and ignored unhealthy blocks.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metriccompactorskippedunhealthyblocks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  increase(cortex_compactor_blocks_marked_for_no_compaction_total[5m]) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>1m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=metriccompactorskippedunhealthyblocks-1>MetricCompactorSkippedUnhealthyBlocks</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_e71f943138>
Copy</button></div><div id=clipboard_e71f943138><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricCompactorSkippedUnhealthyBlocks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric Compactor {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} has found and ignored unhealthy blocks.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metriccompactorskippedunhealthyblocks</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  increase(cortex_compactor_blocks_marked_for_no_compaction_total[5m]) &gt; 1</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>30m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h3 id=mimir_autoscaling>mimir_autoscaling</h3><h5 id=metricautoscalernotactive>MetricAutoscalerNotActive</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_1baaace1fc>
Copy</button></div><div id=clipboard_1baaace1fc><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricAutoscalerNotActive</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>The Horizontal Pod Autoscaler (HPA) {{ $labels.horizontalpodautoscaler }} in {{ $labels.namespace }} is not active.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricautoscalernotactive</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      label_replace((
</span></span></span><span style=display:flex><span><span style=color:#d88200>        kube_horizontalpodautoscaler_status_condition{condition=&#34;ScalingActive&#34;,status=&#34;false&#34;}
</span></span></span><span style=display:flex><span><span style=color:#d88200>        # Match only Mimir namespaces.
</span></span></span><span style=display:flex><span><span style=color:#d88200>        * on(cluster, namespace) group_left max by(cluster, namespace) (cortex_build_info)
</span></span></span><span style=display:flex><span><span style=color:#d88200>        # Add &#34;metric&#34; label.
</span></span></span><span style=display:flex><span><span style=color:#d88200>        + on(cluster, namespace, horizontalpodautoscaler) group_right label_replace(kube_horizontalpodautoscaler_spec_target_metric*0, &#34;metric&#34;, &#34;$1&#34;, &#34;metric_name&#34;, &#34;(.+)&#34;)
</span></span></span><span style=display:flex><span><span style=color:#d88200>        &gt; 0),
</span></span></span><span style=display:flex><span><span style=color:#d88200>        &#34;scaledObject&#34;, &#34;$1&#34;, &#34;horizontalpodautoscaler&#34;, &#34;keda-hpa-(.*)&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>      )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # Alert only if the scaling metric exists and is &gt; 0. If the KEDA ScaledObject is configured to scale down 0,
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # then HPA ScalingActive may be false when expected to run 0 replicas. In this case, the scaling metric exported
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # by KEDA could not exist at all or being exposed with a value of 0.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  and on (cluster, namespace, metric, scaledObject)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (label_replace(keda_scaler_metrics_value, &#34;namespace&#34;, &#34;$0&#34;, &#34;exported_namespace&#34;, &#34;.+&#34;) &gt; 0)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>1h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricautoscalerkedafailing>MetricAutoscalerKedaFailing</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_1a95195053>
Copy</button></div><div id=clipboard_1a95195053><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricAutoscalerKedaFailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>The Keda ScaledObject {{ $labels.scaledObject }} in {{ $labels.namespace }} is experiencing errors.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricautoscalerkedafailing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      # Find KEDA scalers reporting errors.
</span></span></span><span style=display:flex><span><span style=color:#d88200>      label_replace(rate(keda_scaler_errors[5m]), &#34;namespace&#34;, &#34;$1&#34;, &#34;exported_namespace&#34;, &#34;(.*)&#34;)
</span></span></span><span style=display:flex><span><span style=color:#d88200>      # Match only Mimir namespaces.
</span></span></span><span style=display:flex><span><span style=color:#d88200>      * on(cluster, namespace) group_left max by(cluster, namespace) (cortex_build_info)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>1h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h3 id=mimir_ingest_storage_alerts>mimir_ingest_storage_alerts</h3><h5 id=metricingesterlastconsumedoffsetcommitfailed>MetricIngesterLastConsumedOffsetCommitFailed</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_0d0458ab26>
Copy</button></div><div id=clipboard_0d0458ab26><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricIngesterLastConsumedOffsetCommitFailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is failing to commit the last consumed offset.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricingesterlastconsumedoffsetcommitfailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by(cluster, namespace, pod) (rate(cortex_ingest_storage_reader_offset_commit_failures_total[5m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  /
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by(cluster, namespace, pod) (rate(cortex_ingest_storage_reader_offset_commit_requests_total[5m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  &gt; 0.2</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricingesterfailedtoreadrecordsfromkafka>MetricIngesterFailedToReadRecordsFromKafka</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_ff8177e949>
Copy</button></div><div id=clipboard_ff8177e949><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricIngesterFailedToReadRecordsFromKafka</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is failing to read records from Kafka.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricingesterfailedtoreadrecordsfromkafka</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by(cluster, namespace, pod, node_id) (rate(cortex_ingest_storage_reader_read_errors_total[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricingesterkafkafetcherrorsratetoohigh>MetricIngesterKafkaFetchErrorsRateTooHigh</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_b4336435e5>
Copy</button></div><div id=clipboard_b4336435e5><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricIngesterKafkaFetchErrorsRateTooHigh</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} is receiving fetch errors when reading records from Kafka.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricingesterkafkafetcherrorsratetoohigh</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, pod) (rate (cortex_ingest_storage_reader_fetch_errors_total[5m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  /
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, pod) (rate (cortex_ingest_storage_reader_fetches_total[5m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  &gt; 0.1</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricstartingingesterkafkareceivedelayincreasing>MetricStartingIngesterKafkaReceiveDelayIncreasing</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_c5b39e7da9>
Copy</button></div><div id=clipboard_c5b39e7da9><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricStartingIngesterKafkaReceiveDelayIncreasing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} in &#34;starting&#34; phase is not reducing consumption lag of write requests read from Kafka.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricstartingingesterkafkareceivedelayincreasing</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  deriv((
</span></span></span><span style=display:flex><span><span style=color:#d88200>      sum by (cluster, namespace, pod) (rate(cortex_ingest_storage_reader_receive_delay_seconds_sum{phase=&#34;starting&#34;}[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>      /
</span></span></span><span style=display:flex><span><span style=color:#d88200>      sum by (cluster, namespace, pod) (rate(cortex_ingest_storage_reader_receive_delay_seconds_count{phase=&#34;starting&#34;}[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )[5m:1m]) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=metricrunningingesterreceivedelaytoohigh>MetricRunningIngesterReceiveDelayTooHigh</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_17d1a54920>
Copy</button></div><div id=clipboard_17d1a54920><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricRunningIngesterReceiveDelayTooHigh</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} in &#34;running&#34; phase is too far behind in its consumption of write requests from Kafka.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricrunningingesterreceivedelaytoohigh</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by (cluster, namespace, pod) (rate(cortex_ingest_storage_reader_receive_delay_seconds_sum{phase=&#34;running&#34;}[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>    /
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by (cluster, namespace, pod) (rate(cortex_ingest_storage_reader_receive_delay_seconds_count{phase=&#34;running&#34;}[1m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ) &gt; (10 * 60)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricingesterfailstoprocessrecordsfromkafka>MetricIngesterFailsToProcessRecordsFromKafka</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_cc5ea77d44>
Copy</button></div><div id=clipboard_cc5ea77d44><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricIngesterFailsToProcessRecordsFromKafka</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} fails to consume write requests read from Kafka due to internal errors.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricingesterfailstoprocessrecordsfromkafka</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, pod) (rate(cortex_ingest_storage_reader_records_failed_total{cause=&#34;server&#34;}[1m])) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=metricingesterfailsenforcestrongconsistencyonreadpath>MetricIngesterFailsEnforceStrongConsistencyOnReadPath</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_9b75360790>
Copy</button></div><div id=clipboard_9b75360790><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricIngesterFailsEnforceStrongConsistencyOnReadPath</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric {{ $labels.pod }} in {{ $labels.cluster }}/{{ $labels.namespace }} fails to enforce strong-consistency on read-path.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metricingesterfailsenforcestrongconsistencyonreadpath</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, pod) (rate(cortex_ingest_storage_strong_consistency_failures_total[1m])) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h3 id=mimir_continuous_test>mimir_continuous_test</h3><h5 id=metriccontinuoustestnotrunningonwrites>MetricContinuousTestNotRunningOnWrites</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_9b1ee7898e>
Copy</button></div><div id=clipboard_9b1ee7898e><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricContinuousTestNotRunningOnWrites</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric continuous test {{ $labels.test }} in {{ $labels.cluster }}/{{ $labels.namespace }} is not effectively running because writes are failing.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metriccontinuoustestnotrunningonwrites</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by(cluster, namespace, test) (rate(mimir_continuous_test_writes_failed_total[5m])) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>1h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=metriccontinuoustestnotrunningonreads>MetricContinuousTestNotRunningOnReads</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_c9951b7eda>
Copy</button></div><div id=clipboard_c9951b7eda><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricContinuousTestNotRunningOnReads</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric continuous test {{ $labels.test }} in {{ $labels.cluster }}/{{ $labels.namespace }} is not effectively running because queries are failing.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metriccontinuoustestnotrunningonreads</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by(cluster, namespace, test) (rate(mimir_continuous_test_queries_failed_total[5m])) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>1h</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=metriccontinuoustestfailed>MetricContinuousTestFailed</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_6374f5f13c>
Copy</button></div><div id=clipboard_6374f5f13c><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>MetricContinuousTestFailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>message</span><span style=color:#111>:</span> <span style=color:#ae81ff>Metric continuous test {{ $labels.test }} in {{ $labels.cluster }}/{{ $labels.namespace }} failed when asserting query results.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#metriccontinuoustestfailed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by(cluster, namespace, test) (rate(mimir_continuous_test_query_result_checks_failed_total[10m])) &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h2 id=recording-rules>Recording Rules</h2><div class="card my-3 border-top-0 border-right-0 border-bottom-0 border-left border-warning rounded" style=border-width:4px!important><div class="wrap border border-left-0 rounded"><div class="card-body pt-1">指标计算Recording规则配置列表 <a href=https://github.com/observeproject/sites/blob/main/assets/mimir/rules.yaml>源文件</a>.</div></div></div><h3 id=mimir_api_1>mimir_api_1</h3><h5 id=cluster_jobcortex_request_duration_seconds99quantile>cluster_job:cortex_request_duration_seconds:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_3bbc8e6a47>
Copy</button></div><div id=clipboard_3bbc8e6a47><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_request_duration_seconds_bucket[1m])) by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_request_duration_seconds:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_request_duration_seconds50quantile>cluster_job:cortex_request_duration_seconds:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_563685eb8c>
Copy</button></div><div id=clipboard_563685eb8c><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_request_duration_seconds_bucket[1m])) by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_request_duration_seconds:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_request_duration_secondsavg>cluster_job:cortex_request_duration_seconds:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_8733e66d85>
Copy</button></div><div id=clipboard_8733e66d85><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds_sum[1m])) by (cluster, job) / sum(rate(cortex_request_duration_seconds_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_request_duration_seconds:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_request_duration_seconds_bucketsum_rate>cluster_job:cortex_request_duration_seconds_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_7e06e22c31>
Copy</button></div><div id=clipboard_7e06e22c31><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds_bucket[1m])) by (le, cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_request_duration_seconds_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_request_duration_seconds_sumsum_rate>cluster_job:cortex_request_duration_seconds_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_7f3bbe92bd>
Copy</button></div><div id=clipboard_7f3bbe92bd><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds_sum[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_request_duration_seconds_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_request_duration_seconds_countsum_rate>cluster_job:cortex_request_duration_seconds_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_51a7c37000>
Copy</button></div><div id=clipboard_51a7c37000><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_request_duration_seconds_count:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_request_duration_secondssum_rate>cluster_job:cortex_request_duration_seconds:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_26ef883ecd>
Copy</button></div><div id=clipboard_26ef883ecd><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_request_duration_seconds:sum_rate</span>
</span></span></code></pre></div></div></div><h3 id=mimir_api_2>mimir_api_2</h3><h5 id=cluster_job_routecortex_request_duration_seconds99quantile>cluster_job_route:cortex_request_duration_seconds:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_12f943f002>
Copy</button></div><div id=clipboard_12f943f002><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_request_duration_seconds_bucket[1m])) by (le, cluster, job, route))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_request_duration_seconds:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_routecortex_request_duration_seconds50quantile>cluster_job_route:cortex_request_duration_seconds:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_59af7bf602>
Copy</button></div><div id=clipboard_59af7bf602><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_request_duration_seconds_bucket[1m])) by (le, cluster, job, route))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_request_duration_seconds:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_routecortex_request_duration_secondsavg>cluster_job_route:cortex_request_duration_seconds:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_20f2a64988>
Copy</button></div><div id=clipboard_20f2a64988><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds_sum[1m])) by (cluster, job, route) / sum(rate(cortex_request_duration_seconds_count[1m])) by (cluster, job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_request_duration_seconds:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_routecortex_request_duration_seconds_bucketsum_rate>cluster_job_route:cortex_request_duration_seconds_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_432b49327b>
Copy</button></div><div id=clipboard_432b49327b><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds_bucket[1m])) by (le, cluster, job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_request_duration_seconds_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_routecortex_request_duration_seconds_sumsum_rate>cluster_job_route:cortex_request_duration_seconds_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_ffb86f54a1>
Copy</button></div><div id=clipboard_ffb86f54a1><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds_sum[1m])) by (cluster, job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_request_duration_seconds_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_routecortex_request_duration_seconds_countsum_rate>cluster_job_route:cortex_request_duration_seconds_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_774cf15841>
Copy</button></div><div id=clipboard_774cf15841><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds_count[1m])) by (cluster, job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_request_duration_seconds_count:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_routecortex_request_duration_secondssum_rate>cluster_job_route:cortex_request_duration_seconds:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_49776b9366>
Copy</button></div><div id=clipboard_49776b9366><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds[1m])) by (cluster, job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_request_duration_seconds:sum_rate</span>
</span></span></code></pre></div></div></div><h3 id=mimir_api_3>mimir_api_3</h3><h5 id=cluster_namespace_job_routecortex_request_duration_seconds99quantile>cluster_namespace_job_route:cortex_request_duration_seconds:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_d57eef675a>
Copy</button></div><div id=clipboard_d57eef675a><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_request_duration_seconds_bucket[1m])) by (le, cluster, namespace, job, route))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_request_duration_seconds:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routecortex_request_duration_seconds50quantile>cluster_namespace_job_route:cortex_request_duration_seconds:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_c546012cec>
Copy</button></div><div id=clipboard_c546012cec><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_request_duration_seconds_bucket[1m])) by (le, cluster, namespace, job, route))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_request_duration_seconds:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routecortex_request_duration_secondsavg>cluster_namespace_job_route:cortex_request_duration_seconds:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_95aa979335>
Copy</button></div><div id=clipboard_95aa979335><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds_sum[1m])) by (cluster, namespace, job, route) / sum(rate(cortex_request_duration_seconds_count[1m])) by (cluster, namespace, job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_request_duration_seconds:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routecortex_request_duration_seconds_bucketsum_rate>cluster_namespace_job_route:cortex_request_duration_seconds_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_95cd4cb98f>
Copy</button></div><div id=clipboard_95cd4cb98f><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds_bucket[1m])) by (le, cluster, namespace, job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_request_duration_seconds_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routecortex_request_duration_seconds_sumsum_rate>cluster_namespace_job_route:cortex_request_duration_seconds_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_b99f583ec1>
Copy</button></div><div id=clipboard_b99f583ec1><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds_sum[1m])) by (cluster, namespace, job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_request_duration_seconds_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routecortex_request_duration_seconds_countsum_rate>cluster_namespace_job_route:cortex_request_duration_seconds_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_7ae7df86dc>
Copy</button></div><div id=clipboard_7ae7df86dc><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds_count[1m])) by (cluster, namespace, job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_request_duration_seconds_count:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routecortex_request_duration_secondssum_rate>cluster_namespace_job_route:cortex_request_duration_seconds:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_f561862055>
Copy</button></div><div id=clipboard_f561862055><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_request_duration_seconds[1m])) by (cluster, namespace, job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_request_duration_seconds:sum_rate</span>
</span></span></code></pre></div></div></div><h3 id=mimir_querier_api>mimir_querier_api</h3><h5 id=cluster_jobcortex_querier_request_duration_seconds99quantile>cluster_job:cortex_querier_request_duration_seconds:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_e313f1505f>
Copy</button></div><div id=clipboard_e313f1505f><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_querier_request_duration_seconds_bucket[1m])) by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_querier_request_duration_seconds:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_querier_request_duration_seconds50quantile>cluster_job:cortex_querier_request_duration_seconds:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_96472375ec>
Copy</button></div><div id=clipboard_96472375ec><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_querier_request_duration_seconds_bucket[1m])) by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_querier_request_duration_seconds:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_querier_request_duration_secondsavg>cluster_job:cortex_querier_request_duration_seconds:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_a5e0fbad1d>
Copy</button></div><div id=clipboard_a5e0fbad1d><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_querier_request_duration_seconds_sum[1m])) by (cluster, job) / sum(rate(cortex_querier_request_duration_seconds_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_querier_request_duration_seconds:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_querier_request_duration_seconds_bucketsum_rate>cluster_job:cortex_querier_request_duration_seconds_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_be67c85ca0>
Copy</button></div><div id=clipboard_be67c85ca0><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_querier_request_duration_seconds_bucket[1m])) by (le, cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_querier_request_duration_seconds_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_querier_request_duration_seconds_sumsum_rate>cluster_job:cortex_querier_request_duration_seconds_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_3d4163220d>
Copy</button></div><div id=clipboard_3d4163220d><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_querier_request_duration_seconds_sum[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_querier_request_duration_seconds_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_querier_request_duration_seconds_countsum_rate>cluster_job:cortex_querier_request_duration_seconds_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_a719c8ea94>
Copy</button></div><div id=clipboard_a719c8ea94><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_querier_request_duration_seconds_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_querier_request_duration_seconds_count:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_routecortex_querier_request_duration_seconds99quantile>cluster_job_route:cortex_querier_request_duration_seconds:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_ca694a34b5>
Copy</button></div><div id=clipboard_ca694a34b5><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_querier_request_duration_seconds_bucket[1m])) by (le, cluster, job, route))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_querier_request_duration_seconds:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_routecortex_querier_request_duration_seconds50quantile>cluster_job_route:cortex_querier_request_duration_seconds:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_327c533acd>
Copy</button></div><div id=clipboard_327c533acd><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_querier_request_duration_seconds_bucket[1m])) by (le, cluster, job, route))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_querier_request_duration_seconds:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_routecortex_querier_request_duration_secondsavg>cluster_job_route:cortex_querier_request_duration_seconds:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_7d33d235ef>
Copy</button></div><div id=clipboard_7d33d235ef><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_querier_request_duration_seconds_sum[1m])) by (cluster, job, route) / sum(rate(cortex_querier_request_duration_seconds_count[1m])) by (cluster, job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_querier_request_duration_seconds:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_routecortex_querier_request_duration_seconds_bucketsum_rate>cluster_job_route:cortex_querier_request_duration_seconds_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_ae9889225e>
Copy</button></div><div id=clipboard_ae9889225e><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_querier_request_duration_seconds_bucket[1m])) by (le, cluster, job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_querier_request_duration_seconds_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_routecortex_querier_request_duration_seconds_sumsum_rate>cluster_job_route:cortex_querier_request_duration_seconds_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_d784c96f6d>
Copy</button></div><div id=clipboard_d784c96f6d><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_querier_request_duration_seconds_sum[1m])) by (cluster, job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_querier_request_duration_seconds_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_routecortex_querier_request_duration_seconds_countsum_rate>cluster_job_route:cortex_querier_request_duration_seconds_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_89e34d8a67>
Copy</button></div><div id=clipboard_89e34d8a67><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_querier_request_duration_seconds_count[1m])) by (cluster, job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_route:cortex_querier_request_duration_seconds_count:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routecortex_querier_request_duration_seconds99quantile>cluster_namespace_job_route:cortex_querier_request_duration_seconds:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_5e8f0ee180>
Copy</button></div><div id=clipboard_5e8f0ee180><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_querier_request_duration_seconds_bucket[1m])) by (le, cluster, namespace, job, route))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_querier_request_duration_seconds:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routecortex_querier_request_duration_seconds50quantile>cluster_namespace_job_route:cortex_querier_request_duration_seconds:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_5fbc2d975c>
Copy</button></div><div id=clipboard_5fbc2d975c><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_querier_request_duration_seconds_bucket[1m])) by (le, cluster, namespace, job, route))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_querier_request_duration_seconds:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routecortex_querier_request_duration_secondsavg>cluster_namespace_job_route:cortex_querier_request_duration_seconds:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_3edbe63aab>
Copy</button></div><div id=clipboard_3edbe63aab><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_querier_request_duration_seconds_sum[1m])) by (cluster, namespace, job, route) / sum(rate(cortex_querier_request_duration_seconds_count[1m])) by (cluster, namespace, job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_querier_request_duration_seconds:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routecortex_querier_request_duration_seconds_bucketsum_rate>cluster_namespace_job_route:cortex_querier_request_duration_seconds_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_0ac2c00417>
Copy</button></div><div id=clipboard_0ac2c00417><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_querier_request_duration_seconds_bucket[1m])) by (le, cluster, namespace, job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_querier_request_duration_seconds_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routecortex_querier_request_duration_seconds_sumsum_rate>cluster_namespace_job_route:cortex_querier_request_duration_seconds_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_e19729b3e7>
Copy</button></div><div id=clipboard_e19729b3e7><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_querier_request_duration_seconds_sum[1m])) by (cluster, namespace, job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_querier_request_duration_seconds_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_job_routecortex_querier_request_duration_seconds_countsum_rate>cluster_namespace_job_route:cortex_querier_request_duration_seconds_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_50e756870e>
Copy</button></div><div id=clipboard_50e756870e><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_querier_request_duration_seconds_count[1m])) by (cluster, namespace, job, route)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job_route:cortex_querier_request_duration_seconds_count:sum_rate</span>
</span></span></code></pre></div></div></div><h3 id=mimir_storage>mimir_storage</h3><h5 id=cluster_jobcortex_kv_request_duration_seconds99quantile>cluster_job:cortex_kv_request_duration_seconds:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_9cbe5f5d75>
Copy</button></div><div id=clipboard_9cbe5f5d75><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_kv_request_duration_seconds_bucket[1m])) by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_kv_request_duration_seconds:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_kv_request_duration_seconds50quantile>cluster_job:cortex_kv_request_duration_seconds:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_256af654ac>
Copy</button></div><div id=clipboard_256af654ac><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_kv_request_duration_seconds_bucket[1m])) by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_kv_request_duration_seconds:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_kv_request_duration_secondsavg>cluster_job:cortex_kv_request_duration_seconds:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_558236d170>
Copy</button></div><div id=clipboard_558236d170><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_kv_request_duration_seconds_sum[1m])) by (cluster, job) / sum(rate(cortex_kv_request_duration_seconds_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_kv_request_duration_seconds:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_kv_request_duration_seconds_bucketsum_rate>cluster_job:cortex_kv_request_duration_seconds_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_a2c4e4452b>
Copy</button></div><div id=clipboard_a2c4e4452b><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_kv_request_duration_seconds_bucket[1m])) by (le, cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_kv_request_duration_seconds_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_kv_request_duration_seconds_sumsum_rate>cluster_job:cortex_kv_request_duration_seconds_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_c31a400f2a>
Copy</button></div><div id=clipboard_c31a400f2a><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_kv_request_duration_seconds_sum[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_kv_request_duration_seconds_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_kv_request_duration_seconds_countsum_rate>cluster_job:cortex_kv_request_duration_seconds_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_4245c9d0e8>
Copy</button></div><div id=clipboard_4245c9d0e8><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_kv_request_duration_seconds_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_kv_request_duration_seconds_count:sum_rate</span>
</span></span></code></pre></div></div></div><h3 id=mimir_queries>mimir_queries</h3><h5 id=cluster_jobcortex_query_frontend_retries99quantile>cluster_job:cortex_query_frontend_retries:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_0920fbc985>
Copy</button></div><div id=clipboard_0920fbc985><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_query_frontend_retries_bucket[1m])) by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_query_frontend_retries:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_query_frontend_retries50quantile>cluster_job:cortex_query_frontend_retries:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_f9cf02b5e7>
Copy</button></div><div id=clipboard_f9cf02b5e7><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_query_frontend_retries_bucket[1m])) by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_query_frontend_retries:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_query_frontend_retriesavg>cluster_job:cortex_query_frontend_retries:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_f9c594c9a5>
Copy</button></div><div id=clipboard_f9c594c9a5><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_query_frontend_retries_sum[1m])) by (cluster, job) / sum(rate(cortex_query_frontend_retries_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_query_frontend_retries:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_query_frontend_retries_bucketsum_rate>cluster_job:cortex_query_frontend_retries_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_bb334618a7>
Copy</button></div><div id=clipboard_bb334618a7><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_query_frontend_retries_bucket[1m])) by (le, cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_query_frontend_retries_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_query_frontend_retries_sumsum_rate>cluster_job:cortex_query_frontend_retries_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_51d53cc532>
Copy</button></div><div id=clipboard_51d53cc532><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_query_frontend_retries_sum[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_query_frontend_retries_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_query_frontend_retries_countsum_rate>cluster_job:cortex_query_frontend_retries_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_4711f68a69>
Copy</button></div><div id=clipboard_4711f68a69><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_query_frontend_retries_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_query_frontend_retries_count:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_query_frontend_queue_duration_seconds99quantile>cluster_job:cortex_query_frontend_queue_duration_seconds:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_1ba90300e2>
Copy</button></div><div id=clipboard_1ba90300e2><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_query_frontend_queue_duration_seconds_bucket[1m])) by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_query_frontend_queue_duration_seconds:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_query_frontend_queue_duration_seconds50quantile>cluster_job:cortex_query_frontend_queue_duration_seconds:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_8d3966e84f>
Copy</button></div><div id=clipboard_8d3966e84f><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_query_frontend_queue_duration_seconds_bucket[1m])) by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_query_frontend_queue_duration_seconds:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_query_frontend_queue_duration_secondsavg>cluster_job:cortex_query_frontend_queue_duration_seconds:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_d1300128ac>
Copy</button></div><div id=clipboard_d1300128ac><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_query_frontend_queue_duration_seconds_sum[1m])) by (cluster, job) / sum(rate(cortex_query_frontend_queue_duration_seconds_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_query_frontend_queue_duration_seconds:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_query_frontend_queue_duration_seconds_bucketsum_rate>cluster_job:cortex_query_frontend_queue_duration_seconds_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_1538e0613c>
Copy</button></div><div id=clipboard_1538e0613c><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_query_frontend_queue_duration_seconds_bucket[1m])) by (le, cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_query_frontend_queue_duration_seconds_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_query_frontend_queue_duration_seconds_sumsum_rate>cluster_job:cortex_query_frontend_queue_duration_seconds_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_7a8be7f3e2>
Copy</button></div><div id=clipboard_7a8be7f3e2><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_query_frontend_queue_duration_seconds_sum[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_query_frontend_queue_duration_seconds_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_query_frontend_queue_duration_seconds_countsum_rate>cluster_job:cortex_query_frontend_queue_duration_seconds_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_9246698cf5>
Copy</button></div><div id=clipboard_9246698cf5><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_query_frontend_queue_duration_seconds_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_query_frontend_queue_duration_seconds_count:sum_rate</span>
</span></span></code></pre></div></div></div><h3 id=mimir_ingester_queries>mimir_ingester_queries</h3><h5 id=cluster_jobcortex_ingester_queried_series99quantile>cluster_job:cortex_ingester_queried_series:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_2ab9a72802>
Copy</button></div><div id=clipboard_2ab9a72802><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_ingester_queried_series_bucket[1m])) by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_series:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_series50quantile>cluster_job:cortex_ingester_queried_series:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_658fbef4f1>
Copy</button></div><div id=clipboard_658fbef4f1><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_ingester_queried_series_bucket[1m])) by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_series:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_seriesavg>cluster_job:cortex_ingester_queried_series:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_8dff704fde>
Copy</button></div><div id=clipboard_8dff704fde><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_ingester_queried_series_sum[1m])) by (cluster, job) / sum(rate(cortex_ingester_queried_series_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_series:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_series_bucketsum_rate>cluster_job:cortex_ingester_queried_series_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_80bbce9606>
Copy</button></div><div id=clipboard_80bbce9606><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_ingester_queried_series_bucket[1m])) by (le, cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_series_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_series_sumsum_rate>cluster_job:cortex_ingester_queried_series_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_d8eaf0fcc0>
Copy</button></div><div id=clipboard_d8eaf0fcc0><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_ingester_queried_series_sum[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_series_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_series_countsum_rate>cluster_job:cortex_ingester_queried_series_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_311313cd78>
Copy</button></div><div id=clipboard_311313cd78><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_ingester_queried_series_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_series_count:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_samples99quantile>cluster_job:cortex_ingester_queried_samples:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_588f3c802f>
Copy</button></div><div id=clipboard_588f3c802f><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_ingester_queried_samples_bucket[1m])) by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_samples:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_samples50quantile>cluster_job:cortex_ingester_queried_samples:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_ad5117fc3f>
Copy</button></div><div id=clipboard_ad5117fc3f><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_ingester_queried_samples_bucket[1m])) by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_samples:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_samplesavg>cluster_job:cortex_ingester_queried_samples:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_ef31922b72>
Copy</button></div><div id=clipboard_ef31922b72><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_ingester_queried_samples_sum[1m])) by (cluster, job) / sum(rate(cortex_ingester_queried_samples_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_samples:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_samples_bucketsum_rate>cluster_job:cortex_ingester_queried_samples_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_eef7c35785>
Copy</button></div><div id=clipboard_eef7c35785><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_ingester_queried_samples_bucket[1m])) by (le, cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_samples_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_samples_sumsum_rate>cluster_job:cortex_ingester_queried_samples_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_0c2576451f>
Copy</button></div><div id=clipboard_0c2576451f><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_ingester_queried_samples_sum[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_samples_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_samples_countsum_rate>cluster_job:cortex_ingester_queried_samples_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_14cb695bea>
Copy</button></div><div id=clipboard_14cb695bea><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_ingester_queried_samples_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_samples_count:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_exemplars99quantile>cluster_job:cortex_ingester_queried_exemplars:99quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_1fc9fdcfd7>
Copy</button></div><div id=clipboard_1fc9fdcfd7><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.99, sum(rate(cortex_ingester_queried_exemplars_bucket[1m])) by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_exemplars:99quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_exemplars50quantile>cluster_job:cortex_ingester_queried_exemplars:50quantile</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_43071b8619>
Copy</button></div><div id=clipboard_43071b8619><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>histogram_quantile(0.50, sum(rate(cortex_ingester_queried_exemplars_bucket[1m])) by (le, cluster, job))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_exemplars:50quantile</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_exemplarsavg>cluster_job:cortex_ingester_queried_exemplars:avg</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_c7a37cdea9>
Copy</button></div><div id=clipboard_c7a37cdea9><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_ingester_queried_exemplars_sum[1m])) by (cluster, job) / sum(rate(cortex_ingester_queried_exemplars_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_exemplars:avg</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_exemplars_bucketsum_rate>cluster_job:cortex_ingester_queried_exemplars_bucket:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_2644021d8f>
Copy</button></div><div id=clipboard_2644021d8f><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_ingester_queried_exemplars_bucket[1m])) by (le, cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_exemplars_bucket:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_exemplars_sumsum_rate>cluster_job:cortex_ingester_queried_exemplars_sum:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_c6c94f7139>
Copy</button></div><div id=clipboard_c6c94f7139><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_ingester_queried_exemplars_sum[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_exemplars_sum:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_ingester_queried_exemplars_countsum_rate>cluster_job:cortex_ingester_queried_exemplars_count:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_b36e7466d6>
Copy</button></div><div id=clipboard_b36e7466d6><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>sum(rate(cortex_ingester_queried_exemplars_count[1m])) by (cluster, job)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_ingester_queried_exemplars_count:sum_rate</span>
</span></span></code></pre></div></div></div><h3 id=mimir_received_samples>mimir_received_samples</h3><h5 id=cluster_namespace_jobcortex_distributor_received_samplesrate5m>cluster_namespace_job:cortex_distributor_received_samples:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_e8a1dca1e3>
Copy</button></div><div id=clipboard_e8a1dca1e3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, job) (rate(cortex_distributor_received_samples_total[5m]))</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job:cortex_distributor_received_samples:rate5m</span>
</span></span></code></pre></div></div></div><h3 id=mimir_exemplars_in>mimir_exemplars_in</h3><h5 id=cluster_namespace_jobcortex_distributor_exemplars_inrate5m>cluster_namespace_job:cortex_distributor_exemplars_in:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_b6fdc8785a>
Copy</button></div><div id=clipboard_b6fdc8785a><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, job) (rate(cortex_distributor_exemplars_in_total[5m]))</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job:cortex_distributor_exemplars_in:rate5m</span>
</span></span></code></pre></div></div></div><h3 id=mimir_received_exemplars>mimir_received_exemplars</h3><h5 id=cluster_namespace_jobcortex_distributor_received_exemplarsrate5m>cluster_namespace_job:cortex_distributor_received_exemplars:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_9ea1cd35dc>
Copy</button></div><div id=clipboard_9ea1cd35dc><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, job) (rate(cortex_distributor_received_exemplars_total[5m]))</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job:cortex_distributor_received_exemplars:rate5m</span>
</span></span></code></pre></div></div></div><h3 id=mimir_exemplars_ingested>mimir_exemplars_ingested</h3><h5 id=cluster_namespace_jobcortex_ingester_ingested_exemplarsrate5m>cluster_namespace_job:cortex_ingester_ingested_exemplars:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_9b97199b34>
Copy</button></div><div id=clipboard_9b97199b34><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, job) (rate(cortex_ingester_ingested_exemplars_total[5m]))</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job:cortex_ingester_ingested_exemplars:rate5m</span>
</span></span></code></pre></div></div></div><h3 id=mimir_exemplars_appended>mimir_exemplars_appended</h3><h5 id=cluster_namespace_jobcortex_ingester_tsdb_exemplar_exemplars_appendedrate5m>cluster_namespace_job:cortex_ingester_tsdb_exemplar_exemplars_appended:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_14809940c4>
Copy</button></div><div id=clipboard_14809940c4><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, job) (rate(cortex_ingester_tsdb_exemplar_exemplars_appended_total[5m]))</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_job:cortex_ingester_tsdb_exemplar_exemplars_appended:rate5m</span>
</span></span></code></pre></div></div></div><h3 id=mimir_scaling_rules>mimir_scaling_rules</h3><h5 id=cluster_namespace_deploymentactual_replicascount>cluster_namespace_deployment:actual_replicas:count</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_874afc4515>
Copy</button></div><div id=clipboard_874afc4515><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # Convenience rule to get the number of replicas for both a deployment and a statefulset.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # Multi-zone deployments are grouped together removing the &#34;zone-X&#34; suffix.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, deployment) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>      kube_deployment_spec_replicas,
</span></span></span><span style=display:flex><span><span style=color:#d88200>      # The question mark in &#34;(.*?)&#34; is used to make it non-greedy, otherwise it
</span></span></span><span style=display:flex><span><span style=color:#d88200>      # always matches everything and the (optional) zone is not removed.
</span></span></span><span style=display:flex><span><span style=color:#d88200>      &#34;deployment&#34;, &#34;$1&#34;, &#34;deployment&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  or
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, deployment) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    label_replace(kube_statefulset_replicas, &#34;deployment&#34;, &#34;$1&#34;, &#34;statefulset&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment:actual_replicas:count</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_deployment_reasonrequired_replicascount>cluster_namespace_deployment_reason:required_replicas:count</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_10a0cea098>
Copy</button></div><div id=clipboard_10a0cea098><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ceil(
</span></span></span><span style=display:flex><span><span style=color:#d88200>    quantile_over_time(0.99,
</span></span></span><span style=display:flex><span><span style=color:#d88200>      sum by (cluster, namespace) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>        cluster_namespace_job:cortex_distributor_received_samples:rate5m
</span></span></span><span style=display:flex><span><span style=color:#d88200>      )[24h:]
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>    / 240000
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>deployment</span><span style=color:#111>:</span> <span style=color:#ae81ff>distributor</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reason</span><span style=color:#111>:</span> <span style=color:#ae81ff>sample_rate</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment_reason:required_replicas:count</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_deployment_reasonrequired_replicascount-1>cluster_namespace_deployment_reason:required_replicas:count</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_cffb83cfb9>
Copy</button></div><div id=clipboard_cffb83cfb9><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ceil(
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by (cluster, namespace) (cortex_limits_overrides{limit_name=&#34;ingestion_rate&#34;})
</span></span></span><span style=display:flex><span><span style=color:#d88200>    * 0.59999999999999998 / 240000
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>deployment</span><span style=color:#111>:</span> <span style=color:#ae81ff>distributor</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reason</span><span style=color:#111>:</span> <span style=color:#ae81ff>sample_rate_limits</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment_reason:required_replicas:count</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_deployment_reasonrequired_replicascount-2>cluster_namespace_deployment_reason:required_replicas:count</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_7532590acc>
Copy</button></div><div id=clipboard_7532590acc><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ceil(
</span></span></span><span style=display:flex><span><span style=color:#d88200>    quantile_over_time(0.99,
</span></span></span><span style=display:flex><span><span style=color:#d88200>      sum by (cluster, namespace) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>        cluster_namespace_job:cortex_distributor_received_samples:rate5m
</span></span></span><span style=display:flex><span><span style=color:#d88200>      )[24h:]
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>    * 3 / 80000
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>deployment</span><span style=color:#111>:</span> <span style=color:#ae81ff>ingester</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reason</span><span style=color:#111>:</span> <span style=color:#ae81ff>sample_rate</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment_reason:required_replicas:count</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_deployment_reasonrequired_replicascount-3>cluster_namespace_deployment_reason:required_replicas:count</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_44bf1cbda9>
Copy</button></div><div id=clipboard_44bf1cbda9><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ceil(
</span></span></span><span style=display:flex><span><span style=color:#d88200>    quantile_over_time(0.99,
</span></span></span><span style=display:flex><span><span style=color:#d88200>      sum by(cluster, namespace) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>        cortex_ingester_memory_series
</span></span></span><span style=display:flex><span><span style=color:#d88200>      )[24h:]
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>    / 1500000
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>deployment</span><span style=color:#111>:</span> <span style=color:#ae81ff>ingester</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reason</span><span style=color:#111>:</span> <span style=color:#ae81ff>active_series</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment_reason:required_replicas:count</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_deployment_reasonrequired_replicascount-4>cluster_namespace_deployment_reason:required_replicas:count</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_28c6734f06>
Copy</button></div><div id=clipboard_28c6734f06><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ceil(
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by (cluster, namespace) (cortex_limits_overrides{limit_name=&#34;max_global_series_per_user&#34;})
</span></span></span><span style=display:flex><span><span style=color:#d88200>    * 3 * 0.59999999999999998 / 1500000
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>deployment</span><span style=color:#111>:</span> <span style=color:#ae81ff>ingester</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reason</span><span style=color:#111>:</span> <span style=color:#ae81ff>active_series_limits</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment_reason:required_replicas:count</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_deployment_reasonrequired_replicascount-5>cluster_namespace_deployment_reason:required_replicas:count</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_4cca0bd0d8>
Copy</button></div><div id=clipboard_4cca0bd0d8><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ceil(
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by (cluster, namespace) (cortex_limits_overrides{limit_name=&#34;ingestion_rate&#34;})
</span></span></span><span style=display:flex><span><span style=color:#d88200>    * 0.59999999999999998 / 80000
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>deployment</span><span style=color:#111>:</span> <span style=color:#ae81ff>ingester</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reason</span><span style=color:#111>:</span> <span style=color:#ae81ff>sample_rate_limits</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment_reason:required_replicas:count</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_deployment_reasonrequired_replicascount-6>cluster_namespace_deployment_reason:required_replicas:count</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_40a818bb26>
Copy</button></div><div id=clipboard_40a818bb26><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ceil(
</span></span></span><span style=display:flex><span><span style=color:#d88200>    (sum by (cluster, namespace) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      cortex_ingester_tsdb_storage_blocks_bytes{job=~&#34;.+/ingester.*&#34;}
</span></span></span><span style=display:flex><span><span style=color:#d88200>    ) / 4)
</span></span></span><span style=display:flex><span><span style=color:#d88200>      /
</span></span></span><span style=display:flex><span><span style=color:#d88200>    avg by (cluster, namespace) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      memcached_limit_bytes{job=~&#34;.+/memcached&#34;}
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>deployment</span><span style=color:#111>:</span> <span style=color:#ae81ff>memcached</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reason</span><span style=color:#111>:</span> <span style=color:#ae81ff>active_series</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment_reason:required_replicas:count</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_deploymentcontainer_cpu_usage_seconds_totalsum_rate>cluster_namespace_deployment:container_cpu_usage_seconds_total:sum_rate</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_a053eeecd0>
Copy</button></div><div id=clipboard_a053eeecd0><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, deployment) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>      label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>        sum by (cluster, namespace, pod)(rate(container_cpu_usage_seconds_total[1m])),
</span></span></span><span style=display:flex><span><span style=color:#d88200>        &#34;deployment&#34;, &#34;$1&#34;, &#34;pod&#34;, &#34;(.*)-(?:([0-9]+)|([a-z0-9]+)-([a-z0-9]+))&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>      ),
</span></span></span><span style=display:flex><span><span style=color:#d88200>      # The question mark in &#34;(.*?)&#34; is used to make it non-greedy, otherwise it
</span></span></span><span style=display:flex><span><span style=color:#d88200>      # always matches everything and the (optional) zone is not removed.
</span></span></span><span style=display:flex><span><span style=color:#d88200>      &#34;deployment&#34;, &#34;$1&#34;, &#34;deployment&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment:container_cpu_usage_seconds_total:sum_rate</span>
</span></span></code></pre></div></div></div><h5 id=heading></h5><p>cluster_namespace_deployment:kube_pod_container_resource_requests_cpu_cores:sum</p><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_a82b11aa93>
Copy</button></div><div id=clipboard_a82b11aa93><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # Convenience rule to get the CPU request for both a deployment and a statefulset.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # Multi-zone deployments are grouped together removing the &#34;zone-X&#34; suffix.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # This recording rule is made compatible with the breaking changes introduced in kube-state-metrics v2
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # that remove resource metrics, ref:
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # - https://github.com/kubernetes/kube-state-metrics/blob/master/CHANGELOG.md#v200-alpha--2020-09-16
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # - https://github.com/kubernetes/kube-state-metrics/pull/1004
</span></span></span><span style=display:flex><span><span style=color:#d88200>  #
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # This is the old expression, compatible with kube-state-metrics &lt; v2.0.0,
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # where kube_pod_container_resource_requests_cpu_cores was removed:
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by (cluster, namespace, deployment) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>        label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>          kube_pod_container_resource_requests_cpu_cores,
</span></span></span><span style=display:flex><span><span style=color:#d88200>          &#34;deployment&#34;, &#34;$1&#34;, &#34;pod&#34;, &#34;(.*)-(?:([0-9]+)|([a-z0-9]+)-([a-z0-9]+))&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>        ),
</span></span></span><span style=display:flex><span><span style=color:#d88200>        # The question mark in &#34;(.*?)&#34; is used to make it non-greedy, otherwise it
</span></span></span><span style=display:flex><span><span style=color:#d88200>        # always matches everything and the (optional) zone is not removed.
</span></span></span><span style=display:flex><span><span style=color:#d88200>        &#34;deployment&#34;, &#34;$1&#34;, &#34;deployment&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>      )
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  or
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # This expression is compatible with kube-state-metrics &gt;= v1.4.0,
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # where kube_pod_container_resource_requests was introduced.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by (cluster, namespace, deployment) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>        label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>          kube_pod_container_resource_requests{resource=&#34;cpu&#34;},
</span></span></span><span style=display:flex><span><span style=color:#d88200>          &#34;deployment&#34;, &#34;$1&#34;, &#34;pod&#34;, &#34;(.*)-(?:([0-9]+)|([a-z0-9]+)-([a-z0-9]+))&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>        ),
</span></span></span><span style=display:flex><span><span style=color:#d88200>        # The question mark in &#34;(.*?)&#34; is used to make it non-greedy, otherwise it
</span></span></span><span style=display:flex><span><span style=color:#d88200>        # always matches everything and the (optional) zone is not removed.
</span></span></span><span style=display:flex><span><span style=color:#d88200>        &#34;deployment&#34;, &#34;$1&#34;, &#34;deployment&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>      )
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment:kube_pod_container_resource_requests_cpu_cores:sum</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_deployment_reasonrequired_replicascount-7>cluster_namespace_deployment_reason:required_replicas:count</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_2e290fab44>
Copy</button></div><div id=clipboard_2e290fab44><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # Jobs should be sized to their CPU usage.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # We do this by comparing 99th percentile usage over the last 24hrs to
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # their current provisioned #replicas and resource requests.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ceil(
</span></span></span><span style=display:flex><span><span style=color:#d88200>    cluster_namespace_deployment:actual_replicas:count
</span></span></span><span style=display:flex><span><span style=color:#d88200>      *
</span></span></span><span style=display:flex><span><span style=color:#d88200>    quantile_over_time(0.99, cluster_namespace_deployment:container_cpu_usage_seconds_total:sum_rate[24h])
</span></span></span><span style=display:flex><span><span style=color:#d88200>      /
</span></span></span><span style=display:flex><span><span style=color:#d88200>    cluster_namespace_deployment:kube_pod_container_resource_requests_cpu_cores:sum
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reason</span><span style=color:#111>:</span> <span style=color:#ae81ff>cpu_usage</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment_reason:required_replicas:count</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_deploymentcontainer_memory_usage_bytessum>cluster_namespace_deployment:container_memory_usage_bytes:sum</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_8e87a0cd84>
Copy</button></div><div id=clipboard_8e87a0cd84><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # Convenience rule to get the Memory utilization for both a deployment and a statefulset.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # Multi-zone deployments are grouped together removing the &#34;zone-X&#34; suffix.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, namespace, deployment) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>      label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>        container_memory_usage_bytes{image!=&#34;&#34;},
</span></span></span><span style=display:flex><span><span style=color:#d88200>        &#34;deployment&#34;, &#34;$1&#34;, &#34;pod&#34;, &#34;(.*)-(?:([0-9]+)|([a-z0-9]+)-([a-z0-9]+))&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>      ),
</span></span></span><span style=display:flex><span><span style=color:#d88200>      # The question mark in &#34;(.*?)&#34; is used to make it non-greedy, otherwise it
</span></span></span><span style=display:flex><span><span style=color:#d88200>      # always matches everything and the (optional) zone is not removed.
</span></span></span><span style=display:flex><span><span style=color:#d88200>      &#34;deployment&#34;, &#34;$1&#34;, &#34;deployment&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment:container_memory_usage_bytes:sum</span>
</span></span></code></pre></div></div></div><h5 id=heading-1></h5><p>cluster_namespace_deployment:kube_pod_container_resource_requests_memory_bytes:sum</p><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_e14f634888>
Copy</button></div><div id=clipboard_e14f634888><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # Convenience rule to get the Memory request for both a deployment and a statefulset.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # Multi-zone deployments are grouped together removing the &#34;zone-X&#34; suffix.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # This recording rule is made compatible with the breaking changes introduced in kube-state-metrics v2
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # that remove resource metrics, ref:
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # - https://github.com/kubernetes/kube-state-metrics/blob/master/CHANGELOG.md#v200-alpha--2020-09-16
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # - https://github.com/kubernetes/kube-state-metrics/pull/1004
</span></span></span><span style=display:flex><span><span style=color:#d88200>  #
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # This is the old expression, compatible with kube-state-metrics &lt; v2.0.0,
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # where kube_pod_container_resource_requests_memory_bytes was removed:
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by (cluster, namespace, deployment) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>        label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>          kube_pod_container_resource_requests_memory_bytes,
</span></span></span><span style=display:flex><span><span style=color:#d88200>          &#34;deployment&#34;, &#34;$1&#34;, &#34;pod&#34;, &#34;(.*)-(?:([0-9]+)|([a-z0-9]+)-([a-z0-9]+))&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>        ),
</span></span></span><span style=display:flex><span><span style=color:#d88200>        # The question mark in &#34;(.*?)&#34; is used to make it non-greedy, otherwise it
</span></span></span><span style=display:flex><span><span style=color:#d88200>        # always matches everything and the (optional) zone is not removed.
</span></span></span><span style=display:flex><span><span style=color:#d88200>        &#34;deployment&#34;, &#34;$1&#34;, &#34;deployment&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>      )
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  or
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # This expression is compatible with kube-state-metrics &gt;= v1.4.0,
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # where kube_pod_container_resource_requests was introduced.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum by (cluster, namespace, deployment) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>        label_replace(
</span></span></span><span style=display:flex><span><span style=color:#d88200>          kube_pod_container_resource_requests{resource=&#34;memory&#34;},
</span></span></span><span style=display:flex><span><span style=color:#d88200>          &#34;deployment&#34;, &#34;$1&#34;, &#34;pod&#34;, &#34;(.*)-(?:([0-9]+)|([a-z0-9]+)-([a-z0-9]+))&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>        ),
</span></span></span><span style=display:flex><span><span style=color:#d88200>        # The question mark in &#34;(.*?)&#34; is used to make it non-greedy, otherwise it
</span></span></span><span style=display:flex><span><span style=color:#d88200>        # always matches everything and the (optional) zone is not removed.
</span></span></span><span style=display:flex><span><span style=color:#d88200>        &#34;deployment&#34;, &#34;$1&#34;, &#34;deployment&#34;, &#34;(.*?)(?:-zone-[a-z])?&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>      )
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment:kube_pod_container_resource_requests_memory_bytes:sum</span>
</span></span></code></pre></div></div></div><h5 id=cluster_namespace_deployment_reasonrequired_replicascount-8>cluster_namespace_deployment_reason:required_replicas:count</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_d9a9fc46eb>
Copy</button></div><div id=clipboard_d9a9fc46eb><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # Jobs should be sized to their Memory usage.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # We do this by comparing 99th percentile usage over the last 24hrs to
</span></span></span><span style=display:flex><span><span style=color:#d88200>  # their current provisioned #replicas and resource requests.
</span></span></span><span style=display:flex><span><span style=color:#d88200>  ceil(
</span></span></span><span style=display:flex><span><span style=color:#d88200>    cluster_namespace_deployment:actual_replicas:count
</span></span></span><span style=display:flex><span><span style=color:#d88200>      *
</span></span></span><span style=display:flex><span><span style=color:#d88200>    quantile_over_time(0.99, cluster_namespace_deployment:container_memory_usage_bytes:sum[24h])
</span></span></span><span style=display:flex><span><span style=color:#d88200>      /
</span></span></span><span style=display:flex><span><span style=color:#d88200>    cluster_namespace_deployment:kube_pod_container_resource_requests_memory_bytes:sum
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reason</span><span style=color:#111>:</span> <span style=color:#ae81ff>memory_usage</span>
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_deployment_reason:required_replicas:count</span>
</span></span></code></pre></div></div></div><h3 id=mimir_alertmanager_rules>mimir_alertmanager_rules</h3><h5 id=cluster_job_podcortex_alertmanager_alertssum>cluster_job_pod:cortex_alertmanager_alerts:sum</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_1d205a83c8>
Copy</button></div><div id=clipboard_1d205a83c8><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, job, pod) (cortex_alertmanager_alerts)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_pod:cortex_alertmanager_alerts:sum</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_podcortex_alertmanager_silencessum>cluster_job_pod:cortex_alertmanager_silences:sum</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_bc0a1db0b1>
Copy</button></div><div id=clipboard_bc0a1db0b1><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, job, pod) (cortex_alertmanager_silences)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_pod:cortex_alertmanager_silences:sum</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_alertmanager_alerts_received_totalrate5m>cluster_job:cortex_alertmanager_alerts_received_total:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_d01266c4a6>
Copy</button></div><div id=clipboard_d01266c4a6><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, job) (rate(cortex_alertmanager_alerts_received_total[5m]))</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_alertmanager_alerts_received_total:rate5m</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_alertmanager_alerts_invalid_totalrate5m>cluster_job:cortex_alertmanager_alerts_invalid_total:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_dbf507dea1>
Copy</button></div><div id=clipboard_dbf507dea1><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, job) (rate(cortex_alertmanager_alerts_invalid_total[5m]))</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_alertmanager_alerts_invalid_total:rate5m</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_integrationcortex_alertmanager_notifications_totalrate5m>cluster_job_integration:cortex_alertmanager_notifications_total:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_4a08114d59>
Copy</button></div><div id=clipboard_4a08114d59><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, job, integration) (rate(cortex_alertmanager_notifications_total[5m]))</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_integration:cortex_alertmanager_notifications_total:rate5m</span>
</span></span></code></pre></div></div></div><h5 id=cluster_job_integrationcortex_alertmanager_notifications_failed_totalrate5m>cluster_job_integration:cortex_alertmanager_notifications_failed_total:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_7fd0bdd137>
Copy</button></div><div id=clipboard_7fd0bdd137><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, job, integration) (rate(cortex_alertmanager_notifications_failed_total[5m]))</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job_integration:cortex_alertmanager_notifications_failed_total:rate5m</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_alertmanager_state_replication_totalrate5m>cluster_job:cortex_alertmanager_state_replication_total:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_ea84261c03>
Copy</button></div><div id=clipboard_ea84261c03><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, job) (rate(cortex_alertmanager_state_replication_total[5m]))</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_alertmanager_state_replication_total:rate5m</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_alertmanager_state_replication_failed_totalrate5m>cluster_job:cortex_alertmanager_state_replication_failed_total:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_565b5ac5a6>
Copy</button></div><div id=clipboard_565b5ac5a6><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, job) (rate(cortex_alertmanager_state_replication_failed_total[5m]))</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_alertmanager_state_replication_failed_total:rate5m</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_alertmanager_partial_state_merges_totalrate5m>cluster_job:cortex_alertmanager_partial_state_merges_total:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_9a7d7a738b>
Copy</button></div><div id=clipboard_9a7d7a738b><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, job) (rate(cortex_alertmanager_partial_state_merges_total[5m]))</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_alertmanager_partial_state_merges_total:rate5m</span>
</span></span></code></pre></div></div></div><h5 id=cluster_jobcortex_alertmanager_partial_state_merges_failed_totalrate5m>cluster_job:cortex_alertmanager_partial_state_merges_failed_total:rate5m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_93ae6cd61e>
Copy</button></div><div id=clipboard_93ae6cd61e><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by (cluster, job) (rate(cortex_alertmanager_partial_state_merges_failed_total[5m]))</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_job:cortex_alertmanager_partial_state_merges_failed_total:rate5m</span>
</span></span></code></pre></div></div></div><h3 id=mimir_ingester_rules>mimir_ingester_rules</h3><h5 id=cluster_namespace_podcortex_ingester_ingested_samples_totalrate1m>cluster_namespace_pod:cortex_ingester_ingested_samples_total:rate1m</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_28f2c92381>
Copy</button></div><div id=clipboard_28f2c92381><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum by(cluster, namespace, pod) (rate(cortex_ingester_ingested_samples_total[1m]))</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>record</span><span style=color:#111>:</span> <span style=color:#ae81ff>cluster_namespace_pod:cortex_ingester_ingested_samples_total:rate1m</span>
</span></span></code></pre></div></div></div><h2 id=dashboards>Dashboards</h2><p>仪表盘配置文件下载地址:</p><ul><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-alertmanager-resources.json>mimir-alertmanager-resources</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-alertmanager.json>mimir-alertmanager</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-compactor-resources.json>mimir-compactor-resources</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-compactor.json>mimir-compactor</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-config.json>mimir-config</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-object-store.json>mimir-object-store</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-overrides.json>mimir-overrides</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-overview-networking.json>mimir-overview-networking</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-overview-resources.json>mimir-overview-resources</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-overview.json>mimir-overview</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-queries.json>mimir-queries</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-reads-networking.json>mimir-reads-networking</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-reads-resources.json>mimir-reads-resources</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-reads.json>mimir-reads</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-remote-ruler-reads-networking.json>mimir-remote-ruler-reads-networking</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-remote-ruler-reads-resources.json>mimir-remote-ruler-reads-resources</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-remote-ruler-reads.json>mimir-remote-ruler-reads</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-rollout-progress.json>mimir-rollout-progress</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-ruler.json>mimir-ruler</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-scaling.json>mimir-scaling</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-slow-queries.json>mimir-slow-queries</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-tenants.json>mimir-tenants</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-top-tenants.json>mimir-top-tenants</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-writes-networking.json>mimir-writes-networking</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-writes-resources.json>mimir-writes-resources</a></li><li><a href=https://github.com/observeproject/sites/blob/main/assets/mimir/dashboards/mimir-writes.json>mimir-writes</a></li></ul><div class=row></div></div></div></div><script src=https://stack.observability.udmire.cn/lib/jquery.min.js></script><script src=https://stack.observability.udmire.cn/lib/popper.min.js></script><script src=https://stack.observability.udmire.cn/js/bootstrap.min.js></script><script type=text/javascript src=/plugins/lunr.min.js></script><script type=text/javascript src=/plugins/auto-complete.js></script><link href=/plugins/auto-complete.css rel=stylesheet><script type=text/javascript>var baseurl="https://stack.observability.udmire.cn/"</script><script type=text/javascript src=/plugins/search.js></script><script type=text/javascript src=/plugins/clipboard.js></script><script>new ClipboardJS(".btn")</script></body></html>