<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=alternate type=application/rss+xml href=https://stack.observability.udmire.cn/etcd/index.xml title="Mixins for Observability Stack"><link rel=canonical href=https://stack.observability.udmire.cn/etcd/><title>etcd | Mixins for Observability Stack
</title><link href=https://stack.observability.udmire.cn/css/fontawesome.min.css rel=stylesheet><link rel=stylesheet href=https://stack.observability.udmire.cn/css/ace.min.css></head><body><nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow sticky-top" id=navbarMain><div class=container><div><a class=navbar-brand href=/>Mixins for Observability Stack</a></div><button class="navbar-toggler navbar-toggler-right collapsed" type=button data-toggle=collapse data-target=#navbarMainCollapse aria-controls=navbarMainCollapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarMainCollapse><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/>Homepage</a></li><li class=nav-item><a class=nav-link href=https://github.com/monitoring-mixins/docs>About mixins</a></li><li class=nav-item><a class=nav-link href=https://github.com/observeproject/sites>GitHub</a></li></ul></div></div><div class=feed-icons><a href=https://stack.observability.udmire.cn/etcd/index.xml><img src=/img/feed-icon.svg alt="RSS feed"></a></div></nav><div class=container-fluid><div class=row><div class="docs-sidenav order-0 col-12 col-md-3 col-lg-2 col-xl-2 position-sticky border-right"><nav class="navbar navbar-expand-md navbar-light pl-0"><button class="navbar-toggler navbar-toggler-right collapsed" type=button data-toggle=collapse data-target=#sidenav-left-collapse aria-controls=sidenav-left-collapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse align-items-start flex-column" id=sidenav-left-collapse><ul class="navbar-nav flex-column pt-3"><li data-nav-id=/cert-manager/ class="nav-item my-1"><a class="nav-link p-0" href=/cert-manager/><h6>cert-manager</h6></a></li><li data-nav-id=/coredns/ class="nav-item my-1"><a class="nav-link p-0" href=/coredns/><h6>coredns</h6></a></li><li data-nav-id=/etcd/ class="nav-item my-1 active"><a class="nav-link p-0" href=/etcd/><h6>etcd</h6></a></li><li data-nav-id=/grafana/ class="nav-item my-1"><a class="nav-link p-0" href=/grafana/><h6>grafana</h6></a></li><li data-nav-id=/grafana-agent/ class="nav-item my-1"><a class="nav-link p-0" href=/grafana-agent/><h6>grafana-agent</h6></a></li><li data-nav-id=/kube-state-metrics/ class="nav-item my-1"><a class="nav-link p-0" href=/kube-state-metrics/><h6>kube-state-metrics</h6></a></li><li data-nav-id=/kubernetes/ class="nav-item my-1"><a class="nav-link p-0" href=/kubernetes/><h6>kubernetes</h6></a></li><li data-nav-id=/loki/ class="nav-item my-1"><a class="nav-link p-0" href=/loki/><h6>loki</h6></a></li><li data-nav-id=/memcached/ class="nav-item my-1"><a class="nav-link p-0" href=/memcached/><h6>memcached</h6></a></li><li data-nav-id=/mimir/ class="nav-item my-1"><a class="nav-link p-0" href=/mimir/><h6>mimir</h6></a></li><li data-nav-id=/node-exporter/ class="nav-item my-1"><a class="nav-link p-0" href=/node-exporter/><h6>node-exporter</h6></a></li><li data-nav-id=/pyroscope/ class="nav-item my-1"><a class="nav-link p-0" href=/pyroscope/><h6>pyroscope</h6></a></li><li data-nav-id=/tempo/ class="nav-item my-1"><a class="nav-link p-0" href=/tempo/><h6>tempo</h6></a></li></ul></div></nav></div><div class="docs-toc large order-lg-2 order-md-0 order-xs-1 col-12 col-lg-3 col-xl-3 position-sticky border-left"><div class=docs-toc><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#alerts>Alerts</a><ul><li><a href=#etcd>etcd</a></li></ul></li><li><a href=#dashboards>Dashboards</a></li></ul></nav></div></div><div class="main col-12 order-1 col-md-9 col-lg-9 col-xl-7 py-3"><h1>etcd</h1><h2 id=overview>Overview</h2><p>A set of customisable Prometheus alerts for etcd.</p><div class="card my-3 border-top-0 border-right-0 border-bottom-0 border-left border-danger rounded" style=border-width:4px!important><div class="wrap border border-left-0 rounded"><div class="card-body pt-1">Jsonnet 源码地址：<a href=https://github.com/etcd-io/etcd/tree/master/contrib/mixin>github.com/etcd-io/etcd</a></div></div></div><h2 id=alerts>Alerts</h2><div class="card my-3 border-top-0 border-right-0 border-bottom-0 border-left border-warning rounded" style=border-width:4px!important><div class="wrap border border-left-0 rounded"><div class="card-body pt-1">告警Alerts配置列表 <a href=https://github.com/observeproject/sites/blob/main/assets/etcd/alerts.yaml>源文件</a>.</div></div></div><h3 id=etcd>etcd</h3><h5 id=etcdmembersdown>etcdMembersDown</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_b2e16047db>
Copy</button></div><div id=clipboard_b2e16047db><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcdMembersDown</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>description</span><span style=color:#111>:</span> <span style=color:#d88200>&#39;etcd cluster &#34;{{ $labels.job }}&#34;: members are down ({{ $value }}).&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>summary</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcd cluster members are down.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  max without (endpoint) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>    sum without (instance) (up{job=~&#34;.*etcd.*&#34;} == bool 0)
</span></span></span><span style=display:flex><span><span style=color:#d88200>  or
</span></span></span><span style=display:flex><span><span style=color:#d88200>    count without (To) (
</span></span></span><span style=display:flex><span><span style=color:#d88200>      sum without (instance) (rate(etcd_network_peer_sent_failures_total{job=~&#34;.*etcd.*&#34;}[120s])) &gt; 0.01
</span></span></span><span style=display:flex><span><span style=color:#d88200>    )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  )
</span></span></span><span style=display:flex><span><span style=color:#d88200>  &gt; 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>10m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=etcdinsufficientmembers>etcdInsufficientMembers</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_3dff508799>
Copy</button></div><div id=clipboard_3dff508799><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcdInsufficientMembers</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>description</span><span style=color:#111>:</span> <span style=color:#d88200>&#39;etcd cluster &#34;{{ $labels.job }}&#34;: insufficient members ({{ $value }}).&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>summary</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcd cluster has insufficient number of members.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum(up{job=~&#34;.*etcd.*&#34;} == bool 1) without (instance) &lt; ((count(up{job=~&#34;.*etcd.*&#34;}) without (instance) + 1) / 2)</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>3m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=etcdnoleader>etcdNoLeader</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_c199f78bf8>
Copy</button></div><div id=clipboard_c199f78bf8><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcdNoLeader</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>description</span><span style=color:#111>:</span> <span style=color:#d88200>&#39;etcd cluster &#34;{{ $labels.job }}&#34;: member {{ $labels.instance }} has no leader.&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>summary</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcd cluster has no leader.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  etcd_server_has_leader{job=~&#34;.*etcd.*&#34;} == 0</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>1m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=etcdhighnumberofleaderchanges>etcdHighNumberOfLeaderChanges</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_02385bf0d7>
Copy</button></div><div id=clipboard_02385bf0d7><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcdHighNumberOfLeaderChanges</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>description</span><span style=color:#111>:</span> <span style=color:#d88200>&#39;etcd cluster &#34;{{ $labels.job }}&#34;: {{ $value }} leader changes within the last 15 minutes. Frequent elections may be a sign of insufficient resources, high network latency, or disruptions by other components and should be investigated.&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>summary</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcd cluster has high number of leader changes.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  increase((max without (instance) (etcd_server_leader_changes_seen_total{job=~&#34;.*etcd.*&#34;}) or 0*absent(etcd_server_leader_changes_seen_total{job=~&#34;.*etcd.*&#34;}))[15m:1m]) &gt;= 4</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=etcdhighnumberoffailedgrpcrequests>etcdHighNumberOfFailedGRPCRequests</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_5bb96ace71>
Copy</button></div><div id=clipboard_5bb96ace71><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcdHighNumberOfFailedGRPCRequests</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>description</span><span style=color:#111>:</span> <span style=color:#d88200>&#39;etcd cluster &#34;{{ $labels.job }}&#34;: {{ $value }}% of requests for {{ $labels.grpc_method }} failed on etcd instance {{ $labels.instance }}.&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>summary</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcd cluster has high number of failed grpc requests.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  100 * sum(rate(grpc_server_handled_total{job=~&#34;.*etcd.*&#34;, grpc_code=~&#34;Unknown|FailedPrecondition|ResourceExhausted|Internal|Unavailable|DataLoss|DeadlineExceeded&#34;}[5m])) without (grpc_type, grpc_code)
</span></span></span><span style=display:flex><span><span style=color:#d88200>    /
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum(rate(grpc_server_handled_total{job=~&#34;.*etcd.*&#34;}[5m])) without (grpc_type, grpc_code)
</span></span></span><span style=display:flex><span><span style=color:#d88200>    &gt; 1</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>10m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=etcdhighnumberoffailedgrpcrequests-1>etcdHighNumberOfFailedGRPCRequests</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_334f6a621d>
Copy</button></div><div id=clipboard_334f6a621d><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcdHighNumberOfFailedGRPCRequests</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>description</span><span style=color:#111>:</span> <span style=color:#d88200>&#39;etcd cluster &#34;{{ $labels.job }}&#34;: {{ $value }}% of requests for {{ $labels.grpc_method }} failed on etcd instance {{ $labels.instance }}.&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>summary</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcd cluster has high number of failed grpc requests.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  100 * sum(rate(grpc_server_handled_total{job=~&#34;.*etcd.*&#34;, grpc_code=~&#34;Unknown|FailedPrecondition|ResourceExhausted|Internal|Unavailable|DataLoss|DeadlineExceeded&#34;}[5m])) without (grpc_type, grpc_code)
</span></span></span><span style=display:flex><span><span style=color:#d88200>    /
</span></span></span><span style=display:flex><span><span style=color:#d88200>  sum(rate(grpc_server_handled_total{job=~&#34;.*etcd.*&#34;}[5m])) without (grpc_type, grpc_code)
</span></span></span><span style=display:flex><span><span style=color:#d88200>    &gt; 5</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=etcdgrpcrequestsslow>etcdGRPCRequestsSlow</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_7073543a45>
Copy</button></div><div id=clipboard_7073543a45><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcdGRPCRequestsSlow</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>description</span><span style=color:#111>:</span> <span style=color:#d88200>&#39;etcd cluster &#34;{{ $labels.job }}&#34;: 99th percentile of gRPC requests is {{ $value }}s on etcd instance {{ $labels.instance }} for {{ $labels.grpc_method }} method.&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>summary</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcd grpc requests are slow</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  histogram_quantile(0.99, sum(rate(grpc_server_handling_seconds_bucket{job=~&#34;.*etcd.*&#34;, grpc_method!=&#34;Defragment&#34;, grpc_type=&#34;unary&#34;}[5m])) without(grpc_type))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  &gt; 0.15</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>10m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=etcdmembercommunicationslow>etcdMemberCommunicationSlow</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_9d8aec3882>
Copy</button></div><div id=clipboard_9d8aec3882><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcdMemberCommunicationSlow</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>description</span><span style=color:#111>:</span> <span style=color:#d88200>&#39;etcd cluster &#34;{{ $labels.job }}&#34;: member communication with {{ $labels.To }} is taking {{ $value }}s on etcd instance {{ $labels.instance }}.&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>summary</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcd cluster member communication is slow.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  histogram_quantile(0.99, rate(etcd_network_peer_round_trip_time_seconds_bucket{job=~&#34;.*etcd.*&#34;}[5m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  &gt; 0.15</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>10m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=etcdhighnumberoffailedproposals>etcdHighNumberOfFailedProposals</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_8f99e34547>
Copy</button></div><div id=clipboard_8f99e34547><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcdHighNumberOfFailedProposals</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>description</span><span style=color:#111>:</span> <span style=color:#d88200>&#39;etcd cluster &#34;{{ $labels.job }}&#34;: {{ $value }} proposal failures within the last 30 minutes on etcd instance {{ $labels.instance }}.&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>summary</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcd cluster has high number of proposal failures.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  rate(etcd_server_proposals_failed_total{job=~&#34;.*etcd.*&#34;}[15m]) &gt; 5</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>15m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=etcdhighfsyncdurations>etcdHighFsyncDurations</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_fd8d79f602>
Copy</button></div><div id=clipboard_fd8d79f602><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcdHighFsyncDurations</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>description</span><span style=color:#111>:</span> <span style=color:#d88200>&#39;etcd cluster &#34;{{ $labels.job }}&#34;: 99th percentile fsync durations are {{ $value }}s on etcd instance {{ $labels.instance }}.&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>summary</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcd cluster 99th percentile fsync durations are too high.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  histogram_quantile(0.99, rate(etcd_disk_wal_fsync_duration_seconds_bucket{job=~&#34;.*etcd.*&#34;}[5m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  &gt; 0.5</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>10m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=etcdhighfsyncdurations-1>etcdHighFsyncDurations</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_7cddd8a82f>
Copy</button></div><div id=clipboard_7cddd8a82f><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcdHighFsyncDurations</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>description</span><span style=color:#111>:</span> <span style=color:#d88200>&#39;etcd cluster &#34;{{ $labels.job }}&#34;: 99th percentile fsync durations are {{ $value }}s on etcd instance {{ $labels.instance }}.&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>summary</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcd cluster 99th percentile fsync durations are too high.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  histogram_quantile(0.99, rate(etcd_disk_wal_fsync_duration_seconds_bucket{job=~&#34;.*etcd.*&#34;}[5m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  &gt; 1</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>10m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=etcdhighcommitdurations>etcdHighCommitDurations</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_b937d82f69>
Copy</button></div><div id=clipboard_b937d82f69><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcdHighCommitDurations</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>description</span><span style=color:#111>:</span> <span style=color:#d88200>&#39;etcd cluster &#34;{{ $labels.job }}&#34;: 99th percentile commit durations {{ $value }}s on etcd instance {{ $labels.instance }}.&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>summary</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcd cluster 99th percentile commit durations are too high.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  histogram_quantile(0.99, rate(etcd_disk_backend_commit_duration_seconds_bucket{job=~&#34;.*etcd.*&#34;}[5m]))
</span></span></span><span style=display:flex><span><span style=color:#d88200>  &gt; 0.25</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>10m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=etcddatabasequotalowspace>etcdDatabaseQuotaLowSpace</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_863bc1a168>
Copy</button></div><div id=clipboard_863bc1a168><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcdDatabaseQuotaLowSpace</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>description</span><span style=color:#111>:</span> <span style=color:#d88200>&#39;etcd cluster &#34;{{ $labels.job }}&#34;: database size exceeds the defined quota on etcd instance {{ $labels.instance }}, please defrag or increase the quota as the writes to etcd will be disabled when it is full.&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>summary</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcd cluster database is running full.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (last_over_time(etcd_mvcc_db_total_size_in_bytes{job=~&#34;.*etcd.*&#34;}[5m]) / last_over_time(etcd_server_quota_backend_bytes{job=~&#34;.*etcd.*&#34;}[5m]))*100 &gt; 95</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>10m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
</span></span></code></pre></div></div></div><h5 id=etcdexcessivedatabasegrowth>etcdExcessiveDatabaseGrowth</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_711f3d588d>
Copy</button></div><div id=clipboard_711f3d588d><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcdExcessiveDatabaseGrowth</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>description</span><span style=color:#111>:</span> <span style=color:#d88200>&#39;etcd cluster &#34;{{ $labels.job }}&#34;: Predicting running out of disk space in the next four hours, based on write observations within the past four hours on etcd instance {{ $labels.instance }}, please check as it might be disruptive.&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>summary</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcd cluster database growing very fast.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  predict_linear(etcd_mvcc_db_total_size_in_bytes{job=~&#34;.*etcd.*&#34;}[4h], 4*60*60) &gt; etcd_server_quota_backend_bytes{job=~&#34;.*etcd.*&#34;}</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>10m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h5 id=etcddatabasehighfragmentationratio>etcdDatabaseHighFragmentationRatio</h5><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_f89183ad85>
Copy</button></div><div id=clipboard_f89183ad85><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcdDatabaseHighFragmentationRatio</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>description</span><span style=color:#111>:</span> <span style=color:#d88200>&#39;etcd cluster &#34;{{ $labels.job }}&#34;: database size in use on instance {{ $labels.instance }} is {{ $value | humanizePercentage }} of the actual allocated disk space, please run defragmentation (e.g. etcdctl defrag) to retrieve the unused fragmented disk space.&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runbook_url</span><span style=color:#111>:</span> <span style=color:#ae81ff>https://etcd.io/docs/v3.5/op-guide/maintenance/#defragmentation</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>summary</span><span style=color:#111>:</span> <span style=color:#ae81ff>etcd database size in use is less than 50% of the actual allocated storage.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#111>|</span><span style=color:#d88200>
</span></span></span><span style=display:flex><span><span style=color:#d88200>  (last_over_time(etcd_mvcc_db_total_size_in_use_in_bytes{job=~&#34;.*etcd.*&#34;}[5m]) / last_over_time(etcd_mvcc_db_total_size_in_bytes{job=~&#34;.*etcd.*&#34;}[5m])) &lt; 0.5 and etcd_mvcc_db_total_size_in_use_in_bytes{job=~&#34;.*etcd.*&#34;} &gt; 104857600</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>10m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>labels</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>warning</span>
</span></span></code></pre></div></div></div><h2 id=dashboards>Dashboards</h2><p>仪表盘配置文件下载地址:</p><ul><li><a href=https://github.com/observeproject/sites/blob/main/assets/etcd/dashboards/etcd.json>etcd</a></li></ul><div class=row></div></div></div></div><script src=https://stack.observability.udmire.cn/lib/jquery.min.js></script><script src=https://stack.observability.udmire.cn/lib/popper.min.js></script><script src=https://stack.observability.udmire.cn/js/bootstrap.min.js></script><script type=text/javascript src=/plugins/lunr.min.js></script><script type=text/javascript src=/plugins/auto-complete.js></script><link href=/plugins/auto-complete.css rel=stylesheet><script type=text/javascript>var baseurl="https://stack.observability.udmire.cn/"</script><script type=text/javascript src=/plugins/search.js></script><script type=text/javascript src=/plugins/clipboard.js></script><script>new ClipboardJS(".btn")</script></body></html>